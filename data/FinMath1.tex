\documentclass[a4paper,twoside,DIV15,BCOR12mm]{scrbook}

\usepackage{mathe}
\usepackage{saetze-veraart}
\usepackage{faktor}
\usepackage{enumerate}
\usepackage{tikz}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{wrapfig}
\usepackage{ziffer}

\lecturer{Dr. Veraart}
\semester{Wintersemester 08/09}
\scriptstate{complete}

% get rid of fourier fontenc warnings
% from http://newsgroups.derkeiler.com/Archive/Comp/comp.text.tex/2006-01/msg00679.html
\makeatletter
\let\my@@font@warning\@font@warning
\let\@font@warning\@font@info
\makeatother
%
\usepackage{fourier}
%\usepackage{pxfonts}
%\usepackage{mathpazo}
%
\makeatletter
\let\@font@warning\my@@font@warning
\makeatother 

%\usepackage{fourier}
%\usepackage{lmodern}

% \usepackage{remreset}
% \makeatletter
% \@removefromreset{section}{chapter}
% \makeatother

\usepackage{microtype}

\newcommand{\cX}{\mathcal X}
\newcommand{\cM}{\mathcal M}
\newcommand{\cA}{\mathcal A}
\newcommand{\cV}{\mathcal V}
\newcommand{\cF}{\mathcal F}
\newcommand{\cQ}{\mathcal Q}
\newcommand{\borel}{{\mathfrak B}}
\newcommand{\unisucceq}{\succeq_{\text{uni}}}
\newcommand{\mvsucceq}{\succeq_{\text{mv}}}
\newcommand{\monsucceq}{\succeq_{\text{mon}}}
\newcommand{\dickerkringel}{\bullet}

\DeclareMathOperator{\ARA}{ARA}
\DeclareMathOperator{\RRA}{RRA}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\VatR}{V@R}
\DeclareMathOperator{\AVatR}{AV@R}

\author{Die Mitarbeiter von \url{http://mitschriebwiki.nomeata.de/}}
\title{Finanzmathematik I}
\makeindex

\begin{document}
\maketitle
 
\newenvironment{enuma}{%
\begin{enumerate}[\hspace{1em}a)]%
}{%
\end{enumerate}%
}
\newenvironment{enumi}{%
\begin{enumerate}[\hspace{1em}i)]%
}{%
\end{enumerate}%
}

\setcounter{secnumdepth}{-1}
%\renewcommand{\thechapter}{\arabic{chapter}}
%\chapter{Inhaltsverzeichnis}
%\stepcounter{chapter}
%\renewcommand{\tocname}{bla}
%\addcontentsline{toc}{chapter}{\protect\numberline {\thechapter}Inhaltsverzeichnis}
\addcontentsline{toc}{chapter}{Inhaltsverzeichnis}
\tableofcontents

 % Vorwort

\chapter{Vorwort}
\setcounter{secnumdepth}{2}
%\addcontentsline{toc}{chapter}{Vorwort}

\section*{Über dieses Skriptum}
Dies ist ein Mitschrieb der Vorlesung „Finanzmathematik I“ von Dr. Veraart im
Wintersemester 08/09 an der Universität Karlsruhe (TH).
% Die Mitschriebe der Vorlesung werden mit ausdrücklicher Genehmigung von Dr. Veraart hier veröffentlicht,
Dr. Veraart ist für  den Inhalt nicht verantwortlich.
\section*{Wer}
Gestartet wurde das Projekt von Joachim Breitner.
%Weiter haben Felix Wellen und Michael Walter beim Mitschreiben geholfen.

\section*{Wo}
Alle Kapitel inklusive \LaTeX-Quellen können unter \url{http://mitschriebwiki.nomeata.de} abgerufen werden.
Dort ist ein von Joachim Breitner programmiertes \emph{Wiki}, basierend auf \url{http://latexki.nomeata.de} installiert. 
Das heißt, jeder kann Fehler nachbessern und sich an der Entwicklung
beteiligen. Auf Wunsch ist auch ein Zugang über \emph{Subversion} möglich.

%\setcounter{chapter}{0}
%\renewcommand{\thesection}{{\rm\bfseries §}\arabic{section}}
\renewcommand{\thesection}{\arabic{chapter}.\arabic{section}}
\renewcommand{\thechapter}{\Roman{chapter}}

\chapter{Einführung in die Theorie der Finanzmärkte}

\section{Präferenzen}

Modelle, die den Finanzmarkt beschreiben, müssen stochastisch sein, um \emph{Risiko} adäquat modellieren zu können.

Ein \emph{Markt} ist ein Ort, an dem Güter und Dienstleistungen von \emph{Agenten} ausgetauscht werden, deren Handlungen durch ihre \emph{Präferenzen} bestimmt werden.

Sei $\cX$ eine nichtleere Menge. $x\in\cX$ bezeichnet die Wahlmöglichkeit eines Agenten.

\begin{definition}
Eine binäre Relation $\succeq \subseteq \cX \times \cX$ heißt \emph{Präferenzrelation}\index{Präferenzrelation}, falls sie
\begin{itemize}
\item transitiv ist, also $\forall x,y,z \in\cX$: $x\succeq y$, $y\succeq z \implies x\succeq z$
\item vollständig ist, also $\forall x,y\in \cX$: $x\succeq y$ oder $y\succeq x$
\end{itemize}
Falls $x\succeq y$ und $y\succeq x$, schreiben wir $x\sim y$ (\emph{Indifferenzrelation}\index{Indifferenzrelation}). Für $x\succeq y$ und $y\not\succeq x$ schreiben wir $x\succ y$.
\end{definition}

\begin{beispiel}
$\cX=\MdR$, $x\succeq y \iff x\ge y$
\end{beispiel}

\begin{definition}
Eine \emph{numerische Repräsentation}\index{numerische Repräsentation} einer Präferenzordnung $\succeq$ ist eine Funktion $U:\cX\to \MdR$, so dass $x\succeq y \iff U(x) \ge U(y)$.
\end{definition}

\begin{bemerkung}
Eine numerische Repräsentation ist nicht eindeutig: Sei $f$ eine streng monoton wachsende Funktion. Dann ist $\tilde U(x) \da f(U(x))$ auch eine numerische Repräsentation.
\end{bemerkung}

\begin{beispiel}
Sei $\succeq$ die lexikographische Ordnung auf $\cX \da [0, 1]\times[0, 1]$, also\[(x_1,y_1)\succ (x_2,y_2) \iff x_1 > x_2 \text{ oder } x_1 = x_2 \text{ und } y_1 > y_2.\] Für $\succeq$ gibt es keine numerische Repräsentation.
\end{beispiel}

\begin{definition}
Sei $\succeq$ Präferenzrelation auf $\cX$. Eine Teilmenge $\mathcal Z\subseteq \mathcal X$ heißt \emph{dicht}\index{dicht} in $\cX$ (bezüglich $\succeq$), falls für alle $x,y\in\cX$ mit $x\succ y$ ein $z\in\mathcal Z$ gibt, so dass $x\succeq z \succeq y$.
\end{definition}

\begin{beispiel}
$\cX = \MdR$, $\mathcal Z=\MdQ$, $\succeq = \ge$.
\end{beispiel}

\begin{satz}
Für die Existenz einer numerischen Repräsentation einer Präferenzrelation $\succeq$ ist es notwendig und hinreichend, dass $\cX$ eine abzählbare Teilmenge $\mathcal Z$ enthält, die dicht in $\cX$ liegt.

Insbesondere hat für abzählbare $\cX$ jede Präferenzrelation eine numerische Repräsentation.
\end{satz}

\begin{beweis}
siehe Föllmer \& Schied, Beweis von Theorem 2.6
\end{beweis}

\subsection{Von Neumann-Morgenstern-Repräsentation}

Im Folgenden betrachten wir das Konzept des erwarteten Nutzens.

Es seien alle Wahlmöglichkeiten eines Agenten durch Wahrscheinlichkeitsverteilungen auf einer vorgegebenen Menge von Szenarien gegeben. Sei $(S,\mathfrak S)$ ein messbarer Raum und $M_1(S,\mathfrak S)$ die Menge aller Wahrscheinlichkeitsverteilungen auf $(S,\mathfrak S)$. Wir betrachten eine Teilmenge $M\subseteq M_1(S,\mathfrak S)$. Wir nehmen an, dass $M$ konvex ist, das heißt für alle $\mu, \nu\in M$ und alle $\alpha\in[0, 1]$ ist $\alpha\mu + (1-\alpha)\nu \in M$. Die Elemente von $M$ werden auch \emph{Lotterien}\index{Lotterie} genannt.

\begin{definition}
\label{def.1.1.9}
Eine numerische Repräsentation einer Präferenzordnung wird \emph{von-Neu\-mann-Mor\-gen\-stern-Re\-prä\-sen\-ta\-tion}\index{von-Neu\-mann-Mor\-gen\-stern-Re\-prä\-sen\-ta\.tion} genannt, falls sie sich darstellen lässt als:
\[ U(\mu) = \int u(x)\mu(dx)\ \forall \mu\in M\]
wobei $u$ eine reelle Funktion auf $S$ ist.
\end{definition}

Wir werden später die Funktion $u$, wenn sie gewisse Voraussetzungen erfüllt, Nutzenfunktion nennen.

Wir betrachten beispielsweise eine Zufallsvariable $X$ auf einem Wahrscheinlichkeitsraum $(\Omega, \F, P)$, die die Auszahlung einer Anlagemöglichkeit angibt. 

Ist etwa $S\subseteq \MdR$, $\mathfrak S = \borel\footnote{Borelsche $\sigma$-Algebra}$, dann bezeichnet das Integral in der Definition \ref{def.1.1.9} den Erwartungswert von $u(X)$, wobei $u$ messbar (später stetig) sei und $X$ die Verteilung 
\[\mu(B) \da P_X(B)=P(X^{-1}(B)) \ \forall B\in\borel \]
besitzt.

Wann existiert eine von-Neumann-Morgenstern-Repräsentation?

Sei $M$ die Menge aller Wahrscheinlichkeitsmaße $\mu$ auf $S$, die sich als Linearkombination $\mu=\sum_{i=1}^N \alpha_i\delta_{x_i}$ von $x_1,\ldots,x_N\in S$ mit Koeffizienten $\alpha_1,\ldots,\alpha_N\in (0, 1]$ darstellen lässt. Das Dirac-Maß ist dabei definiert als
\[ \delta_x(A) = 
\begin{cases}
1,&x\in A\\
0,&\text{sonst}
\end{cases}\]

Dann existiert eine von-Neumann-Morgenstern-Repräsentation, falls $\succeq$ die folgenden Eigenschaften hat:
\begin{itemize}
\item \emph{Unabhängigkeitseigenschaft}\index{Unabhängigkeitseigenschaft}: Für alle $\mu,\nu\in M$ mit $\mu\succ \nu$, alle $\alpha \in(0, 1]$ und beliebige $\lambda\in M$ gilt:
\[ \alpha \mu + (1-\alpha) \lambda \succ \alpha \nu + (1-\alpha)\lambda \]
das heißt, dass die Präferenz $\mu\succ \nu$ in jeder Konvexkombination erhalten bleibt, unabhängig von der zusätzlichen Lotterie $\lambda$.

\item \emph{Archimedeseigenschaft}\index{Archimedeseigenschaft}, Stetigkeitseigenschaft: Zu jedem Tripel $\mu\succ \lambda  \succ \nu$ existieren Konstanten $\alpha,\beta\in(0, 1)$, so dass gilt:
\[
\alpha\mu + (1-\alpha)\nu \succ \lambda \succ \beta \mu + (1-\beta)\nu
\]
\end{itemize}

Falls $S$ eine endliche Menge ist, haben alle Maße die obige Darstellung als Konvexkombination von Dirac-Maßen.

Im allgemeinen Fall benötigt man für die Existenz einer von-Neu\-mann-Mor\-gen\-stern-Re\-prä\-sen\-tat\-ion neben der Unabhängigkeitseigenschaft und der Archimedeseigenschaft noch eine weitere Eigenschaft von $\succeq$ („sure thing principle“).

Für $\mu,\nu \in M$ und $A$ mit $\mu(A)=1$ gilt:
\begin{align*}
(\forall x\in A:\delta_x\succ \nu) &\implies \mu \succ \nu \\
(\forall x\in A:\nu \succ \delta_x) &\implies \nu \succ \mu
\end{align*}

Beweise siehe Föllmer und Schied, Kapitel 2.2.

\subsection{Risikoaversion}

Wir betrachten Anlagemöglichkeiten (z.B. Aktien), deren Verteilung der Auszahlung zu einem festen Zeitpunkt bekannt ist. Die Verteilung wird als Wahrscheinlichkeitsverteilung auf einem Intervall $S\subseteq \MdR$ angenommen. $\cM$ sei die Menge aller Borel-Wahrscheinlichkeitsmaße auf $S$. Wir nehmen an, dass $\cM$ konvex ist und alle Punktmaße $\delta_x$ für $x\in S$ enthält. Wir nehmen an, dass für alle $\mu\in\cM$ die Erwartung 
\[
m(\mu) \da \int x \mu (dx) \in \MdR
\]
wohldefiniert ist.

\begin{definition}
\begin{itemize}
\item Eine Präferenzrelation $\succeq$ auf $\cM$ wird \emph{monoton}\index{monotone Präferenzrelation} genannt, wenn $x>y$ impliziert, dass $\delta_x \succ \delta_y$.
\item Eine Präferenzrelation $\succeq$ wird \emph{risikoavers}\index{risikoaverse Präferenzrelation} genannt, falls für alle $\mu\in\cM$ mit $\mu \ne \delta_{m(\mu)}$ gilt, dass $\delta_{m(\mu)} \succ \mu$.
\end{itemize}
\end{definition}

\begin{satz}
Eine Präferenzrelation $\succeq$ ist 
\begin{enumerate}
\item monoton, genau dann wenn $u$ streng monoton wachsend ist.
\item risikoavers, genau dann wenn $u$ streng konkav ist.
\end{enumerate}
\end{satz}

\begin{beweis}
\begin{enumerate}
\item Sei $x>y$. Monotonie ist äquivalent zu $u(x)=\int u(s) \delta_x(ds) = U(\delta_x) > U(\delta_y) = u(y)$.
\item Sei $\succeq$ risikoavers. Dann gilt für verschiedene $x,y\in S$ und $\alpha \in (0, 1)$
\[
\delta_{\alpha x + (1-\alpha) y} \succ \alpha \delta_x + (1-\alpha)\delta_y
\implies
u(\alpha x + (1-\alpha ) y) > \alpha u(x) + (1-\alpha) u(y)
\]
also ist $u$ streng konkav.

Sei $u$ streng konkav. Risikoaversion folgt aus der Jensen-Ungleichung, da
\begin{align*}
U(\delta_{m(\mu)}) = u(m(\mu)) = u\Big(\int x \mu (dx)\Big) \ge \int u(x) \mu(dx) = U(\mu)
\end{align*}
Es gilt Gleichheit für $\mu = \delta_{m(\mu)}$.
\end{enumerate}
\end{beweis}

\begin{definition}
Eine Funktion $u:S\to\MdR$ heißt \emph{Nutzenfunktion}\index{Nutzenfunktion}, falls sie streng monoton wachsend, streng konkav und stetig\footnote{Wobei nur die Stetigkeit auf dem Rand von $S$ extra zu fordern wäre.} auf $S$ ist.
\end{definition}

Im Folgenden betrachten wir nur noch Präferenzrelationen $\succeq$ auf $\cM$, die eine von-Neu"-mann-Mor"-gen"-stern-Repräsentation $U(\mu) = \int u d \mu$ mit einer Nutzenfunktion $u:S\to\MdR$ haben. 

Die Anwendung des Zwischenwertsatzes auf die streng monoton wachsende, stetige Funktion $u$ liefert für jedes $\mu\in\cM$ die Existenz einer eindeutigen reellen Zahl $c(\mu)\in S$ mit
\[u(c(\mu)) = U(\mu) = \int ud\mu\]
Dann gilt $\delta_{c(\mu)} \sim \mu$, das heißt der Agent ist indifferent zwischen der sicheren Auszahlung $c(\mu)$ und der Lotterie $\mu$. 

\begin{definition}
Das \emph{Sicherheitsäquivalent}\index{Sicherheitsäquivalent} einer Lotterie $\mu\in \cM$ ist die reelle Zahl $c(\mu)\in S$, die 
\begin{align*}
u(c(\mu)) = U(\mu) = \int ud\mu
\end{align*}
löst.

Die \emph{Risikoprämie}\index{Risikoprämie} von $\mu$ ist definiert als $\rho(\mu)\da m(\mu) - c(\mu)$.
\end{definition}

Risikoaversion impliziert über die Jensen-Ungleichung, dass $c(\mu) \le m(\mu)$ gilt, und dass Gleichheit genau dann gilt, wenn $\mu = \delta_{m(\mu)}$.

\begin{beispiel}
Siehe St. Petersburg-Paradox, Übungsblatt 1
\end{beispiel}

\begin{beispiel}[Beispiele für Nutzenfunktionen]
\begin{itemize}
\item $u(x) = - e^{-\gamma x}$, wobei $\gamma>0$ der Koeffizient der absoluten Risikoaversion ist. Diese Funktion wird CARA (“constant absolute risk aversion”) genannt. (Siehe Abbildung \ref{fig:CARA})

\begin{figure}
\begin{center}
\begin{tikzpicture}
\clip (-3.5,-5.2) rectangle (4,1);
\draw[very thin, color=gray] (-3.1, -5.1) grid (3.1,0.1);
\draw[->] (-3.2,0) -- (3.2,0) node[right] {$x$};
\draw[->] (0,-5.2) -- (0,0.2) node[above] {$u(x)$};
\draw plot[domain=-3:-1.5] (\x,{-exp(-0.5*\x)}) node[left] {$\gamma=0,5$}
      plot[domain=-1.5:3] (\x,{-exp(-0.5*\x)});
\draw plot[domain=-3:-0.3] (\x,{-exp(-2*\x)}) node[right] {$\gamma=2$}
      plot[domain=-0.3:3] (\x,{-exp(-2*\x)});
\draw plot[domain=-3:-1.3] (\x,{-exp(-1*\x)}) node[left] {$\gamma=1$}
      plot[domain=-1.3:3] (\x,{-exp(-1*\x)});
\end{tikzpicture}
\end{center}
\caption{Die CARA-Funktion}
\label{fig:CARA}
\end{figure}

\begin{figure}
\begin{center}
\begin{tikzpicture}
\clip (-0.5, -2.5) rectangle (5,5);
\draw[very thin, color=gray] (0, -2.4) grid (3.9,4.1);
\draw[->] (-0.2,0) -- (4.2,0) node[right] {$x$};
\draw[->] (0,-2.2) -- (0,4.2) node[above] {$u(x)$};
\draw plot[domain=0.01:4] (\x,{(\x^(1-1.5))/(1-1.5)}) node[right] {$R = 1,5$};
\draw plot[domain=0.01:4] (\x,{(\x^(1-0.5))/(1-0.5)}) node[right] {$R = 0,5$};
\draw plot[domain=0.01:4] (\x,{ln(\x)}) node[right] {$R = 1$};
\end{tikzpicture}
\end{center}
\caption{Die CRRA-Funktion}
\label{fig:CRRA}
\end{figure}

\begin{figure}
\begin{center}
\begin{tikzpicture}
\clip (-0.5, -0.2) rectangle (5.5,4);
\draw[very thin, color=gray] (0, -0.1) grid (3.9,3.1);
\draw[->] (-0.2,0) -- (4.2,0) node[right] {$x$};
\draw[->] (0,-0.2) -- (0,3.2) node[above] {$u(x)$};
\draw plot[domain=0.01:4] (\x,{\x - (0.4/2)*\x*\x}) node[right] {$\varepsilon = 0,4$};
\draw plot[domain=0.01:4] (\x,{\x - (0.2/2)*\x*\x}) node[right] {$\varepsilon = 0,2$};
\end{tikzpicture}
\end{center}
\caption{Die „Nutzenfunktion“ $u(x) = x - \frac\varepsilon2x^2$}
\label{fig:Parabel}
\end{figure}

\item $u(x) = 
\begin{cases}
\frac{x^{1-R}}{1-R}, & x > 0 \\
-\infty, & x \le 0
\end{cases}$, wobei $R>0$, $R\ne 1$ der Koeffizient der relativen Risikoaversion ist. Diese Funktion wird CRRA (“constant relative risk aversion”) genannt. (Siehe Abbildung \ref{fig:CRRA})
\item $u(x) = 
\begin{cases}
\log x, & x > 0 \\
-\infty, & x \le 0
\end{cases}$ ist CRRA-Nutzenfunktionen für $R=1$.
\item Die Funktion $u(x) = x - \frac\varepsilon2x^2$, $\varepsilon>0$, ist konkav, aber nicht monoton wachsend. Sie wird trotzdem manchmal als „Nutzenfunktion“ verwendet, da sie einfach zu handhaben ist. (Siehe Abbildung \ref{fig:Parabel})
\end{itemize}
\end{beispiel}

\begin{bemerkung}
Für zweimal stetig differenzierbare $u\in C^2$ gilt: $u$ ist konkav genau dann, wenn $u''\le 0$ ist.
\end{bemerkung}

\subsection{Arrow-Pratt-Maß}

Im Folgenden definieren wir zwei Maße für Risikoaversion eines Agenten: Das Arrow-Pratt-Maß (APM) der absoluten Risikoaversion und das APM der relativen Risikoaversion.

Wir betrachten einen Agenten mit Vermögen $x$, dessen Präferenzen durch eine Nutzenfunktion $u\in C^2$ ausgedrückt werden. Wenn man ihm anbietet, einen Zahlungsanspruch (contingent claim) $Y$ (Zufallsvariable) zu bekommen, wird er ihn genau dann annehmen, wenn \[E[u(x+Y)] \ge E[u(x)] = u(x).\]
Unter der Annahme, dass $Y$ „klein“ ist, machen wir eine Taylorentwicklung um $x$:
\begin{align*}
0\le E[u(x+Y) - u(x)] \approx E[u'(x)Y+ \frac12 u''(x)Y^2]
\end{align*}
das heißt, der Agent wird $Y$ haben wollen, falls 
\begin{align*}
\frac{2EY}{E[Y^2]} \ge \frac{-u''(x)}{u'(x)} \ad \ARA(x)
\end{align*}
wobei $\ARA(\cdot)$ den \emph{absoluten Risikoaversionskoeffizienten}\index{Risikoaversionskoeffizient!absoluter} bezeichnet.

\begin{bemerkung}
\begin{enumerate}
\item Falls $\ARA(x)$ konstant ist, dann ist $u$ die CARA-Nutzenfunktion.
\item Es gilt: $\ARA(x) \ge 0$.
\item Der Agent will $Y$ lieber haben, falls $EY$ groß oder $E[Y^2]$ klein ist.
\end{enumerate}
\end{bemerkung}

Alternativ können wir den Fall betrachten, dass ein Agent in eine risikobehaftete Anlagemöglichkeit investieren kann, die zum Zeitpunkt 1 den Wert $x(1+Y)$ hat. Der Agent bevorzugt die Investition, falls $E[u(x(1+Y))] \ge u(x)$. Nach Taylor ist dann
\begin{align*}
0 \le E[u(x(1+Y)) - u(x)] \approx E[u'(x)xY + \frac12 u''(x) x^2 Y^2]
\end{align*}
Der Agent zieht diese Investition vor, genau dann wenn
\[\frac{2EY}{E[Y^2]}\ge \frac {-xu''(x)}{u'(x)} \ad \RRA(x)\]
ist, wobei $\RRA(\cdot)$ den \emph{relativen} Risikoaversionskoeffizienten \index{Risikoaversionskoeffizient!relativer} bezeichnet.

\begin{bemerkung}
Falls $\RRA(x)$ konstant ist, dann ist $u$ die CRRA-Nutzenfunktion.
\end{bemerkung}

\begin{definition}
Eine Nutzenfunktion $u:\MdR\to\MdR$ heißt HARA-Nutzenfunktion (“hyperbolic absolute risk aversion”), falls $u\in C^2(\MdR)$ und für Konstanten $\alpha, \beta$:
\begin{align*}
\ARA(x) = \frac{-u''(x)}{u'(x)} = \frac{1}{\alpha x + \beta} > 0
\end{align*}
Die CARA-, CRRA-Nutzenfunktionen sind HARA-Nutzenfunktionen.
\end{definition}

\subsection{Reservationspreise}

Sei $\cA$ die Menge, die das erreichbare Vermögen eines Agenten beschreibt. Der Agent wird versuchen, $\sup_{X\in\cA}E[u(X)]$ zu bekommen. Wir nehmen an, dass das Supremum angenommen wird, das heißt es gibt $X^*\in\cA$ mit $\sup_{X\in\cA}E[u(X)] = E[u(X^*)]$.

Falls $\cA$ ein affiner Raum ist, das heißt für alle $X_1,X_2\in \cA$ und $t\in\MdR$ ist $tX_1 + (1-t)X_2 \in \cA$, können wir $\cA = X^* + \cV$ schreiben, wobei $\cV$ ein Vektorraum ist. Dann gilt für $\xi\in\cV$ und $t\in \MdR$, dass $E[u(X^* + t\cdot\xi)] \le E[u(X^*)]$. Ableiten nach $t$ liefert für alle $\xi\in\cV$: $E[u'(X^*)\xi]=0$ (ersetze für die Gleichheit $\xi$ durch $-\xi$).

Im Folgenden werden wir das Konzept des erwarteten Nutzens verwenden, um zu entscheiden, ob man einen contingent claim $Y$ zu einem Preis $\pi$ kaufen sollte. (O.B.d.A. nehmen wir an, dass $Y\ge 0$).

\begin{definition}
Der \emph{Reservations-Bid-Preis}\index{Reservations-Bid-Preis} $\pi(Y)$ eines contingent claim $Y$ ist die größte reelle Zahl $\pi$, für die \[\sup_{X\in\cA} E[u(X+Y-\pi)] \ge E[u(X^*)]\] erfüllt ist.
\end{definition}

\begin{bemerkung}
\begin{enumerate}
\item Der Reservations-Bid-Preis ist der (maximale) Preis, zu dem der Agent bereit ist, den contingent claim zu kaufen.
\item Die Abbildung $Y\mapsto\pi(Y)$ ist konkav.
\begin{beweis}
Seien $X_1,X_2\in\cA$, so dass
\[E[u(X_1 + Y_1 - \pi(Y_1))] = E[u(X_2+Y_2-\pi(Y_2))] = E[u(X^*)].\]
Dann gilt für $p\in[0, 1]$, dass
\begin{align*}
E[u(X^*)] &= p\cdot E[u(X_1+Y_1-\pi(Y_1))] + (1-p)\cdot E[u(X_2+Y_2-\pi(Y_2))]\\
&\le E[u(p\cdot(X_1+Y_1-\pi(Y_1)) + (1-p)\cdot(X_2+Y_2) + (1-p)\pi(Y_2))] \\
&= E[u(\underbrace{p X_1 + (1-p) X_2}_{\in\cA} + \underbrace{p Y_1 + (1-p)Y_2}_{\ad \bar Y} - p \pi(Y_1) + (1-p) \pi(Y_2))] \\
&\le \sup_{X\in\cA} E[u(X + \bar Y - (p\pi(Y_1) + (1-p) \pi(Y_2)))]
\end{align*}
Daher gilt
\begin{align*}
p\pi(Y_1)+ (1-p)\pi(Y_2) &\le \pi(\bar Y) =\pi (p Y_1 + (1-p)Y_2)
\end{align*}
\end{beweis}

\item Reservationspreise sind nicht homogen, das heißt in der Regel gilt: $\pi(\lambda Y) \ne \lambda \pi(Y)$.
\item Reservationspreise sind abhängig vom Agenten, also von $u$ und $\cA$. Veränderungen des Anfangsvermögens ändern in der Regel den Reservationspreis.
\item Reservationspreise als Bewertungsmethode zu verwenden ist schwierig, da sie selten in geschlossener Form vorliegen.
\item Wir verwenden nun den Reservations-Bid-Preis, um Marginalpreise (Preise für unendlich kleine Mengen) zu bestimmen:

Sei $\cA$ affin. Angenommen, ein Agent möchte $t$ Einheiten von $Y$ kaufen, wobei $t$ klein ist. Dann ist 
\begin{align*}
E[u(X^*)]=E[u(X_t^* + tY - \pi(tY))]
\end{align*}
Duch Entwicklung als Taylorreihe ergibt das
\begin{align*}
0
&= E[u(X_t^* + tY -\pi(tY)) - u(X^*)] \\
&= E[u'(X^*) \cdot (tY - \pi(tY))] + o(t)
\end{align*}
da $X_t^* - X^*\in\cA$ und $E[u'(X^*)\xi]=0$ für alle $\xi\in\cV$ ist.

Dann gilt
\begin{align*}
\lim_{t\to0} \frac{\pi(tY)}{t} = \frac{E[u'(X^*)Y]}{E[u'(X^*)]}
\end{align*}
Dieser Ausdruck ist linear in $Y$. Man kann diesen Preis als $\tilde E(Y)$ interpretieren:
\begin{align*}
\frac{E[u'(X^*)Y]}{E[u'(X^*)]} = \int_{\Omega} Y \underbrace{\frac{u'(X^*)}{E[u'(X^*)]} dP}_{\ad d\tilde P} = \int Y d\tilde P = \tilde EY.
\end{align*}
das heißt $\frac{d\tilde P}{dP} = \frac{u'(X^*)}{E[u'(X^*)]}$. Dieses Maß $\tilde P$ wird auch \emph{risikoneutrales Maß}\index{risikoneutrales Maß} genannt.

\item Es gab viele Annahmen in dieser heuristischen Herleitung: Die Suprema werden angenommen, man kann unter dem Erwartungswert differenzieren. $\cA$ ist affin\dots

\item Trotzdem haben wir hier schon einmal gesehen, dass Preise hier als Erwartungen unter einem speziellen Maß verstanden werden können.
\end{enumerate}
\end{bemerkung}


\section{Optimale Portfolios}

Notation und Annahmen:
\begin{itemize}
\item Es wird ein Einperiodenmodell mit Anfangszeitpunkt $t=0$ und Endzeitpunkt $t=T$ betrachtet. Das heißt, wir stellen heute ($t=0$) ein Portfolio zusammen und ändern dann nichts mehr an der Zusammensetzung bis zu $t=T$.
\item Der Markt enthalte $d$ Anlagemöglichkeiten, deren Preise zum Zeitpunkt $t=0$ durch $S(0) = (S_1(0),\ldots,S_d(0))^\top \in \MdR^d$ gegeben sind. Die Preise zum Zeitpunkt $t=T$ sind durch den Zufallsvektor $S(T)=(S_1(T),\ldots,S_d(T))^\top\in\MdR^d$ gegeben.
\item Es wird der zufällige Return (Ertrag)
\[
R_i(T) = \frac{S_i(T)}{S_i(0)},\ i=1,\ldots,d
\]
betrachtet und angenommen, dass dessen Erwartungswert 
\[
E[R_i(T)]\ad m_i,\ i=1,\ldots,d
\]
und Kovarianzmatrix 
\[
\Cov(R_i(T),R_j(T))\ad \sigma_{ij},\ i,j=1,\ldots,d
\]
bekannt (oder geschätzt) sind.

\item Die symmetrische Matrix $\Sigma = (\sigma_{ij})$ sei positiv definit (das heißt $\forall \pi\in\MdR^d\setminus\{0\}: \pi^\top \Sigma \pi > 0$). Insbesondere ist $\Sigma$ invertierbar und es wird garantiert, dass keine Anlagemöglichkeit überflüssig ist, in dem Sinne, dass sie als Linearkombination anderer Anlagemöglichkeiten dargestellt werden könnte.
\item Wir bezeichnen mit $\varphi\in\MdR^d$ eine Handelsstrategie, wobei $\varphi_i$ die Stückzahl der $i$-ten Anlagemöglichkeit angibt.
\item Manchmal wird $\varphi_i \ge 0$ für alle $i=1,\ldots,d$ vorausgesetzt. (“no short selling”, „keine Leerverkäufe“)
\end{itemize}

\begin{definition}
Gegeben sei ein Investor mit Anfangsvermögen $x>0$, der $\varphi_i>0$ Stück einer Anlagemöglichkeit $i=1,\ldots,d$ besitzt, wobei 
\begin{align*}
\sum_{i=1}^d \varphi_i S_i(0)= x \tag{Budgetgleichung}
\end{align*}
gilt. Dann bezeichnen wir mit $\pi=(\pi_1,\ldots,\pi_d)^\top\in\MdR^d$,
\begin{align*}
\pi_i \da \frac{\varphi_iS_i(0)}x,\quad i=1,\dots,d
\end{align*}
den \emph{Portfoliovektor}\index{Portfoliovektor} und
\begin{align*}
R^\pi \da \sum_{i=1}^d \pi_iR_i(T)
\end{align*}
den \emph{Portfolio-Return}.\index{Portfolio-Return}
\end{definition}

\begin{bemerkung}
\begin{enumerate}
\item Die Elemente des Portfoliovektors bezeichnen die Anteile des Vermögens, die in die jeweilige Anlagemöglichkeit investiert wurden:
\begin{align*}
\sum_{i=1}^d \pi_i = \frac1x \sum_{i=1}^d \varphi_iS_i(0) = \frac xx = 1
\end{align*}
\item Sei $V^\pi(T)$ das Endvermögen zum Anfangsvermögen $x$ und dem Portfoliovektors $\pi$, das heißt
\begin{align*}
V^\pi(T) = \sum_{i=1}^d\varphi_iS_i(T).
\end{align*}
Damit ist
\begin{align*}
R^\pi = \sum_{i=1}^d \pi_iR_i(T) = \sum_{i=1}^d \frac{\varphi_iS_i(0)}x \frac{S_i(T)}{S_i(0)} = \frac{V^\pi(T)}x
\end{align*}
\item Erwartungswert und Varianz des Portfolio-Returns sind 
\begin{align*}
E[R^\pi] &= \sum_{i=1}^d \pi_im_i = \pi^\top m \\
\Var(R^\pi) &= \sum_{i,j=1}^d \pi_i\sigma_{ij}\pi_j = \pi^\top \Sigma \pi
\end{align*}
\end{enumerate}
\end{bemerkung}

\subsection{Portfolio-Optimierung nach Markowitz}
Im Folgenden betrachten wir die Auswahl eines optimalen Portfolio. Harry M. Markowitz (Nobelpreisträger Wirtschaftswissenschaften 1990) schlug das Erwartungswert-Varianz-Kriterium also Optimierungskriterium vor, das heißt es wird nach einer Balance zwischen Risiko (Varianz) und Return (Erwartungswert) gesucht.

\begin{definition}
Ein Portfolio heißt \emph{Grenzportfolio},\index{Grenzportfolio} wenn es unter allen Portfolios mit gleichem Return die kleinste Varianz hat. Die Menge aller Grenzportfolios heißt \emph{Portfoliogrenze}.\index{Portfoliogrenze}
\end{definition}

\begin{satz}
Ein Portfolio $p$ heißt Grenzportfolio, genau dann, wenn der Portfoliovektor $\pi_p$ Lösung des folgenden Optimierungsproblems ist:
\begin{align*}
\min_{\pi} \frac 12 \pi^\top \Sigma \pi &= \min_\pi \frac 12 \sum_{i=1}^d\sum_{j=1}^d \pi_i \sigma_{ij}\pi_j = \min_\pi \frac 12 \Var(R^\pi) \\
\intertext{unter den Nebenbedingungen}
\pi^\top m &= \sum_{i=1}^d \pi_im_i = E[R^\pi] = m_p \\
\pi^\top \mathbf 1 &= \sum_{i=1}^d \pi_i = 1
\end{align*}
wobei $\mathbf 1=(1,\ldots,1)^\top\in\MdR^d$, $m=(m_1,\ldots,m_d)^\top$ der erwartete Return der Anlagemöglichkeiten und $m_p$ der vorgegebene Portfolio-Return ist.
\end{satz}

Berechnung mit der Lagrange-Funktion
\begin{align*}
L(\pi) = \frac 12 \pi^\top \Sigma \pi - \lambda_1 (\pi^\top m - m_p) - \lambda_2 (\pi^\top \mathbf 1 - 1)
\end{align*}
ergibt den Gradienten (als Vektor in $\MdR^d$)
\begin{align*}
L'(\pi) = \Sigma\pi - \lambda_1 m - \lambda_2 1 \stackrel{!}=0.
\end{align*}
Dies gilt genau dann, wenn
\begin{align*}
\pi=\lambda_1\Sigma^{-1}m +\lambda_2 \Sigma^{-1}\mathbf 1.
\end{align*}
Die Lagrange-Multiplikatoren $\lambda_1$, $\lambda_2$ werden über die Nebenbedingungen bestimmt:
\begin{align*}
m^\top \pi &= \lambda_1 m^\top \Sigma^{-1}m + \lambda_2 m^\top \sigma^{-1}\mathbf 1 \\
\mathbf 1^\top m &= \lambda_1 \mathbf 1^\top\Sigma^{-1} m + \lambda_2 \mathbf 1^\top \Sigma^{-1}\mathbf 1
\end{align*}
Lösen dieses lineraren Gleichungssystems liefert
\begin{align*}
\lambda_1 &= \frac{C m_p - A}{D} & \lambda_2 &= \frac{B-A m_p}D
\end{align*}
wobei
\begin{align*}
A &\da m^\top \Sigma^{-1} \mathbf 1 = \mathbf 1^{\top}\Sigma^{-1}m \\
B &\da m^\top \Sigma^{-1} m\\
C &\da \mathbf 1^\top \Sigma^{-1} \mathbf 1 \\
D &\da BC -A^2 > 0
\end{align*}
Dann ist das optimale Portfolio gegeben durch 
\begin{align*}
\pi_p &=\frac{Cm_p-A}{D} \Sigma^{-1}m + \frac{B-Am_p}D \Sigma^{-1} \mathbf 1
\intertext{was man schreiben kann als}
\pi_p &=g + h\cdot m_p
\end{align*}
wobei
\begin{align*}
g &\da \frac1D ( -A\cdot \Sigma^{-1}m + B \cdot \Sigma^{-1} \mathbf 1) \\
h &\da \frac1D (C \cdot \Sigma^{-1} m - A \cdot \Sigma^{-1} \mathbf 1)
\end{align*}

Wir sehen, dass für $m_p=0$ das optimale Portfolio durch $g$ gegeben ist, für $m_p=1$ ist es durch $g+h$ gegeben. Für ein beliebiges $m_q$ gilt
\begin{align*}
\pi_q = g + hm_q = (1-m_q)g + m_q(g+h)
\end{align*}
Das heißt, dass das optimale Portfolio eine Linearkombination aus zwei Portfolios $g$ und $g+h$ ist. Jedes Grenzportfolio kann also als Linearkombination dieser zwei Grenzportfolios ausgedrückt werden (“two-fund separation”).

Beide Portfolios haben positive Varianz:
\begin{align*}
g^\top \Sigma g &= \frac 1 D B &
(g+h)^\top \Sigma (g+h) &= \frac 1D (B- 2AD + C)
\end{align*}

Setzt man $\pi$ in die Varianzgleichung ein, erhält man 
\begin{align*}
\sigma^2_{\text{Markowitz}}(m_p) &\da \pi_p^\top \Sigma \pi_p \\
&= \frac 1 D (2m_pA + m_p^2C) \\
&= \frac C D \bigg(m_p - \frac AC\bigg)^2 + \frac 1C
\end{align*}
Diese Gleichung beschreibt eine Parabel im Varianz-Erwartungswert-Raum und eine Hyperbel im Standardabweichungs-Erwartungswert-Raum mit Koordinaten $(\sigma_{\text{Markowitz}},m_p)$.

Die globale minimale Varianz $\frac 1C$ wird für $m_p=\frac AC$ erreicht.

\begin{bemerkung}
\begin{enumerate}
\item Das Portfolio mit der kleinsten Varianz wird \emph{Minimum-Varianz-Portfolio}\index{Minimum-Varianz-Portfolio} (mvp) genannt ($m_p=\frac AC$ und minimale Varianz $\frac 1C$).
\item Ein Grenzportfolio ist \emph{effizient},\index{effizientes Portfolio} genau dann, wenn es eine echt größere erwartete Rendite als das mvp hat.
\item Ein Portfolio, dass weder das mvp noch effizient ist, heißt \emph{ineffizient}.\index{ineffizientes Portfolio}
\item Die Effizienzgrenze ist der Teil der Kurve, der oberhalb der des globalen Minimums der Varianz liegt.
\end{enumerate}
\end{bemerkung}

\begin{center}
\begin{tikzpicture}
\draw(3,3) node[draw,rectangle,fill=white] (b) {};
\draw[->] (0,-0.2) -- (0,6)  node[right] {$m_p$};
\draw[->] (-0.2,0) -- (10,0)  node[below] {$\displaystyle\sigma_{\text{Markowitz}}$};
\draw[dotted] (3,0) node [below] {$\displaystyle\sqrt{\frac 1C}$} -- (b);
\draw (b.east) node[right] {Minimum-Varianz-Portfolio};
\draw[dotted] (0,3) node [left] {$\displaystyle\frac AC$} -- (b);
\draw (10,5) node [left=1cm] {effiziente Portfoliogrenze};
\begin{scope}[rotate around={270:(b)}]
\draw[ultra thick,-] (b) parabola bend (b) (1,10);
\draw (b) node[draw,rectangle,fill=white] {};
\draw[-] (5,10) parabola bend (b) (1,10);
\end{scope}
\end{tikzpicture}
\end{center}

\begin{satz}
Sei $\Sigma$ positiv definit. Dann ist $\pi_p$ ein Grenzportfolio genau dann, wenn zwischen der Varianz des Portfolio-Returns und dem vorgegebenen Portfolioreturn $m_p$ der folgende Zusammenhang bestelt:
\begin{align*}
\sigma^2_{\text{Markowitz}}(m_p) = \pi_p^\top\Sigma\pi_p = \frac CD\bigg(m_p-\frac AC\bigg)^2 + \frac 1C
\end{align*}
wobei
\begin{align*}
A &= m^\top \Sigma^{-1} \mathbf 1 & B&=m^\top \Sigma^{-1}m \\
C &= \mathbf 1^\top\Sigma^{-1}\mathbf 1 & D &= BC-A^2.
\end{align*}

Diese Hyperbel in der $(\sigma_{\text{Markowitz}},m_p)$-Ebene ist die Portfoliogrenze. Effiziente Portfolios sind auf der Portfoliogrenze mit erwartetem Return $m_p>\frac AC$
\end{satz}

\subsection{Portfolio-Optimierung nach Tobin}
Wir betrachten den Markt mit den Anlagemöglichkeiten wie bisher und fügen eine risikolose Anlagemöglichkeit $S_0$ hinzu. Der Markt enthält dann $d+1$ Anlagemöglichkeiten: $S_0,S_1,\ldots,S_d$. Weiterhin sei $\Sigma$, die Kovarianzmatrix der $d$ risikobehafteten Anlagemöglichkeiten, regulär. Wir bezeichnen den erwarteten Return der Anlagemöglichkeiten mit $m$.


Da $\Cov(S_0,S_i)=0$ für $i=1,\ldots,d$ können wir nicht wie zuvor vorgehen, da sonst die Kovarianzmatrix der $d+1$ Anlagemöglichkeiten singulär wäre.

Wir setzen also $R_0(T)=\frac{S_0(T)}{S_0(0)} \ad R_0$ und $E[R_0(T)]=R_0$.

Sei $\tilde\pi = (\pi_0,\ldots,\pi_d)\in\MdR^{d+1}$ der Portfoliovektor für das Investitionsproblem mit $d+1$ Anlagemöglichkeiten und deren Kovarianzmatrix $\tilde\Sigma\in\MdR^{d+1\times d+1}$, $\tilde\Sigma = \bigl(\begin{smallmatrix} 0 &  0\\ 0 & \Sigma  \end{smallmatrix}\bigr)$. Wir fordern weiterhin $\tilde\pi^\top \tilde{\mathbf 1}=\pi_0+ \sum_{i=1}^d \pi_i = \pi_0 + \mathbf 1^\top \pi = 1$, also $\pi_0 = 1- \mathbf 1^\top\pi$. Dann lässt sich der Return schreiben als
\begin{align*}
R^\pi = \sum_{i=0}^d \pi_i R_i(T) = \sum_{i=1}^d \pi_i R_i(T) + (1-\sum_{i=1}^d \pi_i)R_0(T)
\end{align*}
mit Erwartungswert
\begin{align*}
E[R^\pi] = \pi^\top m + R_0(1-\pi^\top\mathbf 1) = \pi^\top (m-R_0\mathbf 1) + R_0
\end{align*}
und Varianz $\Var(R^\pi)=\pi^\top\Sigma\pi$. Das Optimierungsproblem ist dann 
\begin{align*}
&\min\frac12\pi^\top\Sigma\pi 
\intertext{unter der Nebenbedingung}
&\pi^\top(m-R_0\mathbf 1) + R_0 = m_p
\end{align*}

Wir verwenden die Lagrange-Methode:
\begin{align*}
L(\pi) &\da \frac12 \pi^\top \Sigma \pi - \lambda_1(\pi^\top(m-R_0\mathbf 1)+ R_0 - m_p) \\
L'(\pi) &= \Sigma\pi - \lambda_1(m-R_0\mathbf 1) \stackrel!= 0\\
&\iff \pi = \lambda_1\Sigma^{-1}(m-R_0\mathbf 1) \ad \lambda_1 b
\end{align*}
Über die Nebenbedingung kann $\lambda_1$ bestimmt werden:
\begin{align*}
(\lambda_1\Sigma^{-1}(m- R_0\mathbf 1))^\top(m-R_0\mathbf 1) + R_0 = m_p \iff \lambda_1=\frac{m_p-R_0}{b^\top m - R_0b^\top \mathbf 1}
\end{align*}
Dann ist das optimale Portfolio (für die Investition in die Aktien) gegeben durch
\begin{align*}
\pi&=\lambda_1b =\frac{m_p - R_0}{b^\top m - R_0b^\top\mathbf 1} b = \underbrace{\frac{m_p-R_0}{b^\top m - R_0b^\top \mathbf 1}\cdot\frac{b^\top\mathbf 1}1}_{\ad \alpha^*}\cdot\underbrace{\frac1{b^\top\mathbf 1}\cdot b}_{\ad \pi^*} = \alpha^* \pi^*
\end{align*}
Insbesondere gilt
\begin{align*}
\alpha^* = \frac{(m_p-R_0)b^\top \mathbf 1}{b^\top m - R_0 b^\top \mathbf 1} = 
\frac{(m_p-R_0)b^\top \mathbf 1}{(\frac{b^\top m}{b^\top\mathbf 1} - R_0) b^\top \mathbf 1}
= \frac{m_p-R_0}{\pi^* m - R_0}
\end{align*}
Die optimale Strategie für die risikolose Anlagemöglichkeit ist dann
\begin{align*}
\pi_0 = 1 - \mathbf 1^\top\pi = 1 - \alpha^* \frac{b^\top\mathbf 1}{b^\top\mathbf 1} = 1- \alpha^*.
\end{align*}

\begin{definition}
Das obige $\pi^*$ heißt \emph{Tangentialportfolio}.\index{Tangentialportfolio}
\end{definition}

\begin{bemerkung}
Das optimale $\pi^*$ hängt nicht von $m_p$ ab! Ein Investor wird unabhängig von seiner Zielrendite immer das Tangentialportfolio als Investition in die risikobehafteten Anlagemöglichkeiten wählen. Die Wahl eines effizienten Portfolios bedeutet also, dass die Präferenzen des Investors nur durch seine Wahl des Anteils $(1-\alpha^*)$, den er risikolos investiert, ausgedrückt werden.
\end{bemerkung}

Die minimale Varianz ist dann gegeben durch
\begin{align*}
\sigma_{\text{Tobin}}^2(m_p) \da (\alpha^*)^2 {\pi^*}^\top\Sigma\pi^* = \frac{(m_p-R_0)^2}{b^\top \Sigma b} = \frac {(m_p-R_0)^2}{D\sigma^2_{\text{Markowitz}}(R_0)}
\end{align*}
In der Varianz-Erwartungswert-Ebene wird dadurch eine Parabel beschrieben. In der Stan\-dard\-ab\-weich\-ungs-Erwartungswert-Ebene vereinfacht sich die Darstellung.

\begin{satz}
Im Markt mit zusätzlicher risikoloser Anlagemöglichkeit mit Return $R_0$ ist ein Portfolio ein Grenzportfolio genau dann, wenn der folgende Zusammenhang zwischen Standardabweichung der Portfoliorendite und erwarteter Rendite gilt:
\begin{align*}
\sigma_{\text{Tobin}} = |\alpha^*| \sqrt{ {\pi^*}^\top\Sigma\pi^*} = \left|
\frac{m_p-R_0}{ {\pi^*}^\top m - R_0 }\right| \sqrt{ {\pi^*}^\top\Sigma\pi^*}
\end{align*}
Effizient sind alle Portfolios auf der so beschriebenen Portfoliogrenze, deren erwartete Rendite echt größer als $R_0$ ist.
\end{satz}

\begin{definition}
Die effizienten Portfolios liegen auf der sogenannten \emph{Kapitelmarktgeraden}:\index{Kapitelmarktgeraden}\index{Marktrisikoprämie}
\begin{align*}
m_p = R_0 + \sigma_{\text{Tobin}} \underbrace{\frac{ {\pi^*}^\top m - R_0}{\sqrt{ {\pi^*}^\top \Sigma \pi^*}}}_{\text{\emph{Marktrisikoprämie}}}
\end{align*}
\end{definition}

Das heißt, dass das Hinzufügen einer risikolosen Anlagemöglichkeit aus der Portfoliogrenze eine Gerade macht, die von $(0,R_0)$ tangential zur Portfoliogrenze der risikobehafteten Anlagemöglichkeiten geht. In dem Zusammenhang spricht man auch vom One-Fund-Theorem: Jedes effiziente Portfolio kann als Kombination aus dem Fund und der risikolosen Anlagemöglichkeit konstruiert werden.

\begin{bemerkung}
Für das optimale Markowitz-Portfolio gilt:
\begin{align*}
\pi_{\text{Markowitz}} (m_p) = \frac{C_{m_p}-A}D \Sigma^{-1}m + \frac{B-A_{m_p}}D \Sigma^{-1}\mathbf 1
\end{align*}
Für das Tangentialportfolio gilt:
\begin{align*}
\pi^* = \frac1{A-R_0C} \Sigma^{-1}m + \frac{-R_0}{A-R_0C}\Sigma^{-1}\mathbf 1
\end{align*}
Man kann nachrechnen, dass für
\begin{align*}
m^* \da {\pi^*}^\top m = \frac{B-R_0A}{A-R_0C}
\end{align*}
und $m^*>R_0$ gilt:
\begin{align*}
\pi_{\text{Markowitz}}(m^*) = \pi^*
\end{align*}
Insbesondere
\begin{align*}
\sigma_{\text{Markowitz}}(m^*) = \sigma_{\text{Tobin}}(m^*)
\end{align*}
und
\begin{align*}
\sigma'_{\text{Markowitz}}(m^*) = \sigma'_{\text{Tobin}}(m^*)
\end{align*}
Am Punkt $m^*$ berühren sich die Portfoliogrenze und die Kapitelmarktlinie tangential.
\end{bemerkung}

\begin{center}
\begin{tikzpicture}
\draw(3,3) node[draw,rectangle,fill=white] (b) {};
\draw[->] (0,-0.2) -- (0,6)  node[right] {$m_p$};
\draw[->] (-0.2,0) -- (10,0)  node[below] {$\displaystyle\sigma$};
\draw[dotted] (3,0) -- (b);
% \draw (b.east) node[right] {Minimum-Varianz-Portfolio};
\draw[dotted] (0,3)-- (b);
\draw (3.5,3.5) node [right=1cm] {Markowitz’ effiziente Portfoliogrenze};
\begin{scope}[rotate around={270:(b)}]
\draw[ultra thick,-] (b) parabola bend (b) (1,10);
\draw (b) node[draw,rectangle,fill=white] {};
\draw[-] (5,10) parabola bend (b) (1,10);
\end{scope}
\draw (0,2) node[left] {$R_0$} -- (9,6);
\draw(3.5,3.73) node (x) {};
\draw[dotted] (3.5,0) node[below] {$\displaystyle\sqrt{ {\pi^*}^\top\Sigma\pi^*}$} -- (3.5,3.56);
\draw[dotted] (0,3.56) node[left] {$ {\pi^*}^\top m$} -- (3.5,3.56);
\draw (7.5,5.5) node[left] {Kapitalmarktgerade};
\end{tikzpicture}
\end{center}

\subsubsection*{Bestimmung von Kovarianzen}

Sei $\pi_1$ ein Portfolio von der effizienten Portfoliogrenze und $\pi_2$ ein beliebiges Portfolio. Dann gilt
\begin{align*}
\Sigma\pi_1 = \lambda_1(m-R_0\mathbf 1).
\end{align*}
Durchmultiplizieren mit $\pi_1^\top, \pi_2^\top$ liefert
\begin{align*}
\Var(R^{\pi_1}) &= \pi_1^\top \Sigma \pi_1 = \lambda_1\pi_1^\top(m-R_0\mathbf 1) \\
\Cov(R^{\pi_1},R^{\pi_2}) &= \pi_2^\top\Sigma \pi_1 = \lambda_1 \pi_2^\top (m-R_0\mathbf 1)
\end{align*}
Auflösen nach $\lambda_1$ und gleichsetzen liefert
\begin{align*}
& \frac{\Var(R^{\pi_1})}{\pi_1^\top m - R_0 \pi_1^\top \mathbf 1} = 
\frac{\Cov(R^{\pi_1},R^{\pi_2})}{\pi_2^\top m - R_0 \pi_2 ^\top \mathbf 1} \\
\iff & \beta_{\pi_1,\pi_2} \da 
\frac{\Cov(R^{\pi_1},R^{\pi_2})}{\Var(R^{\pi_1})} =
\frac{E[R^{\pi_1}]-R_0}{E[R^{\pi_2}]-R_0} \\
\iff & E[R^{\pi_2}] = R_0 + \beta_{\pi_2,\pi_1}(E[R^{\pi_1}]-R_0)
\end{align*}
Das heißt, dass die erwartete Rendite eines beliebigen Portfolios linear von seiner Kovarianz mit einem Portfolio minimaler Varianz abhängt. $\beta_{\pi_1,\pi_2}$ bezeichnet das „Beta“ eines Portfolios $\pi_2$ in Bezug auf ein Portfolio $\pi_1$. Dabei ist $\beta_{\pi_2,\pi_1}$ der gewichtete Mittelwert des Betas der verschiedenen risikobehafteten Anlagemöglichkeiten:
\begin{align*}
\beta_{\pi_2,\pi_1} = \sum_{i=1}^d (\pi_2)_i\beta_{i,\pi_1}
\end{align*}

\subsection{Captial Asset Pricing Model (CAPM)}

Bisher haben wir die Portfolioselektion aus der Perspektive eines einzelnen Investors betrachtet. Wir kommen nun zu einer Gleichgewichtsaussage über den gesamten Kapitalmarkt.

Dazu machen wir folgende Annahmen:
\begin{itemize}
\item Alle Marktteilnehmer haben homogene Informationen und dadurch homogene Erwartungen (gleiche Kovarianzmatrix, gleiche Erwartungswerte), denselben Investitionshorizont, Numeraire etc.
\item Es gibt eine risikolose Anlagemöglichkeit. Bei dieser kann man zu demselben Zinssatz Kredite aufnehmen, zu dem auch Investitionen verzinst werden.
\item Alle entscheiden sich nach dem Erwartungswert-Varianz-Kriterium.
\item Daher halten alle Marktteilnehmer das gleiche Portfolio der risikobehafteten Anlagemöglichkeiten, das Tangentialportfolio.
\item Im Gleichgewicht muss die Gesamtnachfrage nach Aktien gleich der umlaufenden Aktien sein, da dass Tangentialportfolio in unterschiedlichen Mengen von den Investoren gehalten wird, muss es aus allen risikobehafteten Anlagemöglichkeiten proportional zu ihrer Marktkapitalisierung bestehen. Das so entstehende \emph{Marktportfolio}\index{Marktportfolio} ist mit dem individuellen Tangentialportfolio strukturell identisch.
\end{itemize}

\begin{satz}
In einem Markt mit einer risikolosen Anlagemöglichkeit mit Rendite $R_0$ erfüllt die erwartete Rendite $m_p$ eines beliebigen Portfolios $p$ die Gleichung 
\begin{align*}
m_p = R_0 + \beta_{p,M}(m_M-R_0)
\end{align*}
wobei 
\begin{align*}
\beta_{p,M} \da \frac{\Cov(R^{\pi_p}, R^{\pi_M})}{\Var(R^{\pi_M})}
\end{align*}
und $m_M$ die erwartete Rendite des Marktportfolios ist.
\end{satz}

Man kann auch einen Zusammenhang zwischen der erwarteten Rendite einer einzelnen Anlagemöglichkeit und der Rendite des Marktportfolios herstellen:
\begin{align*}
m_i = R_0 + \beta_i(m_M - R_0) \tag{$*$}
\end{align*}
wobei
\[
\beta_i \da \frac{\Cov(R_i,R^{\pi_M})}{\Var(R^{\pi_M}).}
\]
Hier bezeichnet $m_i$ die erwartete Rendite und $\beta_i$ den „Beta“-Faktor der Anlagemöglichkeit~$i$.  Die Gleichung $(*)$ wird als Wertpapiermarktlinie (“security market line”) bezeichnet. Sie zeigt, dass die erwarte Rendite einer Anlagemöglichkeit als lineare Funktion der Kovarianz der Anlagemöglichkeit mit dem gesamten Markt ausgedrückt werden kann.

\subsection{Kurze Diskussion der Annahmen des Erwartungswert-Varianz-Ansatzes}

\begin{itemize}
\item Statisches Problem: Investor investiert am Anfang und ändert sein Portfolio nicht mehr.
\item Risiko wird nur durch die Varianz gemessen.
\item Symmetrische Form der Varianz: Abweichungen nach oben werden genauso bestraft wie Abweichungen nach unten.
\item Die Bevorzugung der erwarteten Rendite und die Aversion der Varianz wird durch die Monotonie und Konkavität der Nutzenfunktion impliziert. Aber für allgemeine Nutzenfunktionen kann erwarteter Nutzen nicht nur über erwartete Rendite und Varianz definiert werden. Sei $\mu\in\cM$ (Wahrscheinlichkeitsmaß mit endlichem Erwartungswert). Konvergenz der Taylorentwicklung und Vertauschung von Summation und Integration liefert 
\[
U(\mu) = \int u(x)\mu(dx) = \int \sum_{k=0}^\infty \frac 1k u^{(k)}(m)(x-m)^k\mu(dx) = u(m) + \frac12 u''(m)\Var(\mu) + R_3(\mu).
\]
Das Restglied $R_3(\mu)$ muss in der Regel auch berücksichtigt werden.

\item Für quadratische Nutzenfunktionen $u(X)=x-\frac\varepsilon2x^2$, $\varepsilon>0$ gilt
\[
U(\mu) = m - \frac\varepsilon2(\Var(\mu) + m^2).
\]
Aber $u'(X) = 1-\varepsilon x \ge 0 \iff x\le \frac1\varepsilon$. 

Und:
\begin{align*}
\ARA(x) = \frac{-u''(x)}{u'(X)} = \frac\varepsilon{1-\varepsilon x},&&
\ARA'(x) = \frac{\varepsilon^2}{(1-\varepsilon x)^2} > 0
\end{align*}
also wachsende absolute Risikoaversion!
\item Für multivariat-normalverteilte Anlagemöglichkeiten, also $R^{\pi}\sim N$, können Präferenzen über Erwartungswert und Varianz ansgedrückt werden.
\end{itemize}

\section{Stochastische Dominanz}
Im vorigen Kapitel wurden Präferenzrelationen über feste Nutzenfunktionen ausgedrückt. Wir wollen nun der Frage nachgehen, ob eine Verteilung (einer risikobehafteten Anlagemöglichkeit) einer anderen Verteilung unabhängig von der Wahl der Nutzenfunktion vorgezogen wird. Wir betrachten $S=\MdR$ als Menge aller möglichen Auszahlungen und betrachten $\cM$ als Menge aller $\mu\in\cM_1(\MdR)$ (Wahrscheinlichkeitsverteilungen) mit wohldefinierter Erwartung \[m(\mu)=\int x\mu(dx).\]

\begin{definition}
Seien $\mu,\nu\in\cM$. Dann dominiert $\mu$ $\nu$ im Sinne der \emph{Stochastischen Dominanz zweiter Ordnung},\index{Stochastische Dominanz!zweiter Ordnung} falls 
\[
\int u d\mu \ge \int u d\nu
\]
für alle Nutzenfunktionen $u$. Wir schreiben dafür $\mu \unisucceq \nu$ (“uniform preference”).
\end{definition}

Das heißt, $\mu \unisucceq \nu$ gilt genau dann, wenn ein risikoaverser Agent $\mu$ $\nu$ vorzieht, unabhängig davon welche Nutzenfunktion er verwendet. In diesem Sinne drückt $\mu\unisucceq \nu$ eine gleichmäßige Präferenz von $\mu\unisucceq\nu$ aus.

\begin{satz}
\label{satz:1.3.2}Für beliebige $\mu,\nu\in\cM$ sind die folgenden Aussagen äquivalent:
\begin{enumerate}
\item $\mu\unisucceq \nu$
\item $\int fd\mu \ge \int f d\nu$ für alle wachsenden, konkaven Funktinen $f$.
\item Für alle $c\in\MdR$ gilt:
\[
\int (c-x)^+\mu(dx) \le \int (c-x)^+\nu(dx)
\]
\item Für die Verteilungsfunktionen $F_\mu$ und $F_\nu$ und alle $c\in\MdR$ gilt:
\[
\int_{-\infty}^c F_{\mu}(x) dx \le \int_{-\infty}^c F_{\nu}(x) dx 
\]
\item Für die Quantilfunktionen $q_\mu$, $q_\nu$ und $0<t\le 1$ gilt:
\[
\int_0^t q_\mu(s)ds \ge \int_0^t q_\nu(s)ds
\]
\end{enumerate}
\end{satz}

\begin{beweis}
\begin{itemize}
\item (4)$\iff$(5): Übungsaufgabe
\item (3)$\iff$(4):
\begin{align*}
\int_{-\infty}^c F_{\mu(y)}dy &= \int_{-\infty}^c \int_{(-\infty,y]} \mu(dz)dy \\
&=\int_\MdR \int_\MdR \mathbf 1_{\{z\le y\le c\}}dy \mu(dz) \\
&=\int_\MdR (c-z)^+ \mu(dz)
\end{align*}
\item (2)$\implies$(3): Die Funktion $f(x) \da -(c-x)^+$ ist konkav und monoton wachsend.
\item (3)$\implies$(2): (Beweisidee) Sei $f$ eine monoton wachsende, konkave Funktion. Dann ist $h\da -f$ konvex und monoton fallend. Schreibe $h$ so um, dass die Voraussetzung (3) angewendet werden kann.

Sei $h'_+$ die monoton wachsende rechtsseitige Ableitung von $h$. Man kann sie als „Verteilungsfunktions“ eines nicht-negativen Maßes $\gamma$ auf $\MdR$ verstehen: Für $y<b$ gilt $h'(b) = h'(y) + \gamma( (y,b])$.

Dann gilt für $x<b$:
\begin{align*}
h(b) &= h(x) + \int_x^b h'(y) dy \\
&=h(x) + h'(b)(b-x) -\int_x^b \int_{(y,b]} \gamma(dz)dy \\
&=h(x) + h'(b)(b-x) - \int_{(-\infty,b]}\int_\MdR \mathbf 1_{\{y:x\le y \le z\}} dy \gamma(dz) \\
&=h(x) + h'(b)(b-x) - \int_{(-\infty,b]} (z-x)^+ \gamma(dz) 
\end{align*}
Dann gilt für alle $-\infty<x<b$:
\begin{align*}
h(x) &= h(b) - h'(b)(b-x)^+ + \int_{(-\infty,b]} (z-x)^+ \gamma(dz) \\
\end{align*}
Berechne nun
\[
\int_{(-\infty,b]} h(x) \mu(dx)
\]
 mit obiger Darstellung von $h$, verwende (3) und lasse $b\to\infty$.
\item (2)$\implies$(1): Klar
\item (1)$\implies$(2): Sei $u_0$ eine Nutzenfunktion, für die $\int u_0d\mu$ und $\int u_0d\nu$ endlich sind, z.B.
\[
u_0(x) = 
\begin{cases}
x - e^{\frac x2} + 1, & x\le 0\\
\sqrt{x + 1} -1, &x\ge 0
\end{cases}
\]
Sei $f$ eine konkave und monoton wachsende Funktion, $\alpha \in [0, 1)$. Dann ist $u_\alpha(x) \da \alpha f(x) + (1-\alpha)u_0(x)$ eine Nutzenfunktion und damit gilt 
\[
\int f d\mu = \lim_{\alpha\to 1} \int u_\alpha d\mu \ge \lim_{\alpha \to 1} \int u_{\alpha}d\nu = \int f d\nu
\]
\end{itemize}
\end{beweis}

\begin{bemerkung}
Sei $\mu \unisucceq \nu$. Wähle $f(x) = x$ als monoton wachsende konkave Funktion. Dann gilt \mbox{$m(\mu) \ge m(\nu)$}.
\end{bemerkung}

Im Folgenden betrachten wir die stochastische Dominanz zweiter Ordnung im Zusammenhang mit Normalverteilungen. Die Dichte einer $N(\mu,\sigma^2)$-verteilten Zufallsvariablen ($\sigma^2>0$) ist
\[
\tilde\varphi(x) = \frac1{\sqrt{2\pi\sigma^2}} \exp\Big(-\frac{(x-\mu)^2}{2\sigma^2}\Big)
\]
und die Verteilungsfunktion ist
\[
\tilde\Phi(x) = \int_{-\infty}^x \tilde\varphi(z) dz.
\]

\begin{satz}
Für zwei Normalverteilungen gilt
\[
N(\mu,\sigma^2) \unisucceq N(\tilde\mu,\tilde\sigma^2) \iff \mu\ge \tilde\mu \text{ und } \sigma^2 \le \tilde\sigma^2
\]
\end{satz}

\begin{beweis}
Übungsblatt.
\end{beweis}

Wir haben in der klassischen Portfoliotheorie gesehen, dass zum Vergleich zweier Portfolios mit bekannter Verteilung der Auszahlung das Erwartungs-Varianz-Kriterium (MV, ”mean variance”) verwendet wird. Dieses basiert auf der Relation
\[
\mu \mvsucceq \nu \iff m(\mu) \ge m(\nu) \text{ und } \Var(\mu) \le \Var(\nu)
\]
wobei $m(\mu) = \int x \mu(dx)$ und $\Var(\mu) = \int (x-m(\mu))^2 \mu(dx)$.

Wir haben gerade gesehen, dass $\mvsucceq$ und $\unisucceq$ äquivalent sind, falls $\mu$ und $\nu$ Normalverteilungen sind. Das gilt aber nicht im Allgemeinen.

\begin{beispiel}
Sei $\mu$ eine Gleichverteilung auf $[-1,1]$, also $m(\mu) = \int_{-1}^1 \frac x2 dx = 0$ und \mbox{$\Var(\mu) = \int_{-1}^{1} \frac{x^2}2 dx - 0^2 = \frac 13$}.
Sei weiter $\nu = p \cdot \delta_{-0.5} + (1-p)\cdot \delta_{2}$ mit $p=\frac45$, also $m(\nu) = -\frac 12 \cdot \frac 45 + 2 \cdot \frac 1 5 = 0$ und $\Var(\nu) = (-\frac 12)^ \cdot \frac 45 + 2^2\cdot \frac 15 = 1$.

Daher ist $m(\mu)=m(\nu)$ und $\Var(\mu) \le \Var(\nu)$, aber 
\begin{align*}
\int (-\frac 12 - x)^+\mu(dx) &= \frac 12 \int_{-1}^{-\frac12} (-\frac 12 - x)dx = \frac 1{16} \\
\int (-\frac 12 - x)^+\nu(dx) &= 0.
\end{align*}
Daher gilt \emph{nicht} $\mu\unisucceq\nu$ (Siehe Theorem \ref{satz:1.3.2} Punkt 2).
\end{beispiel}

\begin{definition}
Eine reellwertige Zufallsvariable $Y$ auf einem Wahrscheinlichkeitsraum $(\Omega, \F, P)$ heißt lognormalverteilt mit Parametern $\alpha\in R$, $\sigma \ge 0$, falls sie dargestellt werden kann als 
\[
Y = \exp(\alpha  + \sigma X)
\]
wobei $X \sim N(0, 1)$.
\end{definition}

\begin{satz}
Seien $\mu, \tilde\mu$ zwei Lognormalverteilungen mit Parametern $(\alpha,\sigma)$ und $(\tilde\alpha,\tilde\sigma)$. Dann gilt 
\[
\mu \unisucceq \tilde\mu \iff \sigma^2 \le \tilde\sigma^2 \text{ und } \alpha + \frac{\sigma^2}2 \ge \tilde\alpha + \frac{\tilde\sigma^2}2.
\]
\end{satz}

\begin{definition}
\label{def:1.3.8}Seien $\mu,\nu$ zwei beliebige Wahrscheinlichkeitsmaße auf $\MdR$. Dann dominiert $\mu \, \nu$ im Sinne der \emph{Stochastischen Dominanz erster Ordnung},\index{Stochastische Dominanz!erster Ordnung} falls 
\[
\int f d\mu \ge \int fd\nu
\]
für alle beschränkten, monoton wachsenden Funktionen $f\in C(\MdR)$. Wir schreiben dafür $\mu\monsucceq \nu$ (“monotone preference”).
\end{definition}

\begin{satz}
\label{satz:1.3.9}Für $\mu,\nu \in M_1(\MdR)$ sind die folgenden Aussagen äquivalent:
\begin{enumerate}
\item $\mu\monsucceq\nu$
\item Die Verteilungsfunktionen von $\mu$ und $\nu$ erfüllen $F_\mu(x) \le F_\nu(x)$ für alle $x\in\MdR$.
\item Jedes Paar von Quantilfunktionen von $\mu$ und $\nu$ erfüllt $q_\mu(t) \ge q_\nu(t)$ für fast alle $t\in(0, 1)$.
\item Es existiert ein Wahrscheinlichkeitsraum $(\Omega,\F, P)$ mit Zufallsvariablen $X_\mu, X_\nu$ mit Verteilungen $\mu, \nu$, so dass $P$-fast-sicher $X_\mu > X_\nu$ gilt.
\end{enumerate}
Insbesondere gilt \[
\mu\monsucceq\nu \implies \mu\unisucceq\nu.
\]
Die Menge aller beschränkten, monoton wachsenden, stetigen Funktionen in Definition \ref{def:1.3.8} kann ersetzt werden durch die Menge aller monoton wachsenden Funktionen, für die beide Integrale wohldefiniert sind.
\end{satz}

\begin{beweis}
Siehe Föllmer-Schied, Theorem 2.70
\end{beweis}

\begin{center}
\begin{tikzpicture}
\draw(-0.2,6) node [left] {$1$} -- (0.2,6);
\draw[->] (0,-0.2) -- (0,6.5)  node[right] {$F(x)$};
\draw[->] (-0.2,0) -- (10,0)  node[below] {$x$};
\draw (-0.4,0.1) .. controls (8,1) and (2,5)  .. (10,5.5) node[above] {$F_\nu$};
\draw (-0.4,0.08) .. controls (9,0.5) and (4,4.5)  .. (10,5.4) node[below] {$F_\mu$};
\draw (8,3) node {$\mu\monsucceq \nu$};
\end{tikzpicture}
\end{center}


\section{Risikomaße}
\subsection{Kohärenz}

Sei $\Omega$ eine gegebenene Menge, die verschiedene Szenarien beschreibt. Wir beschreiben eine Finanzposition durch eine Abbildung $X:\Omega\to \MdR$, wobei $X(\omega)$ der diskontinierte Nettowert einer Position am Ende einer Handelsperiode ist, wenn Szenario $\omega\in\Omega$ eingetreten ist. Unser Ziel ist es nun, das Risiko von $X$ durch eine Zahl $\rho(X)$ zu quantifizieren, wobei $X$ zu einer Klasse von Finanzpositionen $\cX$ gehört. $\cX$ sei ein linearer Raum von beschränkten Funktionen, der auch die Konstanten enthält.

\begin{definition}
Eine Abbildung $\rho:\cX\to\MdR$ wird \emph{monetäres Risikomaß}\index{Risikomaß!monetäres} genannt, falls es die folgenden zwei Bedingungen für alle $X,Y\in\cX$ erfüllt:
\begin{itemize}
\item Monotonie: Falls $X\le Y$, dann gilt $\rho(X)\ge \rho(Y)$.
\item Translationsinvarianz, “cash invariance”: Für $m\in\MdR$ gilt $\rho(X + m) = \rho(X) - m$.
\end{itemize}
\end{definition}

Diesen Eigenschaften können folgende Bedeutungen im Finanz-Kontext zugewiesen werden:
\begin{itemize}
\item Montonie: Das Downside-Risiko einer Position ist reduziert, wenn das Auszahlungsprofil größer ist.
\item Translationsinvarianz: $\rho(X)$ kann als Kapitalanforderung interpretiert werden, das heißt $\rho(X)$ ist der Wert, der zur Position $X$ hinzugefügt werden muss, um diese Position akzeptabel aus der Perspektive einer Aufsichtsinstanz zu machen. Das heißt, wenn die Menge $m$ zu der Position hinzugefügt wird und risikolos investiert wird, reduziert das die Kapitalanforderung um den gleichen Betrag.
\end{itemize}

Aus der Translationsinvarianz folgt sofort $\rho(X + \rho(X)) = \rho(X) - \rho(X) = 0$ und $\rho(m) = \rho(0+m) = \rho(0) - m$ für alle $m\in\MdR$. Manchmal fordert man die Normalisierung $\rho(0)=0$.

\begin{satz}
Jedes monetäre Risikomaß $\rho$ ist Lipschitz-stetig im Bezug auf die Supremumsnorm $\|\cdot\|$, das heißt $|\rho(X) -\rho(Y)|\le \|X-Y\|$ wobei $\|X\| = \sup_{\omega\in\Omega}|X(\omega)|$. 
\end{satz}

\begin{beweis}
Es gilt $X\le Y+\|X-Y\|$. Aus der Monotonie folgt $\rho(Y+\|X-Y\|) \le \rho(X)$ und aus der Translationsinvarianz $\rho(Y)-\|X-Y\| \le \rho(X)$. Vertausche nun $X$ und $Y$ und führe dieselbe Argumentation durch, woraus die Behauptung folgt.
\end{beweis}

\begin{definition}
Ein monetäres Risikomaß $\rho:\cX \to \MdR$ heißt \emph{konvexes Risikomaß},\index{Risikomaß!konvexes} falls 
\[
\rho(\lambda X + (1-\lambda)Y) \le \lambda \rho(X) + (1- \lambda)\rho(Y)
\]
für $0\le \lambda \le 1$, $X,Y\in\cX$.
\end{definition}

Die Bedeutung dieser Definition ist: Angenommen ein Investor kann zwischen zwei Investitionsstrategien wählen. Die eine liefert Auszahlung $X$, die andere $Y$. Wenn der Investor nun diversifiziert, das heißt nur einen Anteil $\lambda$ in der ersten Investitionsmöglichkeit investiert und den restlichen Anteil $(1-\lambda)$ in die zweite, erhält er $\lambda X + (1-\lambda)Y$. Die Annahme der Konvexität bedeutet letztendlich, dass Diversifikation nicht das Risiko erhöhen sollte.

Falls $\rho$ konvex und normalisiert ist, dann gilt $\rho(\lambda X)\leq \lambda \cdot \rho(X)$ für $0\leq\lambda\leq 1$, $\rho(\lambda X)\geq \lambda \cdot \rho(X)$ für $\lambda\geq 1$.

\begin{definition}
Ein konvexes Risikomaß heißt \emph{kohärentes Risikomaß}\index{kohärentes Risikomaß}, falls es positiv homogen ist, also für alle $\lambda\geq 0$ gilt: 
\[
\rho(\lambda X)=\lambda\cdot \rho (X).
\]
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item Wenn ein monetäres Risikomaß positiv homogen ist, dann ist es normalisiert, da $\rho(0)=\rho(0+0)=\rho(2\cdot 0)=2\cdot \rho(0)$ und damit $\rho(0)=0$.
\item Unter der Annahme der positiven Homogenität ist die Konvexität äquivalent zur Subadditivität $\rho(X+Y)\leq \rho(X)+\rho (Y)$.
\item Die Subadditivität erlaubt es, das Risikomanagement zu dezentralisieren. Das Risiko der Gesamtposition ist nach oben durch die Summe der individuellen Risiken begrenzt. Diese können einzeln vorgegeben werden.
\item In vielen Situationen wächst das Risiko nicht linear zu der Höhe der Investition. Daher ist häufig positive Homogenität eine zu starke Forderung, weshalb häufig auch konvexe statt kohärenter Risikomaße betrachtet werden.
\end{itemize}
\end{bemerkung}

\begin{definition}
Sei $\rho:\mathcal{X}\to\mathbb{R}$ ein monetäres Risikomaß. Wir bezeichnen die Menge
\[
\mathcal{A}_\rho\da\{x\in \mathcal{X}:\, \rho(X)\leq 0\}
\]
als die \emph{Akzeptanzmenge}\index{Akzeptanzmenge} von $\rho$.

$\mathcal{A}_\rho$ beschreibt die Positionen, die akzeptabel sind in dem Sinne, dass sie kein zusätzliches Kapital erfordern.
\end{definition}

\begin{satz}
Sei $\rho$ ein monetäres Risikomaß mit Akzeptanzmenge $\mathcal{A}_\rho=\mathcal{A}$. Dann gilt:
\begin{enumerate}
\item $\mathcal{A}\neq\emptyset$ und erfüllt

\begin{enumerate}
\item $\inf\{m\in\mathbb{R}:\, m\in\mathcal{A}\}>-\infty$
\item $X\in\mathcal{A},\, Y\in\mathcal{X}, \, Y\geq X \Rightarrow Y\in\mathcal{A}$

Außerdem hat $\mathcal{A}$ die Eigenschaft: Für $X\in\mathcal{A},\, Y\in\mathcal{X}$ ist die Menge $\{\lambda\in[0, 1]:\, \lambda X+(1-\lambda) Y\in\mathcal{A}\}$ abgeschlossen in $[0, 1]$.
\end{enumerate}

\item $\rho$ kann von $\mathcal{A}$ bestimmt werden: $\rho(X)=\inf\{m:\, m+X\in\mathcal{A}\}$.
\item $\rho$ ist ein konvexes Risikomaß $\Leftrightarrow$ $\mathcal{A}$ ist konvex.
\item $\rho$ ist positiv homogen $\Leftrightarrow$ $\mathcal{A}$ ist ein Kegel.

$\rho$ ist kohärent $\Leftrightarrow$ $\mathcal{A}$ ist ein konvexer Kegel.
\end{enumerate}
\end{satz}


\begin{beweis}

\begin{enumerate}
\item Sei $X\in\mathcal{X}$. Dann ist $\rho(X+\rho(X))=\rho(X)-\rho(X)=0\leq 0$. $\Rightarrow$ $X+\rho(X)\in\mathcal{A}$

\begin{enumerate}
\item $\inf\{m\in\mathbb{R}:\, m\in\mathcal{A}\}=\inf\{m\in\mathbb{R}:\, \rho(m)\leq 0\}=\inf\{m\in\mathbb{R}:\, \rho(0)\leq m\}=\rho(0)>-\infty$
\item $Y\geq X \Rightarrow \rho(Y)\leq \rho(X) \leq 0 \Rightarrow Y\in\mathcal{A}$

Die Funktion $\lambda\mapsto \rho(\lambda X+(1-\lambda)Y)$ ist stetig (Satz 1.4.2). Daher ist die Menge aller $\lambda\in[0, 1]$ mit $\rho(\lambda X+(1-\lambda) Y)\leq 0$ abgeschlossen.
\end{enumerate}

\item Sei $X\in\mathcal{X}$. Aus der Translationsinvarianz folgt $\inf\{m\in\mathbb{R}:\, m+X\in\mathcal{A}_\rho\}=\inf\{m\in\mathbb{R}:\, \rho(m+X)\leq 0\}=\inf\{ m\in\mathbb{R}:\, \rho(X)\leq m\}=\rho(X)$.

\item Sei $\rho$ konvex. Seien $X,Y\in\mathcal{A}$, $\lambda\in[0, 1]$.

$\rho(\lambda X+(1-\lambda) Y)\leq \lambda\cdot \underbrace{\rho(X)}_{\leq 0}+ (1-\lambda) \underbrace{\rho(Y)}_{\leq 0}\leq 0 \Rightarrow \lambda X+(1-\lambda) Y \in\mathcal{A}$.

Sei $\mathcal{A}$ konvex, $X,Y\in\mathcal{X},\, \lambda\in[0, 1]$.

Dann ist $X+\rho(X),Y+\rho(Y)\in\mathcal{A}$ und damit
$\lambda(X+\rho(X))+(1-\lambda)(Y+\rho(Y))\in\mathcal{A}$. Wegen der Translationsinvarianz gilt dann
\begin{align*}
0 &\geq\rho(\lambda(X+\rho(X))+(1-\lambda)(Y+\rho(Y))) \\
&=\rho(\lambda X+(1-\lambda)Y+(\lambda \rho(X)+(1-\lambda) \rho(Y))) \\
&=\rho(\lambda X+(1-\lambda)Y)-(\lambda \rho(X)+(1-\lambda)\rho(Y)) \\
\intertext{also gilt}
\rho(\lambda X+(1-\lambda)Y)&\leq \lambda \rho(X)+(1-\lambda)\rho(Y)
\end{align*}
Damit ist $\rho$ konvex.

\item Sei $\rho$ positiv homogen. Sei $X\in\mathcal{A},\, \lambda\geq 0$. Dann gilt: $\rho(\lambda X)=\lambda \rho(X)\leq 0$ und daher $\lambda X\in\mathcal{A}$.

Sei $\mathcal{A}$ ein Kegel, $X\in\mathcal{X},\, \lambda\geq 0$. Dann ist $X+\rho(X)\in\mathcal{A}$ und wegen der Kegeleigenschaft $\lambda(X+\rho(X))=\lambda X+\lambda \rho(X)\in\mathcal{A}$. Daher folgt mit der Translationsinvarianz $\rho(\lambda X+\lambda \rho(X))=\rho(\lambda X)-\lambda \rho(X)\leq 0 \Rightarrow \rho(\lambda X)\leq \lambda \rho(X)$.

Wir zeigen nun die umgekehrte Ungleichung: Sei $X\in\mathcal{X},\, \epsilon>0,\, \lambda\geq 0$. Dann ist $\rho(X)>\rho(X)-\epsilon$ und wegen der Translationsinvarianz $0<\rho(X)-(\rho(X)-\epsilon)=\rho(X+\rho(X)-\epsilon)$. Daher ist $X+(\rho(X)-\epsilon)\notin\mathcal{A}$. Wegen Kegeleigenschaft ist $\lambda(X+(\rho(X)-\epsilon))\notin\mathcal{A}$. Daher $0<\rho(\lambda(X+(\rho(X)-\epsilon)))=\rho(\lambda X)-\lambda(\rho(X)-\epsilon) \Rightarrow \rho(\lambda X)>\lambda(\rho(X)-\epsilon)$. Für $\epsilon \downarrow 0$ folgt die Behauptung.

Sei $\rho$ kohärent, das heißt konvex ($\Rightarrow$ $\mathcal{A}$ konvex) und positiv homogen ($\Rightarrow$ $\mathcal{A}$ Kegel). Dann ist $\mathcal{A}$ ein konvexer Kegel.

Rückrichtung wie vorher!
\end{enumerate}
\end{beweis}

Umgekehrt kann man auch eine Klasse $\mathcal{A}\subset \mathcal{X}$ von akzeptierten Positionen vorgeben und als primäres Objekt betrachten. Für eine Position $X\in\mathcal{X}$ kann man dann eine Kapitalanforderung als minimalen Betrag $m$, der $m+X$ akzeptal definiert: $\rho_\mathcal{A}(X)\da\inf\{m\in\mathbb{R}:\, m+X\in\mathcal{A}\}$.

\begin{satz}
Sei $\mathcal{A}$ eine nichtleere Teilmenge von $\mathcal{X}$ mit den zwei Eigenschaften
\[
\inf\{m\in\mathbb{R}:\, m\in\mathcal{A}\}>-\infty \quad \text{ und } \quad X\in\mathcal{A},\, Y\in\mathcal{X},\, Y\geq X \Rightarrow Y\in\mathcal{A}.
\]
Dann hat $\rho_\mathcal{A}$ die folgenden Eigenschaften:
\begin{enumerate}
\item $\rho_\mathcal{A}$ ist ein monetäres Risikomaß.
\item Falls $\mathcal{A}$ konvex, dann ist $\rho_\mathcal{A}$ konvex.
\item Falls $\mathcal{A}$ ein Kegel ist, dann ist $\rho_\mathcal{A}$ positiv homogen.

Insbesondere: $\rho_\mathcal{A}$ ist kohärentes Risikomaß, wenn $\mathcal{A}$ ein konvexer Kegel ist.
\item $\mathcal{A}$ ist Teilmenge von $\mathcal{A}_{\rho_\mathcal{A}}$. Falls für $X\in\mathcal{A},\, Y\in\mathcal{X}$ die Menge 
\[
\{\lambda\in [0, 1]:\, \lambda X+(1-\lambda)Y\in\mathcal{A}\}
\]
abgeschlossen in $[0, 1]$ ist, dann ist $\mathcal{A}=\mathcal{A}_{\rho_\mathcal{A}}$.
\end{enumerate}
\end{satz}

\begin{beweis}
Föllmer \& Schied, Proposition 4.7
\end{beweis}

\begin{beispiel}
Das Worst-case-Risikomaß $\rho_{\max}$ ist definiert als $\rho_{\max}=-\inf\limits_{\omega\in\Omega} X(\omega)$ für alle $X\in\mathcal{X}$.

$\rho_{\max}$ ist die kleinste obere Schranke für einen Verlust, der in einem beliebigen Szenario passieren kann.

Für die Akzeptanzmenge gilt: $\mathcal{A}_{\rho_{\max}}=\{X\in\mathcal{X}:\, \rho_{\max}(X)\leq 0\}=\{X\in\mathcal{X}:\, -\inf\limits_{\omega\in\Omega} X(\omega) \leq 0\}=\{X\in\mathcal{X}:\, \inf\limits_{\omega\in\Omega} X(\omega) \geq 0\}$, das heißt $\mathcal{A}_{\rho_{\max}}$ ist der konvexe Kegel aller nicht-negativen Funktion in $\mathcal{X}$. Daher ist $\rho_{\max}$ ein kohärentes Risikomaß.

Es ist das konservativste Risikomaß in dem Sinne, dass für jedes normalisierte Risikomaß $\rho$ auf $\mathcal{X}$ gilt: $X\geq\inf\limits_{\omega\in\Omega} X(\omega)$, daher $\rho(X)\leq \rho(\inf\limits_{\omega\in\Omega} X(\omega))=\rho(0)-\inf\limits_{\omega\in\Omega} X(\omega)=\rho_{\max}(X)$.
\end{beispiel}

\subsection{Value at Risk}

Ein häufiger Ansatz der Risikomessung von Finanzpositionen $X$ besteht darin, ein Quantil der Verteilung von $X$ unter einem Wahrscheinlichkeitsmaß $ P$ zu bestimmen. Sei $X$ Zufallsvariable auf $(\Omega,\mathcal{F}, P)$, $\lambda\in[0, 1]$. Das $\lambda$-Quantil von $X$ ist eine reelle Zahl $q$, so dass $ P(X\leq q) \geq \lambda,\,  P(X< q) \leq \lambda$.

Die Menge aller $\lambda$-Quantile von $X$ ist ein Intervall $[q_X^-(\lambda),q_X^+(\lambda)]$ mit 
\begin{align*}
q_X^-(\lambda)&=\sup\{x:\,  P(X<x)<\lambda\}=\inf\{x:\,  P(X\leq x)\geq \lambda\} \\
q_X^+(\lambda)&=\inf\{x:\,  P(X\leq x)>\lambda\}=\sup\{x:\,  P(X < x)\leq \lambda\}
\end{align*}
und mit Verteilungsfunktion $F_X(x)= P(X\leq x)$ gilt:
\begin{align*}
q_X^-(\lambda)&=\inf\{x:\, F_X(x)\geq \lambda\}\\
q_X^+(\lambda)&=\inf\{x:\, F_X(x)> \lambda\}.
\end{align*}

In dieser Lektion werden wir uns auf Eigenschaften von $q_X^+(\lambda)$ konzentrieren, wobei $X$ eine Finanzposition beschreibt.

\begin{definition}
Sei $\lambda\in[0, 1]$. Wir definieren für eine Finanzposition $X$ den Value at Risk zum Niveau $\lambda$ als 
\[
\VatR_\lambda(X) \da -q_X^+(\lambda)=q_{-X}^-(1-\lambda)=\inf\{m:\,  P(X+m<0)\leq \lambda\}.
\]
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item Im Finanzkontext ist $\VatR_\lambda(X)$ die kleinste Kapitalmenge, die, sobald sie zu $X$ hinzugefügt und risikolos investiert wird, die Wahrscheinlichkeit eines negativen Endvermögens unter dem Niveau $\lambda$ hält.
\item $\VatR_\lambda$ kontrolliert nur die Wahrscheinlichkeit eines Verlusts, aber nicht dessen Größe, falls er eintritt.
\item $\VatR_\lambda$ ist ein monetäres Risikomaß auf $\cX=L^0$ (Menge aller $P$-fast-sicheren endlichen Zufallsvariablen) und ist positiv homogen.
\begin{beweis}
\begin{itemize}
\item Monotonie: Sei $X\le Y$. Dann ist $F_X(x) = P(X\le x) \ge P(Y\le x) = F_Y(x)$ und $q_X^+(\lambda) \le q_Y^+(\lambda)$ (Siehe Satz \ref{satz:1.3.9}). Daher gilt $\VatR_\lambda(Y) = -q_Y^+(\lambda) \le -q_X^+(\lambda) = \VatR_\lambda(X)$.
\item Translationsinvarianz: Sei $x\in\MdR$: 
\begin{align*}
\VatR_\lambda(X+x) &= \inf\{m: P(X + x + m < 0) \le \lambda \} \\
&= \inf\{\tilde m - x : P(X + x + \tilde m -x < 0)\le \lambda \} \\
&= \inf\{\tilde m - x : P(X+\tilde m < 0 ) \le \lambda\} \\
&= \VatR_\lambda(X) - x
\end{align*}
\item Positive Homogentiät: Sei $\alpha>0$.
\begin{align*}
\VatR_\lambda(X) &= \inf\{m:P(\alpha X+m<0)\le \lambda\} \\
&= \inf\{\alpha\tilde m : P(\alpha X + \alpha\tilde m<0) \le \lambda\} \\
&= \inf\{\alpha\tilde m : P(X+\tilde m < 0 ) \le \lambda\} \\
&= \alpha\VatR_\lambda(X)
\end{align*}
\end{itemize}
\end{beweis}

\item $\VatR_\lambda$ ist in der Regel nicht konvex und damit kein konvexes Risikomaß. Das heißt, dass der Value at Risk manchmal Diversifikation bestraft.
\end{itemize}
\end{bemerkung}

\begin{beispiel}
Wir betrachten zwei Finanzpositionen $X_1$, $X_2$:
\begin{align*}
X_1 =
\begin{cases}
1& \text{mit Wahrscheinlichkeit } 0,99\\
-1& \text{mit Wahrscheinlichkeit } 0,01\\
\end{cases},
&&
X_2 =
\begin{cases}
1& \text{mit Wahrscheinlichkeit } 0,99\\
-10^{10} & \text{mit Wahrscheinlichkeit } 0,01\\
\end{cases}
\end{align*}
Dann ist $\VatR_{0,01}(X_1) = \inf\{m: P(m + X_1<0) \le 0.01\} = -1 = \VatR_{0,01}(X_2)$. Der Value at Risk unterscheidet nicht zwischen diesen beiden Positionen, obwohl $X_2$ im Falle eines Verlustes den viel höheren Verlust erleidet. Beide Positionen sind akzeptabel in dem Sinne, dass sie keinen positiven $\VatR$ haben.
\end{beispiel}

% \begin{center}
% \begin{tikzpicture}
% \draw[->] (0,-0.2) -- (0,6.5)  node[right] {$F(x)$};
% \draw[->] (-0.2,0) -- (10,0)  node[below] {$x$};
% \draw(2,-0.2) node [below] {$-1$} -- (2,0.2);
% \draw(5,-0.2) node [below] {$0$} -- (5,0.2);
% \draw(8,-0.2) node [below] {$1$} -- (8,0.2);
% \draw (2,1) -- (8,1);
% \draw (8,5) -- (10,5);
% \end{tikzpicture}
% \end{center}

\begin{beispiel}
Wir betrachten zwei unabhängige Finanzpositionen $X_1$ und $X_2$, wobei 
\[
X_i=
\begin{cases}
1,& \text{mit Wahrscheinlichkeit } p=0,5\\
-1,& \text{mit Wahrscheinlichkeit} (1-p)=0,5
\end{cases}
\]
für $i=1,2$.
Dann ist das diversifizierte Portfolio gegeben durch 
\[
\frac {X_1+X_2}2 = 
\begin{cases}
1,& \text{mit Wahrscheinlichkeit } p\cdot p=0,25\\
0,& \text{mit Wahrscheinlichkeit } 2\cdot p(1-p) = 0,5\\
-1,& \text{mit Wahrscheinlichkeit} (1-p)(1-p)=0,25.
\end{cases}
\]
Dann ist $\VatR_{0,5}(X_i) = -1$ für $i=1,2$ und $\VatR_{0,5}(\frac12(X_1+X_2))=0$. Das heißt, nach dem Value at Risk ist das diversifizierte Portfolio das riskantere Portfolio, verglichen zu den Einzelpositionen. Insbesondere gilt:
\[
\frac12\VatR_{0,5}(X_1) + \frac 12\VatR_{0,5}(X_2) = -1 \not\ge 
\VatR_{0,5}(\frac 12 X_1 + \frac 12 X_2)
\]
\end{beispiel}

\subsection{Average Value at Risk}
Im Folgenden betrachten wir ein Risikomaß, das über den Value at Risk definiert wird, aber im Gegensatz dazu ein kohärentes Risikomaß ist.
\begin{definition}
Der Average Value at Risk zum Niveau $\lambda\in(0, 1)$ einer Position $x\in\cX$ ist 
\[
\AVatR_\lambda(X) = \frac1\lambda \int_0^\lambda \VatR_\gamma(X)d\gamma
\]
\end{definition}

Daraus bekommt man sofort die Darstellung
\[
\AVatR_\lambda(X) = -\frac1\lambda \int_0^\lambda q_X^+(\gamma)d\gamma.
\]

\begin{bemerkung}
Im Satz \ref{satz:1.3.2} haben wir gesehen, dass
\[
\mu\unisucceq \nu \iff \forall t\in(0, 1]: \int_0^t q_\mu(s)ds \ge \int_0^t q_\nu(s)ds
\]
für Quantilfunktionen $q_\mu,q_\nu$ von $\mu,\nu$. Seien nun $X_\mu,X_\nu$ Zufallsvariablen mit Verteilung $\mu,\nu$.
\[
\mu\unisucceq \nu \iff \forall \lambda\in(0, 1]: \AVatR_\lambda(X_\mu) \le \AVatR_\lambda(X_\nu)
\]
\end{bemerkung}

\begin{lemma}
\label{lemma:1.4.16}Sei $\lambda\in(0, 1)$ und $q$ ein $\lambda$-Quantil von $X$. Dann gilt:
\[
\AVatR_\lambda(X) = \frac1\lambda E[(q-X)^+] - q = \frac1\lambda \inf_{r\in\MdR}(E[(r-X)^+]-\lambda r)
\]
\end{lemma}
\begin{beweis}
Übungsblatt.
\end{beweis}

\begin{satz}
Für $\lambda\in(0, 1)$ ist $\AVatR$ ein kohärentes Risikomaß.
\end{satz}
\begin{beweis}
Monotonie, Translationsinvarianz und positive Homogenität rechnet man leicht nach. Wir zeigen nur die Subadditivität, also $\AVatR_\lambda(X+Y) \le \AVatR_\lambda(X) + \AVatR_\lambda(Y)$.

Aus Lemma \ref{lemma:1.4.16} folgt: 
\begin{align*}
\AVatR_\lambda(X) &= \frac1\lambda E[(q-X)^+] -q \\
&= \frac1\lambda E[(q-X)1_{\{X<q\}}]-q \\
&= \frac1\lambda (qP(X<q) + E[(-X)1_{\{X<q\}}])-q \\
&= -\frac1\lambda E[X 1_{\{X<q\}} + q(\lambda - P(X<q))]
\end{align*}
Betrachte die Zufallsvariable \[1_{\{X<q\}}^{(\lambda)}\da \frac1\lambda (1_{\{X<q\}} + \kappa 1_{\{X=q\}}),\] wobei $q$ ein $\lambda$-Quantil von $X$ ist und
\[
\kappa = 
\begin{cases}
0, &\text{falls } P(X=q)=0 \\
\frac{\lambda-P(X<q)}{P(X=q)}, & \text{sonst.}
\end{cases}
\]

Dann ist 
\begin{align*}
E[-X\cdot 1_{\{X<q\}}^{(\lambda)}] &= \int (-X) \cdot \frac1\lambda (1_{\{X<q\}} + \kappa 1_{\{X=q}\}) dP \\
&= -\frac1\lambda E[X1_{\{X<q\}}] - \frac\kappa\lambda E[X \cdot 1_{\{X=q\}}] \\
&= -\frac1\lambda E[X1_{\{X<q\}}] - \frac\kappa\lambda qP(X=q) \\
&= \AVatR_\lambda(X)
\end{align*}

Wir verwenden nun diese Darstellung, um die Subadditivität zu zeigen. Seien $q_X$, $q_Y$ und $q_{X+Y}$ $\lambda$-Quantile von $X$, $Y$ und $X+Y$. Dann gilt:
\begin{align*}
&\AVatR_\lambda(X) + \AVatR_\lambda(Y) - \AVatR_\lambda(X+Y) \\
=&E[-X 1_{\{X<q_X\}}^{(\lambda)}] + E[-Y 1_{\{Y<q_Y\}}^{(\lambda)}] - E[-(X+Y) 1_{\{(X+Y)<q_{(X+Y)}\}}^{(\lambda)}]\\
=&E[X(1_{\{X+Y<q_{X+Y}\}}^{(\lambda)} - 1_{\{X<q_X\}}^{(\lambda)})]
+ E[Y(1_{\{X+Y<q_{X+Y}\}}^{(\lambda)} - 1_{\{Y<q_Y\}}^{(\lambda)})] \\
\ge& q_X E[1_{\{X+Y<q_{X+Y}\}}^{(\lambda)} - 1_{\{X<q_X\}}^{(\lambda)}]
+ q_Y E[1_{\{X+Y<q_{X+Y}\}}^{(\lambda)} - 1_{\{Y<q_Y\}}^{(\lambda)}] \\
=& q_X(1-1) + q_Y(1-1)\\
=& 0
\end{align*}
Hierbei haben wir verwendet, dass
\begin{itemize}
\item $E[1_{\{X<q_X\}}^{(\lambda)}] = 1$ 
\item $1_{\{X+Y<q_{X+Y}\}}^{(\lambda)} - 1_{\{X<q_X\}}^{(\lambda)} \ge 0$ für $X>q_X$
\item $1_{\{X+Y<q_{X+Y}\}}^{(\lambda)} - 1_{\{X<q_X\}}^{(\lambda)} \le 0$ für $X\le q_X$
\end{itemize}
\end{beweis}

\begin{bemerkung}
\begin{enumerate}
\item Seien $P$ und $Q$ zwei Wahrscheinlichkeitsmaße, die auf der gleichen $\sigma$-Algebra $\cF$ definiert sind. $Q$ ist \emph{absolut stetig}\index{absolut stetig} bezüglich $P$ (Notation: $Q\ll P$), falls für alle $A\in\cF$ mit $P(A)=0$ gilt $Q(A)=0$.
\item Für $Q\ll P$ nennt man die $\cF$-messbare Funktion (Zufallsvariable) $X$ mit 
\[
\forall A\in\cF: Q(A) = \int_A X dP
\]
die \emph{Radon-Nikodym-Ableitung}.\index{Radon-Nikodym-Ableitung} Schreibweise:
\[
\frac{dQ}{dP} = X.
\]
\item Falls $Q\ll P$ und $P\ll Q$ gilt, nennt man $P$ und $Q$ \emph{äquivalente Maße}\index{äquivalente Maße} und schreibt $P\sim Q$.
\end{enumerate}
\end{bemerkung}

\begin{satz}
Für $\lambda\in(0, 1)$ hat der $\AVatR_\lambda(X)$ die Form
\[
\AVatR_\lambda(X) = \max_{Q\in Q_\lambda}E_Q[-X],
\]
wobei $Q_\lambda$ die Menge aller Wahrscheinlichkeitsmaße ist, die absolut stetig bezüglich $P$ sind und deren Dichte durch $\frac1\lambda$ beschränkt ist. Das Maximum wird von dem Maß $\tilde Q$ angenommen mit
\[
\frac{d\tilde Q}{dP} = 1_{\{X<q\}}^{(\lambda)}.
\]
\end{satz}
\begin{beweis}
Föllmer und Schied, Beweis von Theorem 4.47.
\end{beweis}

Man kann für geeignete Räume zeigen, dass ein Risikomaß $\rho$ genau dann kohärent ist, wenn es als $\rho(X) = \sup_{Q\in\mathcal Q}E_Q[-X]$ dargestellt werden kann. (Siehe Föllmer und Schied, Proposition 4.14)

\chapter{Bewertung von Derivaten in diskreter Zeit}
\section{Wahrscheinlichkeitstheoretische Grundlagen}
\subsection{Bedingte Erwartungswerte}

Sei $(\Omega, \cF, P$) ein Wahrscheinlichkeitsraum. Für $A,B\in\cF$ mit $P(B)>0$ ist die \emph{bedingte Wahrscheinlichkeit}\index{bedingte Wahrscheinlichkeit} von $A$ gegeben $B$ definiert durch
\[
P(A\mid B) = \frac{P(A\cap B)}{P(B)}.
\]

Sei $X:\Omega \to \MdR$ eine Zufallsvariable.
\begin{definition}
Der \emph{bedingte Erwartungswert}\index{bedingte Erwartungswert} von $X$ gegeben $B$ ist
\[
E[X\mid B] = \frac{E[X \cdot 1_B]}{P(B)} = \frac{1}{P(B)} \int_B X dP.
\] 
Falls $X$ diskret mit Werten $x_1,\ldots,x_n$ ist, gilt
\[
E[X\mid B] = \sum_{k=1}^n x_k \frac{P(\{X=x_k\}\cap B)}{P(B)}
= \sum_{k=1}^{n} x_k P(\{X=x_k\}\mid B).
\]
Falls $X$ absolut stetig ist mit Dichte $f_X$, gilt 
\[
E[X\mid B] = \frac{1}{P(B)} \int_B XdP
=\frac{1}{P(B)} \int_B x\cdot f_X(x) dx.
\]
\end{definition}

\begin{beispiel}[Würfel]
Seien $\Omega = \{1,\ldots,6\}$, $\cF = \mathcal P(\Omega)$ und $P(\{\omega\})=\frac 16$. Sei $X(\omega)=\omega$, $A\da \{1,2\}$, $B \da A^c = \{3,4,5,6\}$. Dann gilt 
\begin{align*}
E[X\mid A] &= \frac1{P(A)} \int_A XdP = \frac1{\frac13} \big(1\cdot \frac 16 + 2\cdot\frac16\big) = \frac 32 \\
E[X\mid B] &= \frac1{P(B)} \int_B XdP = \frac1{\frac23} \big(3\cdot \frac 16 + 4\cdot\frac16 + 5\cdot\frac16 + 6\cdot\frac16\big) = \frac 92
\end{align*}
\end{beispiel}

Sei $Y:\Omega\to\MdR$ eine diskrete Zufallsvariable mit Werten $y_1,\ldots,y_n$ auf den Mengen $A_1,\ldots,A_n$, das heißt $A_i \da \{\omega\in\Omega: Y(\omega) = y_i\}$, $i=1,\ldots n$. Dann ist $(A_i)$ eine Zerlegung von $\Omega$, das heißt $A_i\cap A_j= \emptyset$ für $i\ne j$ und $\bigcup_{i=1}^n A_i=\Omega$. Über diese Zerlegung kann eine $\sigma$-Algebra definiert werden: $\sigma(Y)=\sigma(A_1,\ldots,A_n)=\{\text{alle möglichen Vereinigungen der $A_i$}\}$.

\begin{definition}
Sei $X:\Omega \to \MdR$ mit $E[|X|]<\infty$. Der bedingte Erwartungswert von $X$ gegeben $Y$ ist die (diskrete) Zufallsvariable 
\[
E[X\mid Y](\omega) = \sum_{i=1}^n E[X\mid A_i] \cdot 1_{A_i}(\omega).
\]
Man schreibt statt $E[X\mid Y]$ auch $E[X\mid \sigma(Y)]$.
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item $E[X\mid Y]$ kann als Approximation von $X$ verstanden werden.
\item Für konstante $Y$ („schlechteste“ Approximation) ist $E[X\mid Y] = E[X]$.
\item $E[X\mid Y](\omega) = E[X\mid A_i]$, falls $\omega\in A_i$.
\item $E[X\mid Y] = g(Y)$, wobei $g(Y) = \sum_{i=1}^n E[X\mid Y=y_i]1_{y_i}(Y)$.
\end{itemize}
\end{bemerkung}

Im Folgenden wird der bedingte Erwartungswert bezüglich einer beliebigen $\sigma$-Algebra definiert. Sei $(\Omega,\cF,P)$ ein Wahrscheinlichkeitsraum, $\mathcal S\subseteq \cF$ eine beliebige Teil-$\sigma$-Algebra von $\cF$. Außerdem sei $X:\Omega\to\MdR$ eine Zufallsvariable mit $E[|X|]<\infty$.

\begin{definition}
\label{def:2.1.5}Die Zufallsvariable $Z:\Omega\to\MdR$ heißt bedingter Erwartungswert von $X$ bezüglich der $\sigma$-Algebra $\mathcal S$, falls
\begin{enumerate}
\item $Z$ $(\mathcal S,\borel(\MdR))$-messbar ist
\item für alle $A\in \mathcal S$ gilt: $\int_A XdP = \int_AZ dP$.
\end{enumerate}
Man schreibt: $E[X\mid \mathcal S] = Z$.
\end{definition}


\begin{bemerkung}
\begin{itemize}
\item Die Existenz von $Z$ wurde von Kolmogorov bewiesen (1933). (siehe Williams, Kapitel 9)
\item $Z$ ist nur bis auf $P$-Nullmengen eindeutig. Man spricht deswegen manchmal auch von Versionen der bedingten Erwartung.
\end{itemize}
\end{bemerkung}

\begin{lemma}
Falls $\mathcal S=\sigma(Y)$ für eine diskrete Zufallsvariable $Y$, dann gilt $E[X\mid \mathcal S] = E[X\mid Y]$.
\end{lemma}

\begin{beweis}
Sei $Z\da E[X\mid Y] = g(Y) = \sum_{i=1}^n E[X\mid Y = y_i] \cdot 1_{y_i}(Y)$. $Y$ ist $(\mathcal S,\borel(\MdR))$-messbar, also ist auch $Z$ $(\mathcal S,\borel(\MdR))$-messbar. Es genügt, die zweite Eigenschaft für die erzeugenden Ereignisse $A_i$ der $\sigma$-Algebra $\mathcal S$ zu zeigen.
\begin{align*}
\int_{A_j}Zd P &= \int_{A_j} \sum_{i=1}^n E[X\mid Y=y_i]\cdot 1_{y_i}(Y)dP \\
&= \int_{A_j} E[X \mid Y=y_j] dP \\
&= \int_{A_j} \frac{E[X\cdot 1_{Y=y_j}]}{P(Y=y_j)} dP \\
&= \int_{A_j} X dP
\end{align*}
\end{beweis}

\begin{bemerkung}
Angenommen, der Zufallsvektor $(X,Y)$ hat die Dichte $f(x,y)$. Dann hat $X$ die Randdichte $f_X(x) = \int_{-\infty}^\infty f(x,y)dy$ und $Y$ die Randdichte $f_Y(y)=\int_{-\infty}^\infty f(x,y)dx$.

Die bedingte Dichte von $X$ gegeben $Y$ ist 
\[
f_{X\mid Y} (x\mid y) = \frac{f(x,y)}{f_Y(y)}.
\]
Es ist klar, dass wir die bedingte Erwartung nicht über $\frac{E[X\mid Y=y]}{P(Y=y)}$ definieren können, da wir dabei durch Null teilen müssten. Man könnte $\sigma(Y)$ als die kleinste $\sigma$-Algebra definieren, so dass alle Ereignisse $\{Y\le c\}\in\sigma(Y)$, $c\in\MdR$ und dann über $E[X\mid \sigma(Y)]$ aus Definition \ref{def:2.1.5} definieren.

Man kann aber $E[X\mid Y]$ auch direkt konstruieren: Für $\int_{-\infty}^\infty f(x,y)dx > 0$ setzen wir 
\[
g(y) \da \frac{\int x f(x,y)dx}{\int f(x,y)dx} = 
\frac{\int x f(x,y)dx}{f_Y(y)}
\]
und $g(y) = 0$ sonst. Dann ist $E[X\mid Y] = E[X\mid \sigma(Y)]$ gegeben durch $g(Y)$.

Zur Integrierbarkeit: Sei $A\da \{Y\le c\}$.
\begin{align*}
E[g(Y)\cdot 1_A] = \int_{-\infty}^c g(y) f_Y(y)dy = \int_{-\infty}^c \frac{\int x f(x,y)dx}{f_Y(y)} f_Y(y) dy = \int_{-\infty}^c \int x f(x,y)dxdy = E[X\cdot 1_A]
\end{align*}
\end{bemerkung}

\begin{beispiel}[Fortsetzung Würfelbeispiel]
Sei $A\da \{1,2\}$, $A^c \da \{3,4,5,6\}$. $\sigma(A)\da \{\emptyset,A,A^c,\Omega\} \ad \cA$. Es ist also
\begin{align*}
Z \da E[X\mid \cA] = E[X\mid A] \cdot 1_A + E[X\mid A^c]\cdot 1_{A^c} =
\begin{cases}
\frac 32, & \text{falls $\omega\in A$} \\
\frac 92, & \text{falls $\omega\in A^c$} 
\end{cases}
\end{align*}
und damit
\begin{align*}
E[Z] = E[ E[X\mid \cA] ] = \frac32 \cdot \frac 26 + \frac 92 \cdot \frac 46 = \frac 72 = E[X].
\end{align*}
\end{beispiel}

\begin{bemerkung}[Eigenschaften der bedingten Erwartung]
Sei $E[|X|]<\infty$ und $\mathcal G, \mathcal H$ seien Teil-$\sigma$-Algebren von $\cF$.
\begin{enumerate}
\item Sei $Y$ eine Version der bedingten Erwartung $E[X\mid \mathcal G]$. Dann gilt $E[Y]=E[X]$.
\item Falls $X$ $\mathcal G$-messbar ist, dann gilt: $E[X\mid \mathcal G]=X$ fast sicher.
\item Linearität: $E[a_1 X_1 + a_2 X_2\mid \mathcal G] = a_1 E[X_1\mid \mathcal G] + a_2 E[X_2 \mid \mathcal G]$
\item Positivität: Falls $X\ge 0$, dann gilt $E[X\mid \mathcal G] \ge 0$
\item Bedingtes MON: Falls $0 \le X_n \uparrow X$, dann gilt $E[X_n \mid \mathcal G] \uparrow E[X \mid \mathcal G]$ fast sicher.
\item Bedingtes FATOU: Falls $X_n\ge 0$, dann gilt $E[\liminf X_n \mid\mathcal G] \le \liminf E[X \mid \mathcal G]$ fast sicher.
\item Bedingtes DOM: Falls für alle $n\in\MdN$ und $\omega\in\Omega$ gilt $|X_n(\omega) |\le V(\omega)$, $E[V]<\infty$ und $X_n\to X$ fast sicher, dann gilt $E[X_n\mid \mathcal G] \to E[X\mid\mathcal G]$ fast sicher.
\item Bedingte Jensen-Ungleichung: Sei $c:\MdR\to\MdR$ konvex, $E[|c(X)|]<\infty$, dann ist $E[c(X)\mid\mathcal G] \ge c(E[X\mid \mathcal G])$ fast sicher.
\item Turmeigenschaft: Sei $\mathcal H$ eine Teil-$\sigma$-Algebra von $\mathcal G$, dann gilt $E[E[X\mid\mathcal G]\mid\mathcal H] = E[X\mid\mathcal H]$ fast sicher.
\item „Messbares Ausklammern“: Sei $Z$ eine $\mathcal G$-messbare Zufallsvariable und beschränkt. Dann gilt $E[Z\cdot X\mid \mathcal G] = Z\cdot E[X\mid \mathcal G]$.
\item Falls $\mathcal H$ unabhängig von $\sigma( \sigma(X), \mathcal G)$ ist, dann gilt $E[X \mid \sigma(\mathcal H, \mathcal G)] = E[X\mid \mathcal G]$ fast sicher. Insbesondere: Wenn $X$ unabhängig von $\mathcal H$ ist (also $X$ und $1_A$ sind für alle $A\in\mathcal H$ unabhängig), dann gilt $E[X\mid \mathcal H] = E[X]$.
\end{enumerate}
\end{bemerkung}

Für Beweise und weitere Informationen siehe Williams, Kapitel 9.

Aus diesen Eigenschaften folgt sofort für $\mathcal G = \{\emptyset, \Omega\}$: $E[X\mid\mathcal G] = E[X]$.


\subsection{Martingale}

Sei $(\Omega, \cF, P)$ ein Wahrscheinlichkeitsraum. Gegeben sei eine Indexmenge $I\ne \emptyset$. Wir verwenden in dieser Vorlesung $I=\{0, 1,\ldots,t\}$ oder $I=\MdN_0$. In der Vorlesung „Finanzmathematik II“ wird $I=[0,\infty)$ sein. Die Menge $I$ kann als Zeitparameter interpretiert werden.

\begin{definition}
\begin{enumerate}
\item Eine Familie von Zufallsvariablen $X=(X_t)_{t\in I}$, $X_t:\Omega \to \MdR$, heißt \emph{stochastischer Prozess}.\index{stochastischer Prozess}
\item Eine Familie $(\cF_t)_{t\in I}$ von Teil-$\sigma$-Algebren $\cF_t \subseteq \cF$ heißt \emph{Filtration},\index{Filtration} falls für alle $s,t\in I$ mit $s<t$ gilt: $\cF_s \subseteq \cF_t$.
\item Ein stochastischer Prozess $(X_t)_{t\in I}$ heißt \emph{adaptiert bezüglich der Filtration $(\cF_t)$}, \index{adaptierter Prozess} falls für alle $t\in I$ die Zufallsvariable $X_t$ $\cF_t$-messbar ist.
\end{enumerate}
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item Wir interessieren uns beispielsweise für stochastische Prozesse, die den Preisverlauf von Aktien über die Zeit beschreiben.
\item Wir modellieren Informationen über die Filtration. Häufig ist $(\cF_t)$ die \emph{natürliche Filtration},\index{natürliche Filtration} das heißt die kleinste Filtration, bezüglich der der Prozess $X$ adaptiert ist: $\cF_t = \sigma(X_0,\ldots,X_t) = \{(X_0,\ldots,X_t)^{-1}(B)\mid B\subseteq \MdR^{t+1} \text{ messbar}\}$.
\item Man schreibt $(\Omega, \cF, (\cF_t), P)$ für einen Wahrscheinlichkeitsraum $(\Omega, \cF, P)$, der mit der Filtration $(F_t)$ versehen ist und nennt diesen \emph{filtrierten Wahrscheinlichkeitsraum}.\index{filtrierter Wahrscheinlichkeitsraum}
\end{itemize}
\end{bemerkung}

\begin{definition}
Sei $(\Omega, \cF, (\cF_t), P)$ ein filtrierter Wahrscheinlichkeitsraum und $(X_t)_{t\in I}$ ein stochastischer Prozess. $(X_t)$ heißt Martingal, falls 
\begin{enumerate}
\item $(X_t)$ adaptiert ist,
\item $E[|X_t|] < \infty$ für alle $t\in I$,
\item $E[X_t\mid \cF_s] = X_s$ gilt fast sicher für alle $s,t\in I$ mit $s\le t$.
\end{enumerate}

$(X_t)$ ist ein Submartingal, falls (1) und (2) gilt, und (3) ersetzt wird durch: $E[X_t\mid \cF_s] \ge X_s$ für alle $s,t\in I$ mit $s\le t$.

$(X_t)$ ist ein Supermartingal, falls (1) und (2) gilt, und (3) ersetzt wird durch: $E[X_t\mid \cF_s] \le X_s$ für alle $s,t\in I$ mit $s\le t$.
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item Merkregel: Su\rlap{\hspace{-1.1pt}\raisebox{5pt}{$\uparrow$}}bmartingal „wächst im Durchschnitt“, 
Su\rlap{\hspace{-1.1pt}\raisebox{-5pt}{$\downarrow$}}permartingal „fällt im Durchschnitt“. 
\item $(X_t)$ ist ein Supermartingal genau dann, wenn $(-X_t)$ ein Submartingal ist.
\item $(X_t)$ ist ein Martingal genau dann, wenn $(X_t)$ ein Supermartingal und ein Submartingal ist.
\item Sei $(X_t)$ ein stochastischer Prozess mit $X_0\in \borel^{-1}(\Omega, \cF_0, P$). Dann ist $(X_t)$ ein Martingal, genau dann wenn $(X_t-X_0)$ ein Martingal ist. Deshalb setzt man manchmal $X_0=0$.
\item Falls $I$ diskret ist, genügt es (3) für alle $t, t+1\in I$ zu überprüfen: $E[X_{t+1}\mid \cF_t] = X_t$.

\begin{beweis}
Sei $m< n-1 < n$. Dann ist $\cF_m \subseteq \cF_{n-1} \subseteq \cF_n$. Wiederholtes Anwenden der Turmeigenschaft und der Martingaleigenschaft für $n, n+1$ liefert:
\begin{align*}
E[X_n\mid\cF_m] = E[ E[X_n\mid \cF_{n-1}] \mid \cF_m] = E[ X_{n-1} \mid \cF_m] = \cdots = E[X_{m+1} \mid \cF_m] = X_m
\end{align*}
\end{beweis}
\item $E[X_{t+1} \mid \cF_t] = X_t \iff E[X_{t+1}-X_t \mid \cF_t] = 0$
\item Sei $s\le t$ und $E[X_t \mid \cF_s] = X_s$. Dann gilt $E[X_s] = E[X_t] = \cdots = EX_0$.
\end{itemize}
\end{bemerkung}

\begin{beispiel}
Seien $S_n \da \sum_{i=1}^n X_i$, wobei $X_i$ unabhängige Zufallsvariablen mit $EX_i=0$, $E|X_i|<\infty$ und $S_0\da 0$ sind. Sei weiter $\cF_n\da \sigma(X_1,\ldots,X_n)$ und $\cF_0 \da \{\emptyset, \Omega\}$. Dann ist $(S_n)$ ein Martingal.
\end{beispiel}
\begin{beweis}
Integrierbarkeit und Adaptiertheit klar. Martingaleigenschaft: Sei $n\in\MdN$:
\begin{align*}
E[S_{n+1}\mid \cF_n] &= E[S_n + X_{n+1}\mid \cF_n] \\
&= E[S_n\mid \cF_n] + E[X_{n+1}\mid \cF_n] \\
&= S_n + EX_{n+1} \\
&= S_n
\end{align*}
\end{beweis}

Sei 
\[
X_i = 
\begin{cases}
1, & \text{ mit Wahrscheinlichkeit $p=\frac 12$} \\
-1,& \text{ mit Wahrscheinlichkeit $(1-p)=\frac 12$.}
\end{cases}
\]
Dann ist $EX_i = 0$. $X_i$ kann als Laufrichtung interpretiert werden: Man startet bei $S_0=0$ und wirft eine faire Münze um zu entscheiden, ob man einen Schritt nach links oder rechts läuft. $(S_n)$ beschreibt eine Irrfahrt (“random walk”) auf den ganzen Zahlen.

Eine andere Interpretation ist ein Glücksspiel: $X_i$ beschreibt das Ergebnis des $i$-ten Münzwurfs und $S_n$ beschreibt den Gewinn nach $n$ Würfen.

\begin{satz}
Sei $(M_t)_{t\in I}$ ein Martingal und $f:\MdR \to\MdR$ eine konvexe Funktion mit $E[|f(M_t)|]<\infty$ für alle $t\in I$. Dann ist $(f(M_t))_{t\in I}$ ein Submartingal.
\end{satz}

\begin{beweis}
Aus der Jensen-Ungleichung folgt sofort, dass für alle $s,t\in I$ mit $s\le t$ gilt:
\[
E[f(M_t)\mid \cF_s] \ge f(E[M_t\mid \cF_s]) = f(M_s)
\]
\end{beweis}

\begin{definition}
Ein Prozess $(X_n)_{n=1,2,\ldots}$ auf einem filtrierten Wahrscheinlichkeitsraum $(\Omega, \cF, (\cF_n), P)$ heißt \emph{vorhersagbar}, \index{vorhersagbarer Prozess} falls $X_n$ für alle $n\ge 1$ $\cF_{n-1}$-messbar ist.
\end{definition}

\begin{lemma}[Doobsche Zerlegung]
Sei $(X_t)_{t=0, 1,\ldots,T}$ ein Supermartingal bezüglich $(\cF_t)_{t=0, 1,\ldots,T}$. Dann kann man $(X_t)$ schreiben als
\[
X_t = M_t + A_t,
\]
wobei $(M_t)$ ein Martingal bezüglich $(\cF_t)$ ist und $(A_t)$ mit $A_0=0$ ein fallender Prozess, das heißt $A_{t+1}\le A_t$ für $t=0, 1,\ldots,T-1$.\label{lem:2.1.18}

Außerdem ist $(A_t)$ vorhersehbar. Die Zerlegung ist $P$-fast-sicher eindeutig.
\end{lemma}

\begin{beweis}
Übungsblatt
\end{beweis}

\subsubsection*{Martingal-Transformation}

Wir betrachten ein Glücksspiel in diskreter Zeit. Die Indexmenge sei hier $I=\MdN_0$. Zum Zeitpunkt 0 findet kein Spiel statt, zu den Zeitpunkten $n=1,2,\ldots$ wird gespielt und $\Delta Z_n \da Z_n-Z_{n-1}$ ist der Nettogewinn im $n$-ten Spiel.

Falls $(Z_n)$ ein Martingal ist, ist das Spiel fair in dem Sinne, dass $E[\Delta Z_n \mid \cF_{n-1}]=0$. Falls $(Z_n)$ Supermartingal ist, ist das Spiel unvorteilhaft für den Spieler, da $E[\Delta Z_n\mid \cF_{n-1}]\le 0$.

Beispielsweise ist der Münzwurf mit $Z_n=S_n$ ein Martingal und damit ein faires Spiel. Es ist $\Delta S_n\in\{-1,1\}$. Falls der Spieler zur Zeit $n-1$ (also vor dem $n$-ten Münzwurf) verdoppelt hätte, würde er $2\Delta S_n \in \{-2,2\}$ gewinnen oder verlieren. Das Spiel wäre weiterhin fair. Er hätte seinen Einsatz so auswählen können, dass er von allen Ereignissen bis zur Zeit $n-1$ abhängt – das Spiel bliebe fair.

Sei $(C_n)$ ein vorhersehbarer Prozess und $n\in\MdN$ (ohne 0). $(C_n)$ repräsentiert den Spieleinsatz im $n$-ten Spiel. Der Spieler wählt $(C_n)$ unter der Verwendung der Information bis zur Zeit $n-1$. Dann ist der Gewinn im $n$-ten Spiel $C_n\Delta Z_n = C_n(Z_n - Z_{n-1})$ und der Gesamtgewinn bis zur Zeit $n$ ist $Y_n \da \sum_{i=1}^n C_i (Z_i - Z_{i-1}) \ad (C\dickerkringel Z)_n$. Hier ist $(C\dickerkringel Z)_0=0$ und $Y_n - Y_{n-1} = C_n(Z_n-Z_{n-1})$. $(C\dickerkringel Z)$ wird \emph{Martingal-Transformation}\index{Martingal-Transformation} von $Z$ (durch $C$) genannt.

\begin{satz}
\begin{enumerate}
\item Sei $C$ ein nicht-negativer, vorhersehbarer und beschränkter Prozess (das heißt, für ein $K\in[0,\infty)$ gelte für alle $n\in I$ und $\omega\in\Omega$: $|C_n(\omega)|\le K$). Sei $Z$ ein Supermartingal. Dann ist $(C\dickerkringel Z)$ ein Supermartingal und $(C\dickerkringel Z)_0=0$.
\item Falls $C$ ein vorhersehbarer und beschränkter Prozess und $Z$ ein Martingal ist, dann ist $(C\dickerkringel Z)$ ein Martingal und $(C\dickerkringel Z)_0=0$.
\end{enumerate}
\end{satz}

\begin{beweis}
$Y=C\dickerkringel Z$ ist integrierbar, da $C$ beschränkt und $Z$ integrierbar ist. Adaptiertheit ist auch klar, da $C$ vorhersehbar und $Z$ adaptiert ist.

Zur (Super-)Martingaleigenschaft: Es gilt
\[
E[Y_n - Y_{n-1}\mid \cF_{n-1}] = E[C_n( Z_n - Z_{n-1})\mid \cF_{n-1}] = C_n E[Z_n - Z_{n-1}\mid \cF_{n-1}]
\]
da $C_n$ ein $\cF_{n-1}$-messbarer, beschränkter Prozess ist. Falls $C\ge 0$ und $Z$ ein Supermartingal ist, gilt $C_n E[Z_n - Z_{n-1}\mid \cF_{n-1}] \le 0$. Falls $Z$ ein Martingal ist, gilt $C_n E[Z_n - Z_{n-1}\mid \cF_{n-1}] = 0$.
\end{beweis}

Interpretation: “You can’t beat the system!” Da $C\bullet Z$ unter den obigen Voraussetzung ein Martingal ist, wird dadurch ein faires Spiel beschrieben. 

\begin{bemerkung}
Der Ausdruck $(C\bullet Z)$, die Martingal-Transformation von $Z$ durch $C$, ist das diskrete Äquivalent zum stochastischen Integral $\int C d Z$.
\end{bemerkung}

\subsection{Stoppzeiten}

Sei $I$ weiterhin die Indexmenge.

\begin{definition}
Eine $(\cF_t)$-Stoppzeit ist eine $I$-wertige Zufallsvariable $\tau$, so dass für alle $t\in I$
\[
\{\omega\in\Omega: \tau(\omega)\le t\}\in\cF_t.
\]
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item Zur Schreibweise: Man schreibt häufig für die Menge $\{\omega\in\Omega: \tau(\omega)\le t\}$ verkürzt $\{\tau \le t\}$ und ebenso $\{\tau = t\}$ für $\{\omega\in\Omega: \tau(\omega)= t\}$.
\item Interpretation der Stoppzeit: Zum Zeitpunkt $t$ weiß man, ob $\tau$ eingetreten ist oder nicht. Beispielsweise ist $\tau$ der Zeitpunkt, an dem der Spieler aufhört, an einem Glücksspiel teilzunehmen. Die Entscheidung nach der $t$-ten Spielrunde, das Spiel zu beenden, hängt nur von den Ergebnissen bis zum Zeitpunkt $t$ und nicht von der Zukunft ab.
\end{itemize}
\end{bemerkung}

\begin{lemma}
Falls $I$ diskret ist, gilt:
\[
\text{$\tau$ ist $(\cF_t)$-Stoppzeit} \iff \forall t\in I: \{\tau = t\}\in \cF_t
\]
\end{lemma}
\begin{beweis}
Sei $\tau$ eine $(\cF_t)$-Stoppzeit. Dann gilt $\{\tau \le t\} \in \cF_t$ und $\{\tau \le t-1\}\in \cF_{t-1}\subseteq \cF_t$. Daraus folgt $\{\tau=t\}=\{\tau \leq t\} \cap \{\tau \leq t-1\}^C \in \cF_t$.

Sei nun für alle $t\in I$ $\{\tau = t\} \in \cF_t$. Dann gilt $\{\tau \le t\} = \bigcup_{k\le t} \{\tau = k\} \in \cF_t$.
\end{beweis}

\begin{beispiel}
\begin{enumerate}
\label{bsp:2.1.24}\item $\tau = t_0 \in I$ ist eine Stoppzeit, da
\[
\{\omega\in\Omega : \tau (\omega) \le t\}
= \{\omega\in\Omega: t_0\le t\}
= 
\left.
\begin{cases}
\Omega, &\text{falls $t_0\le t$}\\
\emptyset, &\text{sonst}
\end{cases}
\right\}
\in \cF_t
\]
\item Sei $(S_t)_{t\in I}$, $I=\{0, 1, 2\ldots,T\}$, ein Aktienkursprozess  adaptiert bezüglich $(\cF_t)_{t\in I}$. Dann ist
\[
\tau \da \inf \{ t\ge 0: S_t \ge b \} \wedge T
\]
eine $(\cF_t)$-Stoppzeit:
\begin{align*}
\{\tau \le t\} = \bigcup_{k\le t} \{\tau = k\} = \bigcup_{k\le t} \{S_k \ge b\} \in \cF_t
\end{align*}
und $\tau = T$, falls der Aktienkurs in $I$ nie den Wert $b$ überschreitet.
\item  Sei $S$ wie in 2. Definiere $\tau \da \operatorname{argmax}_{t=0,\ldots,T} S_t$ (Zeitpunkt, zu dem $S$ den maximalen Wert annimmt). Dann ist $\tau$ \emph{keine} Stoppzeit, da man zum Zeitpunkt $t<T$ nicht sagen kann, ob $\tau$ eingetreten ist.
\end{enumerate}
\end{beispiel}

\begin{lemma}
Sind $\tau,\sigma$ Stoppzeiten, so sind $\min\{\tau, \sigma\}$, $\max\{\tau, \sigma\}$ und $\tau + \sigma$ wieder Stoppzeiten.
\end{lemma}
\begin{beweis}
Übungsblatt
\end{beweis}

\begin{satz}[Doob’s Optional Stopping Theorem]
Sei $\tau$ eine beschränkte Stoppzeit und $X=(X_n)_{n\in\MdN_0}$ ein Martingal. Dann ist $X_\tau$ integrierbar und $E[X_\tau] = E[X_0]$.
\end{satz}

\begin{beweis}
Da $\tau$ beschränkt ist, existiert ein $K\in\MdN$, so dass $\tau(\omega)\le K$ für $P$-fast-alle $\omega$. Dann gilt:
\begin{align*}
X_{\tau(\omega)}(\omega) = \sum_{k=0}^\infty X_k(\omega) 1_{\{\tau(\omega) = k\}} = \sum_{k=0}^K X_k(\omega) 1_{\{\tau(\omega) = k\}} 
\end{align*}
daher gilt
\begin{align*}
E[X_\tau] &= E[\sum_{k=0}^\infty X_k(\omega) 1_{\{\tau(\omega) = k\}}] \\
&= \sum_{k=0}^K E[X_k 1_{\{\tau(\omega) = k\}}] \\
&= \sum_{k=0}^K E[ E[X_K\mid\cF_k]  1_{\{\tau(\omega) = k\}}] \\
&= \sum_{k=0}^K E[ E[X_K 1_{\{\tau(\omega) = k\}}\mid\cF_k] ] \\
&= \sum_{k=0}^K E[X_K 1_{\{\tau(\omega) = k\}} ] \\
&= E[\sum_{k=0}^K X_K 1_{\{\tau(\omega) = k\}} ] = E[X_K] = E [X_0].
\end{align*}
\end{beweis}

\begin{bemerkung}
\begin{itemize}
\item Den Satz kann man auch auf ein Supermartingal $X=(X_n)$ anwenden und erhält dann $E[X_\tau]\leq E[X_0]$.
\item Die Annahme, dass die Stoppzeit $\tau$ beschränkt ist, kann durch eine der beiden folgenden Bedingungen ersetzt werde:
\begin{enumerate}
\item $X=(X_n)$ ist beschränkt ($|X_n(\omega)| \leq L$ für ein $L$ und alle $n, \omega$) und $\tau$ ist fast sicher endlich ($P(\tau < \infty)=1$).
\item $E[\tau]<\infty$ und für ein $L \in \MdR^+:|X_n(\omega)-X_{n-1}(\omega)|\leq L$ für alle $n,\omega$.
\end{enumerate}
\end{itemize}
\end{bemerkung}

\begin{satz}
Sei $X=(X_n)$ ein $(\cF_n)$-adaptierter stochastischer Prozess mit $E[X_n]<\infty$ für alle $n$. Für jede beschränkte Stoppzeit $\tau$ gelte $E[X_\tau]=E[X_0]$. Dann ist $X$ ein Martingal.
\end{satz}

\begin{beweis}
Sei $0\leq m<n<\infty$ und $A\in \cF_m$. Dann ist $\tau\da n 1_A+m 1_{A^C}$ eine beschränkte Stoppzeit. Dann gilt
\begin{align*}
E[X_0]=E[X_\tau]=E[X_n 1_A+X_m 1_{A^C}]=E[X_n1_A]+E[X_m1_{A^C}]
\end{align*}
Da $\sigma\da m$ auch eine beschränkte Stoppzeit ist, gilt
\begin{align*}
E[X_o]=E[X_m]=E[X_m 1_A+X_m 1_{A^C}]=E[X_m1_A]+E[X_m1_{A^C}]
\end{align*}
Daher gilt für alle $A\in \cF_m$: $E[X_m1_A]=E[X_n1_A]$ und damit $E[X_n|\cF_m]=X_m$ aus der Definition der bedingten Erwartung, das heißt $X$ ist ein Martingal. 
\end{beweis}

\begin{definition}
Sei $\tau$ eine $(\cF_t)$-Stoppzeit. Die $\sigma$-Algebra der Ereignisse bis zur Zeit $\tau$ ist definiert durch 
\[
\cF_\tau\da \{A\in \cF: \mbox{ für alle } t\geq0 \mbox{ } A\cap\{\tau\leq t\}\in \cF_t\}
\]

\end{definition}

\begin{lemma}
Für eine Stoppzeit $\tau$ ist $\cF_\tau$ eine $\sigma$-Algebra.
\end{lemma}

\begin{lemma}
Seien $\sigma,\tau$ Stoppzeiten mit $\sigma \leq \tau$. Dann gilt $\cF_\sigma\subseteq\cF_\tau$.
\end{lemma}

\begin{lemma}
Sei $X=(X_n)$ ein stochastischer Prozess adaptiert zu $(\cF_n)$ und $\tau$ eine $(\cF_n)$-Stoppzeit. Dann ist $X_\tau=\sum\limits_nX_n1_{\{\tau=n\}}$ $\cF_\tau$-messbar.
\end{lemma}

\begin{satz}[Doob's Optional Sampling Theorem]
\label{satz:2.1.33}Sei $(X_n)_{n\in\MdN}$ ein Martingal und $\tau,\sigma$ beschränkte Stoppzeiten mit $\sigma\leq\tau$. Dann gilt $E[X_\tau|\cF_\sigma]=X_\sigma$ und daher $E[X_\tau]=E[X_\sigma]$.
\end{satz}
\begin{beweis}
Die Beweise von 2.1.30--2.1.33 sind \"Ubung.
\end{beweis}

\begin{bemerkung}
Häufig betrachtet man gleichgradig integrierbare Martingale:\\
Ein Martingal $(X_n)_{n\in I}$ heißt \textit{gleichgradig integrierbar}, falls $\lim\limits_{\lambda\to\infty}\sup\limits_n E[|X_n| 1_{\{|X_n|>\lambda\}}]=0$.\\
Falls ein Martingal gleichgradig integrierbar ist, gilt Optional Sampling für beliebige Stoppzeiten.
\end{bemerkung}

\begin{satz}
\label{satz:2.1.35}Sei $(X_n)_{n\in\MdN_0}$ ein $(\cF_n)$-Martingal (Super-, Submartingal) und $\tau$ eine $(\cF_n)$-Stoppzeit. Dann ist der gestoppte Prozess $(X_{n\wedge\tau})_{n\in\MdN_0}$ auch ein $(\cF_n)$-Martingal (Super-, Submartingal).
\end{satz}
\begin{beweis}
Sei $C_j\da 1_{\{j\leq \tau\}}$. Dann ist
\begin{align*}
X_{\tau\wedge n}&=X_0+\sum\limits_{j=1}^n C_j (X_j-X_{j-1})=X_0+\sum\limits_{j=1}^n1_{\{j\leq\tau\}}(X_j-X_{j-1})\\
&=X_0+\sum\limits_{j=1}^{\tau\wedge n}(X_j-X_{j-1})=X_0+X_1-X_0+\ldots+X_{\tau\wedge n}\\
&= X_{\tau\wedge n}
\end{align*}
Da $\{j\leq\tau\}=\{\tau<j\}^C=\{\tau\leq j-1\}^C \in \cF_{j-1}$ ist $C_n$ vorhersagbar.\\
Daher ist $X_{\tau\wedge n}$ adaptiert. Es gilt
\begin{align*}
X_{\tau\wedge n}&=X_0+\sum\limits_{j=1}^n C_j (X_j-X_{j-1})=X_0+\sum\limits_{j=1}^{n-1}C_j(X_j-X_{j-1})+C_n(X_n-X_{n-1})\\
&= X_{\tau\wedge n-1}+C_n(X_n-X_{n-1})
\end{align*}
Dann folgt 
\begin{align*}
E[X_{\tau\wedge n}|\cF_{n-1}]=E[X_{\tau\wedge n-1}+C_n(X_n-X_{n-1})|\cF_{n-1}]=X_{\tau\wedge n-1}+C_n(E[X_n|\cF_{n-1}]-X_{n-1})
\end{align*}
Aus der Martingal- (Super-, Submartingal)-Eigenschaft folgt die Behauptung.
\end{beweis}

Wir schließen dieses Kapitel mit einer Konvergenzaussage:
\begin{satz}[Doob's Martingale Convergence Theorem]Sei $X=(X_n)$ ein $\mathcal{L}^1$-beschränktes Supermartingal $(\sup\limits_n E[|X_n|]<\infty)$. Dann existiert $X_\infty$ $\cF_\infty$-messbar, sodass $X_n\to X_\infty$ $P$-f.s. und $X_\infty$ ist $P$-f.s. endlich.
\end{satz}

\begin{beweis}
Siehe Williams Kapitel 11.
\end{beweis}

\section{Motivation und erste Begriffe}
Wir werden nun Derivate bewerten. Ein Derivat ist ein Finanztitel, bei dem Zahlungen wesentlich von anderen Finanztiteln (Basistitel) abhängen (derivare=ableiten).

\begin{wrapfigure}{r}{0.5\linewidth}
\begin{center}
\includegraphics[width=0.9\linewidth]{CBOT.jpg}
\end{center}
\caption{Chicago Board of Trade}
\end{wrapfigure}


Beispiele für Derivate:
\begin{itemize}
\item Termingeschäfte: Verträge, bei denen die Erbringung von Leistung und Gegenleistung zu einem zukünftigen Zeitpunkt heute vereinbart werden. Zu Termingeschäften gehören:
\begin{enumerate}
\item Warentermingeschäfte
\item Devisentermingeschäfte: z.B. kaufe zum Zeitpunkt $T$ $a$ US Dollar zu einem Wechselkurs von $b$.
\item Finanztermingeschäfte: Man unterscheidet hier Financial Forwards und Financial Futures. Futures werden an Märkten gehandelt, z.B. am CBOT (Chicago Board of Trade). 
\end{enumerate}
\item Optionen: Der Käufer der Option hat das Wahlrecht (aber nicht die Verpflichtung), ein bestimmtes Finanzgut (z.B. eine Aktie) (underlying, underlying asset) bis zu einem zukünftigen Zeitpunkt $T$ (maturity, expiry) zu einem vereinbarten Preis $K$ (strike price, excerise price, Ausübungspreis) zu kaufen oder zu verkaufen. Das Kaufrecht wird Call-Option genannt und das Verkaufsrecht wird Put-Option genannt. Man unterscheidet:
\begin{itemize}
\item Europäische Option: Ausübung ist nur zum Zeitpunkt $T$ möglich.
\item Amerikanische Aption: Ausübung jederzeit bis zum Zeitpunkt $T$ möglich.
\end{itemize}
\end{itemize}

\begin{beispiel}[Preisbestimmung einer europäischen Call-Option]
Sei $t=0$ der aktuelle Zeitpunkt, $T>0$ der Ausübungszeitpunkt, $(S_t)$ der stochastische Prozess, der den Preis der zugrunde liegenden Aktie beschreibt, und $K$ der Ausübungspreis. Die Auszahlung des Calls zum Zeitpunkt $T$ ist gegeben durch die Funktion 
\[
H \da \max\{0,S_T - K\} = (S_T-K)^+.
\]

Sei der Anfangswert der Aktie $S_0=10\$$. Wir nehmen an, dass die Aktie zum Zeitpunkt $T$ nur zwei Werte annehmen kann: $S_T(\omega_1) = 20\$$, $S_T(\omega_2) = 7,5\$$ mit Wahrscheinlichkeiten $p$ und $1-p$. Sei $K=15\$$. Dann ist die Auszahlung des Calls
\[
H= (S_T-K)^+ = 
\begin{cases}
5, \text{ mit Wahrscheinlichkeit $p$}\\
0, \text{ mit Wahrscheinlichkeit $1-p$}
\end{cases}
\]
Wir nehmen weiter an, dass es als zusätzliche Investitionsmöglichkeit (neben der Aktie) in dem Markt noch ein Bankkonto gibt, mit Zinssatz $r=0$ für Soll- und Habenpositionen. Was ist der Preis $\pi(H)$ für diese Option?

Idee: No-arbitrage-Prinzip: Es darf keine Arbitrage (risikoloser Gewinn) möglich sein. Die Auszahlung $H$ wird mit anderen Finanzinstrumenten (hier Aktie und Bankkonto) repliziert. Das Anfangskapital, das nötig ist, um $H$ zu repräsentieren, ist der Preis der Option. Im Folgenden bezeichnen wir mit $(\alpha, \beta)$ eine Handelsstrategie, wobei $\alpha$ die Anlage in die Aktie (Stückzahl) angibt und $\beta$ ist die Anlage auf dem Bankkonto. Für $\alpha<0$ spricht man vom Leerverkauf. Die Aktien können in beliebigen Anteilen ge- und verkauft werden. Der Wert des Portfolios aus Aktie und Bankkonto zum Zeitpunkt $t=0$ ist $V_0(\alpha,\beta) = \beta + \alpha\cdot S_0$ und zum Zeitpunk $t=T$ $V_T(\alpha,\beta) = \beta + \alpha \cdot S_T$.

Replizieren der Auszahlung bedeutet nun, dass man $H=V_T(\alpha,\beta)$ setzt, also $\beta + \alpha \cdot S_T(\omega) = H(\omega)$. Dies gibt für $\omega \in \{\omega_1,\omega_2\}$ ein lineares Gleichungssytem mit zwei Gleichungen:
\begin{align*}
\beta + \alpha \cdot 20  &= 5 \\
\beta + \alpha \cdot 7,5  &= 0 
\end{align*}
Lösen nach $\alpha, \beta$ liefert $\alpha=\frac 25$ und $\beta = -3$. Damit ist $V_0(\alpha,\beta) = -3 + \frac25\cdot 10 = 1$. Die replizierende Strategie (Hedging-Strategie) für den Call $H$ ist: Leihe heute 3\$ von der Bank und kaufe $\frac25$ Aktien. Die Gesamtinvestition ist dann 1\$.

Zum Zeitpunkt $T$ gibt es zwei Szenarios:
\begin{enumerate}
\item $S_T=20\$$. Verkauf der Aktien liefert $\frac 25 \cdot 20\$ = 8\$$. Nach der Kreditrückzahlung von $3\$$ bleiben $5\$$.
\item $S_T=7,5\$$. Verkauf der Aktie liefert $\frac 25 \cdot 7,5\$ = 3\$$. Nach der Kreditrückzahlung von $3\$$ bleiben $0\$$.
\end{enumerate}

Angenommen, wir verkaufen einem Kunden die Call-Option zum Preis von $1\$$ und investieren diesen wie oben beschrieben. Im ersten Szenario ($S_T=20$) wird der Kunde von seinem Recht Gebrauch machen und den Call ausüben. Er möchte also die Aktie zum Ausübungspreis $K=15\$$ kaufen. Unsere replizierende Strategie hat uns schon $5\$$ eingebracht, wir bekommen nun noch $K=15\$$ hinzu und können den Marktpreis einer Aktie von $20\$$ bezahlen und sie dem Kunden geben.

Wir haben uns mit der replizierenden Strategie perfekt gegen das Risiko, dass der Kunde  von seinem Ausübungsrecht Gebrauch macht, abgesichert (“Hedging”).

Im zweiten Szenario ($S_T=7,5\$$) wird der Kunde den Call nicht ausüben und die Aktie lieber am Markt für $S_T=7,5\$$ kaufen als von uns zum Preis $K=15\$$. Unsere replizierende Strategie hat uns $0\$$ eingebracht, wir bekommen 0 hinzu und müssen keine Aktie liefern.

Der faire Preis ist $\pi(H)=1$.
Angenommen, es gelte $\pi(H)>1$: Wir verkaufen Option zum Preis $\pi(H)$ und replizieren sie wie oben mit den Kosten von $1\$$. Der risikolose Gewinn beträgt $\pi(H) - 1$. Nehmen wir stattdessen an, dass $\pi(H)<1$ gilt, dann kaufen wir eine Option zum Preis $\pi(H)$ und verkaufen die replizierende Strategie. Der risikolose Gewinn wäre dann $1-\pi(H)$.

\textbf{Beachte:} $\pi(H)$ ist unabhängig von der Wahrscheinlichkeit $p$ (“real world probability”).
\end{beispiel}

\section{Endliche Finanzmärkte}
\label{sec:2.3}

Es werden nun endliche Finanzmärkte, die durch endlich viele Marktzustände und durch endlich viele Handelszeitpunkte charakterisiert sind, betrachtet. Es sei $I=\{0, 1,\ldots,T\}$. Wir betrachten einen filtrierten Wahrscheinlichkeitsraum $(\Omega,\cF,(\cF_t),P)$ mit endlichen $\Omega$ und $\cF=\mathcal P(\Omega)$. Weiter sei $P(\{\omega\})>0$ für alle $\omega\in\Omega$. Handelszeitpunkte seien die Zeitpunkte $t=0, 1,\ldots,T$.

Der Markt besteht aus $d+1$ Anlagemöglichkeiten: Einer risikolosen Anlagemöglichkeit $B$ (“Bond”) mit deterministischem Bond-Preis $(B_t)_{t\in I}$, wobei $B_0=1$ und $B_t>0$ für $t=1,\ldots,T$, und $d$ risikobehafteten Anlagemöglichkeiten (“stocks”) mit Preisprozessen $(S_t^k)_{t\in I}$, $k=1,\ldots,d$, wobei $S_t=(S_t^1,\ldots,S_t^d)^\top\in \MdR^d$ und $S_t^k(\omega)>0$ für alle $k=1,\ldots,d$, $t\in I$, $\omega\in \Omega$. Die Prozesse $(S_t^k)_{t\in I}$ seien für alle $k=1,\ldots,d$ adaptiert bezüglich der gegebenen Filtration $(\cF_t)_{t\in I}$.

Zur Vereinfachung der Notation schreiben wir auch $Z_t = (B_t, S_t^1, \ldots , S_t^d)^\top\in\MdR^{d+1}$ als Preisprozessvektor aller Anlagemöglichkeiten im Markt.

Für viele Überlegungen ist es wichtg, dass der Preisprozess mindestens einer Anlagemöglichkeit strikt positiv ist:  Einen Preisprozess $(Y_t)_{t\in I}$, der strikt positiv ist, nennt man Numéraire. Wir werden diskontierte Preise betrachten, wobei $\frac 1Y$ als Diskontfaktor verwendet wird. Häufig wird der risikolose Bond $Y=B$ als Numéraire verwendet.

\begin{definition}
Ein Portfolio oder eine Handelsstrategie $\varphi$ ist ein $\MdR^{d+1}$-wertiger stochastischer Prozess 
\[
\varphi \da (\varphi_t)_{t\in I^+} = 
\begin{pmatrix}
\beta_t \\ \alpha _t
\end{pmatrix}_{t\in I^+}
\]
der vorhersagbar bezüglich der Filtration $(\cF_t)$ ist. Dabei ist
\begin{itemize}
\item $\beta_t\in\MdR$ die Stückzahl des Bonds, die während des Zeitraums $(t-1,t]$ gehalten wird.
\item $\alpha_t = (\alpha_t^1,\ldots, \alpha_t^d)^\top \in\MdR^d$ und $\alpha_t^k$ ist die Stückzahl des Wertpapiers $k$, die während des Zeitraums $(t-1,t]$ gehalten wird.
\end{itemize}
Die Vorhersagbarkeit von $\varphi$ bedeutet, dass $\beta_t$, $\alpha_t^k$ für $t=1,\ldots,T$ $\cF_{t-1}$-messbar sind. Wir setzen
$\beta \da (\beta_t)_{t\in I^+}$ und $\alpha \da (\alpha_t)_{t\in I^+}$.
\end{definition}

Der Investor beobachtet die Preise $Z_{t-1}$ und wählt basierend auf diesen Informationen sein neues Portfolio $\varphi_t$, was er dann hält bis direkt nach Bekanntwerden der Preise $Z_t$.

\begin{definition}
\label{def:2.3.2}Der Wert des Portfolios zum Zeitpunkt $t\in\{1,\ldots,T\}$ ist gegeben durch 
\begin{align*}
V_t^\varphi  = \varphi_t^\top Z_t = \beta_t B_t + \alpha_t^\top S_t = \beta_tB_t + \sum_{k=1}^d \alpha_t^kS_t^k
\end{align*}
und wir setzen $V_0^\varphi = \varphi_1^\top Z_0 = \beta_1B_0 + \alpha_1^\top S_0$.
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item $V_t^\varphi$ wird auch der Wert- oder Vermögensprozess zur Strategie $\varphi$ genannt.
\item $V_0^\varphi$ wird als das Anfangsvermögen bezeichnet.
\item $\varphi_{t+1}^\top Z_t$ ist der Wert des Portfolios direkt nachdem es zur Zeit $t$ neu zusammengesetzt wurde.
\item $\varphi_{t+1}^\top Z_{t+1}$ ist der Wert des Portfolios zum Zeitpunkt $t+1$, wenn die Zeit-$(t+1)$-Preise beobachtet werden, aber das Portfolio noch nicht wieder umstrukturiert wurde.
\item Die Änderung des Martkwertes des Portfolios nur durch Änderung der Preise ist daher
\[
\varphi_{t+1}^\top (Z_{t+1}-Z_t) = \varphi_{t+1}^\top \Delta Z_{t+1}.
\]
\end{itemize}
\end{bemerkung}

\begin{definition}
Eine Handelsstrategie $\varphi$ heißt \emph{selbstfinanzierend}\index{selbstfinanzierend} (“self-financing”), falls
\[
\varphi_t^\top Z_t = \varphi_{t+1}^\top Z_t
\]
für $t=1, 2,\ldots,T-1$.
\end{definition}

Dies bedeutet, dass kein Zu- oder Abfluss von Geld stattfindet. Wenn der Investor die neuen Preise $Z_t$ beobachtet, passt er sein Portfolio von $\varphi_t$ zu $\varphi_{t+1}$ an, ohne dass er zusätzliches Vermögen hinzufügt oder abzieht.

Wir zeigen im Folgenden, dass bei selbstfinanzierenden Strategien die Kenntnis von $\varphi 
=\left(\begin{smallmatrix}
\beta \\ \alpha
\end{smallmatrix}\right)$
äquivalent zur Kenntnis von $(V_0^\varphi, \alpha)$ ist.

\begin{lemma}
Sei $\varphi 
=\left(\begin{smallmatrix}
\beta \\ \alpha
\end{smallmatrix}\right)$ eine selbstfinanzierende Strategie. Dann gilt
\begin{align*}
\beta_t = \beta_1 - \sum_{n=2}^t \Delta \alpha_t^\top \frac{S_{n-1}}{B_{n-1}} 
= V_0^\varphi - \sum_{n=1}^t \Delta \alpha_n^\top \frac{S_{n-1}}{B_{n-1}}
\end{align*}
für $t=1,\ldots,T$, wobei $\Delta\alpha_1^k \da \alpha_1^k$ für $k=1,\ldots,d$.\label{lem:2.3.5}
\end{lemma}

\begin{beweis}
Sei $t=1$.
\begin{align*}
V_0^\varphi = \beta_1 B_0 + \alpha_1^\top S_0 = \beta_1 + \alpha_1^\top \frac{S_0}{B_0}
\end{align*}
und daher 
\begin{align*}
\beta_1 = V_0^\varphi - \alpha_1^\top \frac{S_0}{B_0} = V_0^\varphi - \Delta \alpha_1^\top \frac{S_0}{B_0}
\end{align*}
Sei $t\in\{2,3,\ldots,T\}$. Da $
\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
 selbstfinanzierend ist, gilt
\begin{align*}
\beta_{t-1}B_{t-1} + \alpha_{t-1}^\top S_{t-1} &=\beta_t B_{t-1} + \alpha_t^\top S_{t-1} \\
\iff && (\beta_t - \beta_{t-1})B_{t-1} &=  -(\alpha_t^\top - \alpha_{t-1}^\top)S_{t-1} \\
\iff \Delta \beta_t &= - \Delta \alpha_t^\top \frac{S_{t-1}}{B_{t-1}}
\end{align*}
Dann gilt
\begin{align*}
\beta_t &= \beta_1 - \beta_1 + \beta_2 - \beta_2 + \cdots + \beta_{t-1} -\beta_{t-1} + \beta_t\\
&= \beta_1 + \sum_{n=2}^t \Delta \beta_n\\
&= \beta_1 + \sum_{n=2}^t (-1)\Delta \alpha_n^\top \frac{S_{n-1}}{B_{n-1}}\\
&= V_0^\varphi - \Delta\alpha_1^\top \frac{S_0}{B_0} - \sum_{n=2}^t \Delta \alpha_t^\top \frac{S_{n-1}}{B_{n-1}} \\
&= V_0^\varphi - \sum_{n=1}^t \Delta \alpha_n ^\top \frac{S_{n-1}}{B_{n-1}}
\end{align*}
\end{beweis}

Man kann sich oft ohne Beschänkung der Allgemeinheit auf den Fall $B_t=1$ beschränken, da der folgende Zusammenhang gilt:
\begin{lemma}
\label{lem:2.3.6}Sei $\varphi
=\left(\begin{smallmatrix}
\beta \\ \alpha
\end{smallmatrix}\right)$ eine selbstfinanzierende Strategie und $X_t^k \da \frac{S_t^k}{B_t}$ der diskontierte Preisprozess, $k=1,\ldots,d$ und $t=1,\ldots,T$. Dann gilt:
\begin{align*}
\frac{V_t^\varphi}{B_t} = V_0^\varphi + \sum_{n=1}^t \alpha_n^\top \Delta X_n
\end{align*}
\end{lemma}

\begin{beweis}
Für $n=1,\ldots,T$ gilt
\begin{align*}
\frac{V_n}{B_n} - \frac{V_{n-1}}{B_{n-1}} 
&= \frac 1 {B_n} (\beta_n B_n + \alpha_n^\top S_n) - \frac1{B_{n-1}}(\beta_{n-1}B_{n-1} + \alpha_{n-1}^\top S_n) \\
&= \frac 1 {B_n} (\beta_n B_n + \alpha_n^\top S_n) - \frac1{B_{n-1}}(\beta_{n}B_{n-1} + \alpha_{n}^\top S_n) \\
&= (\beta_n - \beta_n) + \alpha_n^\top \bigg(\frac{S_n}{B_n} - \frac{S_{n-1}}{B_{n-1}}\bigg) \\
&= \alpha_n^\top \Delta X_n
\end{align*}
Daher gilt mit $B_0=1$:
\begin{align*}
\frac{V_t^\varphi}{B_t} 
&= \frac{V_0^\varphi}{B_0} - \frac{V_0^\varphi}{B_0} + \cdots + \frac{V_{t-1}^\varphi}{B_{t-1}} - \frac{V_{t-1}^\varphi}{B_{t-1}} + \frac{V_t^\varphi}{B_0} \\
&= \frac{V_0^\varphi}{B_0} + \sum_{n=1}^t \bigg(\frac{V_n^\varphi}{B_n} -  \frac{V_{n-1}^\varphi}{B_{n-1}}\bigg) \\
&= V_0^\varphi + \sum_{n=1}^t \alpha_n^\top \Delta X_n
\end{align*}
\end{beweis}

\begin{definition}
Den Prozess $(G_t^\alpha)$ einer Handelsstrategie $\varphi
=\left(\begin{smallmatrix}
\beta \\ \alpha
\end{smallmatrix}\right)$, der für $t=1,\ldots,T$ durch
\[
G_t^\alpha  \da \sum_{n=1}^t \alpha_n^\top \Delta X_n
\]
definiert ist und $G_0^\alpha = 0$, bezeichnen wir als (diskontierten) \emph{Gewinnprozess}\index{Gewinnprozess} von $\varphi$.
\end{definition}

\begin{definition}
Ein Zahlungsanspruch (“contingent claim”) ist eine $\cF$-messbare Zufallsvariable $H:\Omega\to \MdR$
\end{definition}

\begin{bemerkung}
Ist $\cF = \cF_T = \sigma(S_0,S_1,\ldots,S_T)$, so ist $H = h(S_0,S_1,\ldots,S_T)$ für eine Funktion $h:\MdR^{T+1} \to \MdR$.
\end{bemerkung}

\begin{beispiel}
\begin{itemize}
\item Europäische Call-Option: $H=(S_T-K)^+$
\item Europäische Put-Option: $H=(K-S_T)^+$
\item Termingeschäft (“short”): $H=K-S_T$
\item Digital Call-Option: $H = 1_{\{S_T > K\}}$
\item Down-and-out-call: $H = (S_T-K_1) \cdot 1_{\{\min_{t\in\{0,\ldots,T\}} S_t > K_2\}}$
\item Asiatische Option: $H = (S_T - \frac1T \sum_{t=1}^T S_t)^+$
\end{itemize}
\end{beispiel}

\begin{definition}
\begin{enumerate}
\item Ein Zahlungsanspruch $H$ heißt \emph{erreichbar},\index{erreichbar} wenn es eine selbstfinanzierende Strategie $\varphi$ gibt mit
\[
V_T^\varphi = H.
\]
Dann heißt $\pi(H) = V_0^\varphi$ ein Preis von $H$ und $\varphi$ eine \emph{Hedging-Strategie}.\index{Hedging-Strategie}
\item Ein Markt heißt \emph{vollständig}, \index{vollständiger Markt} falls jeder Zahlungsanspruch erreichbar ist.
\end{enumerate}
\end{definition}

\begin{definition}
Eine selbstfinanzierende Handelsstrategie heißt \emph{Arbitrage-Strategie}, \index{Arbitrage-Strategie} falls $P(V_0^\varphi = 0)=1$, $P(V_T^\varphi \ge 0) = 1$ und $P(V_T^\varphi>0) >0$.

Wir sagen, dass eine Arbitragemöglichkeit existiert, falls eine Arbitrage-Strategie existiert.
\end{definition}

\begin{bemerkung}
Von Lemma \ref{lem:2.3.6} gilt für eine selbstfinanzierende Strategie $\varphi = 
\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
\[
\frac{V_T^\varphi}{B_{T}} = V_0^\varphi + G_T^\alpha.
\]
Daher liegt eine Arbitragemöglichkeit genau dann vor, wenn eine selbstfinanzierende Strategie \mbox{$\varphi = 
\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$} existiert mit $P(V_0^\varphi = 0) = 1$, $P(G_T^\alpha \ge 0) = 1$, $P(G_T^\alpha>0)>0$.
\end{bemerkung}

\begin{bemerkung}
Wir schreiben (NA) (“no arbitrage”), wenn keine Arbitragemöglichkeit existiert.
\end{bemerkung}

\begin{lemma}
Es gelte (NA). Dann ist der Preis $\pi(H)$ für einen erreichbaren Zahlungsanspruch eindeutig bestimmt und damit unabhängig von der Wahl der Hedging-Strategie.\label{lem:2.3.15}
\end{lemma}

\begin{beweis}
Sei $H$ ein erreichbarer Zahlungsanspruch und $\varphi =
\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$, $\tilde\varphi =
\left(\begin{smallmatrix} \tilde\beta \\ \tilde\alpha \end{smallmatrix}\right)$ zwei Hedging-Strategien für $H$. Von Lemma \ref{lem:2.3.5} wissen wir, dass $\varphi, \tilde\varphi$ durch $(V_0^\varphi,\alpha)$ und $(V_0^{\tilde\varphi},\tilde\alpha)$ ausgedrückt werden können. Aus Lemma \ref{lem:2.3.6} folgt dann
\[
V_0^\varphi + G_T^\alpha = \frac H {B_T} = V_0^{\tilde\varphi} + G_T^{\tilde\alpha}
\]
Angenommen, $V_0^\varphi \ne V_0^{\tilde\varphi}$ und ohne Beschränkung der Allgemeinheit gelte $V_0^\varphi < V_0^{\tilde\varphi}$. Dann ist $d \da V_0^{\tilde{\varphi}} - V_0^{\varphi} > 0$. Damit gilt
\begin{align*}
0 &= V_0^\varphi - V_0^{\tilde\varphi} - G_T^{\tilde\alpha} + G_T^\alpha  \\
&= -d + G_T^\alpha  - G_T^{\tilde\alpha}  \\
&= -d + \sum_{n=1}^T (\alpha_n^\top - \tilde\alpha_n^\top) \Delta X_n \\
&= -d + G_T^{\alpha-\tilde\alpha}
\end{align*}
Daher ist $G_T^{\alpha-\tilde\alpha}>0$. Also ist $\psi$ eine Arbitragemöglichkeit, wobei $\psi = 
\left(\begin{smallmatrix} \hat\beta \\ \hat\alpha \end{smallmatrix}\right)$, $\hat\alpha = \alpha -\tilde\alpha$ und $\hat\beta$ ist definiert über Lemma \ref{lem:2.3.5}, wobei $V_0^\psi=0$, im Widerspruch zu (NA).
\end{beweis}

\section{Das Cox-Ross-Rubinstein-Modell}

Wir betrachten nun ein einfaches  Finanzmarktmodell in diskreter Zeit. In diesem Modell werden wir viele wichtige Ergebnisse zur Bewertung von Derivaten herleiten, die auch in viel allgemeineren Zusammenhängen gelten (siehe spätere Kapitel). Wir betrachten das grundlegende Binomialmodell von Cox, Ross und Rubinstein (1979 veröffentlicht).

Sei $d=1$, das heißt wir betrachten einen Markt mit einem Bond und einer Aktie.

\subsection{Ein-Perioden-CRR-Modell}

Wir beginnen mit einem Ein-Perioden-Modell, also $T=1$. Sei $\Omega=\{\omega_1,\omega_2\}$ und $\cF = \cF_1 = \mathcal P(\Omega)$. Die Werte des Bondes seien $B_0=1$ und $B_1= 1 + r$, $r>0$. Die Werte der Aktie seien $S_0=S>0$ und 
\[
S_1(\omega) = 
\begin{cases}
u\cdot S_0,& \text{falls } \omega = \omega_1\\
d\cdot S_0,& \text{falls } \omega = \omega_2
\end{cases}
\]
für $0 < d < u$. Hier steht $u$ für den up-Faktor und $d$ für den down-Faktor. (Wäre $u=d$, wäre das Modell nicht wirklich stochastisch und damit nicht interessant.)

\begin{lemma}
Gegeben sei das Ein-Perioden-CRR-Modell. Dann gilt (NA) genau dann, wenn $d< 1+ r < u$.
\end{lemma}
\begin{beweis}
\begin{align*}
d < 1+r < u &\iff \frac d{1+r} < 1 < \frac u{1+r} \\
&\iff \frac{S_0 d}{1+r} < S_0 < \frac{S_0 u}{1+r} \\
&\iff \frac{S_0 d}{1+r} - S_0 < 0 < \frac{S_0 u}{1+r} - S_0 \\
&\iff \frac{S_1(\omega_2)}{1+r} - S_0 < 0 < \frac{S_1(\omega_1)}{1+r} - S_0 \\
&\iff (NA)
\end{align*}

Die letzte Äquivalenz folgt aus den folgenden Überlegungen:
\begin{itemize}
\item[„$\Longrightarrow$“] Sei $V_0 = \beta + \alpha S_0 = 0$, daher $\beta = V_0- \alpha S_0 = -\alpha S_0$. Also ist 
\[
V_1=\beta(1+r) + \alpha S_1 = -\alpha S_0(1+r) + \alpha S_1 = \alpha (1+r)(\frac{S_1}{1+r} - S_0)
\]
Wir haben gerade gesehen, dass $V_1$ nicht mit positiver Wahrscheinlichkeit positiv sein kann, ohne dass es auch mit positiver Wahrscheinlichkeit negativ sein kann. Damit gilt (NA).
\item[„$\Longleftarrow$“] Angenommen, $d\ge 1+ r$. Beginne ohne Anfangsvermögen. Leihe Geld für das Kaufen einer Aktie von der Bank und kaufe diese Aktie ($\alpha = 1$, $\beta = -S_0$, $V_0=0$). 

Im ersten Szenario ist $S_1(\omega_1) = uS_0$ und damit
\[V_1=\beta(1+r) + \alpha S_1 = -S_0(1+r) + u S_0 \ge - S_0d + uS_0 = S_0(u-d) > 0.\]

Im zweiten Szenario ist $S_1(\omega_2) = dS_0$ und damit 
\[V_1=\beta(1+r) + \alpha S_1 = -S_0(1+r) + d S_0 \ge - S_0d + dS_0 = 0.\]

Dies ist ein Wiederspruch zu (NA). Analog kann man bei der Annahme von $u\le 1+r$ einen Leerverkauf der Aktie machen und das Geld auf dem Bankkonto investieren ($\alpha = -1$, $\beta = S_0$, $V_0=0$).
\end{itemize}
\end{beweis}

\begin{lemma}\label{lem:2.4.2}
Es gelte (NA). Dann ist das CRR-Modell vollständig, das heißt zu jedem Zahlungsanspruch $H$ gibt es eine selbstfinanzierende Strategie $\varphi = 
\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$,
so dass $V_1^\varphi = H$.

Insbesondere ist hier 
\begin{align*}
\alpha_1 = \frac{H(\omega_1) - H (\omega_2)}{(u-d)S_0} && 
\beta_1 = \frac{u H(\omega_2) - d H(\omega_1)}{(u-d)(1+r)}
\end{align*}
und damit ist der eindeutige Preis $\pi(H)$ gegeben durch
\begin{align*}
\pi(H) = \beta_1 B_0 + \alpha_1 S_0 = \frac{H(\omega_1)}{1+r} \frac{1+r-d}{u-d} + \frac{H(\omega_2)}{1+r} \bigg(1 - \frac{1+r-d}{u-d}\bigg)
\end{align*}
\end{lemma}

\begin{beweis}
Der Ansatz ist $V_1^\varphi = \beta_1(1+r) + \alpha_1 S_1 = H$. Da $\Omega=\{\omega_1,\omega_2\}$ erhalten wir das lineare Gleichungssystem
\begin{align*}
\beta_1(1+r) + \alpha_1 S_1(\omega_1) &= H (\omega_1) \\
\beta_1(1+r) + \alpha_1 S_1(\omega_2) &= H (\omega_2) 
\end{align*}
was sich schreiben lässt als
\begin{align*}
\beta_1(1+r) + \alpha_1 u S_0  &= H (\omega_1) \\
\beta_1(1+r) + \alpha_1 d S_0  &= H (\omega_2).
\end{align*}
Dieses lässt sich nach $\beta_1, \alpha_1$ auflösen, so dass man durch Umsortieren die Behauptung erhält.
\end{beweis}

\begin{bemerkung}
\begin{itemize}
\item Wir setzen $q\da \frac{1+r-d}{u-d}$. Wegen (NA) gilt $0<q<1$.
\item Nach Lemma \ref{lem:2.4.2} gilt dann für den Preis von $H$:
\begin{align*}
\pi(H) = \frac{H(\omega_1)}{1+r} q + \frac{H(\omega_2)}{1+r} (1-q)
\end{align*}
Wir definieren ein Wahrscheinlichkeitsmaß $Q$ durch $Q(\{\omega_1\}) = q$ und $Q(\{\omega_2\})=1-q$. Also gilt $\pi(H) = E_Q[\frac H {1+r}]$, wobei $E_Q$ den Erwartungswert bezüglich des Maßes $Q$ bezeichnet.
\item Für den diskontierten Preis $X_1 = \frac{S_1}{B_1}$ gilt
\begin{align*}
E_Q[X_1] &= E_Q[\frac{S_1}{B_1}] \\
&= \frac{S_1(\omega_1)}{B_1} \cdot q + \frac{S_1(\omega_2)}{B_1} \cdot (1-q) \\
&= \frac{uS_0}{1+r} q + \frac{ d S_0}{1+r}(1-q) \\
&= S_0 = \frac{S_0}{B_0} = X_0.
\end{align*}
$Q$ ist das einzige Wahrscheinlichkeitsmaß mit $E_Q[X_1]=X_0$.
\end{itemize}
\end{bemerkung}

\subsection{Mehr-Perioden-CRR-Modell}
Wir betrachten das $T$-Perioden-CRR-Modell, das heißt wir betrachten den Zeithorizont $T$ und \mbox{$t \in \{0, 1, \ldots,T\}$}.

Sei $r>0$ und $B_{t+1}=B_t(1+r)$, $B_0=1$. Dann ist $B_t=(1+r)^t$ für $t=0, 1,\ldots ,T$.

Für die risikobehaftete Anlagemöglichkeit gelte
\[
S_{t+1} = 
\begin{cases}
u S_t, & \text{ mit Wahrscheinlichkeit } p \\
d S_t, & \text{ mit Wahrscheinlichkeit } 1-p
\end{cases}
\]
für $0<d<u$, $p\in (0, 1)$, $t=0, 1, \ldots, T-1$ und $S_0>0$.

Wir konstruieren nun ein Modell, indem wir den Prozess
\[
(Y_t)=\left(\frac{S_t}{S_{t-1}}\right)
\]
mit $t=1,\ldots,T$ jeweils als Zufallsvariable auf dem Wahrscheinlichkeitsraum $(\tilde\Omega_t, \tilde\cF_t,\tilde P_t)$ betrachten, wobei
\begin{align*}
\tilde\Omega_t &\da \tilde{\Omega}= \{u,d\},\\
\tilde\cF_t &\da \tilde{\cF}\da  \mathcal{P}(\tilde{\Omega})=\{\emptyset, \{d\},\{u\},\tilde{\Omega}\}\\
\tilde P_t &\da \tilde{P}\text{ mit }\tilde{P}(\{u\})=p,\ \tilde{P}(\{d\})=1-p,\text{ für ein }p\in (0, 1)
\end{align*}

Auf diesem Wahrscheinlichkeitsraum ist $Y_t(u)\da u$, $Y_t(d)\da d$, $t=1, 2,\ldots, T$.

 Unser Ziel ist es, einen Wahrscheinlichkeitsraum zu definieren, auf dem wir die Preise der Anlagemöglichkeiten $B$ und $S$ beschreiben können. Da man den Aktienkurs $S$ als
\[
S_t=S_0 \prod_{k=1}^t Y_k,\ t=1,\ldots, T
\]
schreiben kann, liegt es nahe als zugrundeliegenden Wahrscheinlichkeitsraum den Produktraum $(\Omega, \cF, P)$ zu betrachten, wobei:
\begin{align*}
\Omega &\da \tilde\Omega_1 \times \cdots \times \tilde\Omega_T \\ % \ni \omega = \tilde{\omega}^T=\{u,d\}^T \\
\cF &\da \mathcal{P}(\Omega) \\
P(\{\omega\}) &\da \tilde{P}(\{y_1\})\cdot \cdots\cdot \tilde{P}(\{y_T\})
\end{align*}
wobei $\omega=(y_1, \ldots, y_T)$ und $y_t \in \{d,u\}$, $t\in\{1,\ldots,T\}$.

Für weitere Infos zu Produkträumen siehe Williams, Kapitel 8. Hier werden über den Produktraum unabhängige Wiederholungen einen Zufallsexperiments beschrieben. Da $Y_t$ eine Zufallsvariable ist, die zwei Werte annehmen kann, kann man das durch $Y$ beschriebene Zufallsexperiment als Münz"-wurf (mit einer nicht notwendig fairen Münze) interpretieren.


 Wir definieren nun die $Y_t$, $t=1, \ldots T$, neu auf dem Wahrscheinlichkeitsraum $(\Omega, \cF , P)$:
\[
Y_t(\omega)=Y_t((y_1,\ldots,y_T))\da 
 \begin{cases}
 u & \mbox{ falls } y_t=u\\
 d & \mbox{ falls } y_t=d
 \end{cases}
\]
für $t=1, \ldots, T$.

 Mit dieser Konstruktion gilt: $P(Y_t=u)=p=1-P(Y_t=d)$ und die $Y_i$ sind unabhängig identisch verteilt.

 Die Informationen im Markt werden durch die naheliegende Filtration modelliert:
 $\cF_0\da \{\emptyset, \Omega\}$ und $\cF_t\da \sigma(Y_1,\ldots,Y_t)=\sigma(S_1,\ldots, S_t)$ für $t\in\{1,\ldots, T-1\}$ und $\cF_T\da \cF=\mathcal{P}(\Omega)$.

 Bisher haben wir nur das Reale-Welt-Maß $P$ definiert. Zur Optionsbewertung werden wir aber wie im Ein-Perioden-Modell ein risikoneutrales Maß $Q$ benötigen, dass wir analog zum obigen Vorgehen auf dem messbaren Raum $(\Omega, \cF)$ definieren:
\[
Q(\{\omega\}) = Q(\{(y_1,\ldots, y_T)\})=\tilde{Q}(\{y_1\}) \cdot\cdots\cdot \tilde{Q}(\{y_T\})=q_{y_1} \cdot\cdots\cdot q_{y_T}
\]
wobei
\[\tilde Q(\{y_t\})\da q_{y_t}\da
\begin{cases}
 q & \mbox{ falls } y_t=u\\
 1-q & \mbox{ falls } y_t=d
 \end{cases}
\]
mit $q\da \frac{1+r-d}{u-d}$ und wir fordern, dass $d<1+r<u$. Man rechnet leicht nach, dass $Q$ ein Wahrscheinlichkeitsmaß ist.
 
 \begin{lemma}
Im $T$-Perioden-CRR-Modell gilt:\label{lem:2.4.4}
\[
\text{(NA)}\iff d<1+r<u
\]
 \end{lemma}
 
 \begin{beweis}
 siehe Übungsblatt
 \end{beweis}

\begin{satz}
Es gelte (NA). Dann ist das $T$\!-Perioden-CRR-Modell vollständig. Insbesondere gilt:

Zu jedem Zahlungsanspruch $H$ gibt es eine selbstfinanzierende Hedging-Strategie
$\varphi = 
\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$ mit $V_T^\varphi=H$ und 
\begin{align*}
\pi(H)=\beta_1B_0+\alpha_1S_0= \sum_{\mathclap{\omega=(y_1,\ldots,y_T)\in\Omega}} q_{y_1} \cdot\cdots\cdot q_{y_T} \frac{H(\omega)}{B_T}= E_Q\left[\frac{H}{B_T}\right]
\end{align*}
ist der eindeutige Preis von $H$ und $Q$ ist das oben definierte Wahrscheinlichkeitsmaß.\label{satz:2.4.5}
\end{satz}
 
 \begin{beweis}
 Der Preis und die Hedging-Strategie kann rekursiv im Binomialbaum ermittelt werden. Beginne mit $t=T$. Setze $V_T=H$. Da $Y_T$ zwei Werte annehmen kann, wird aus der Gleichung 
 \begin{align*}
 V_t&= \beta_t B_t+ \alpha_t S_t
 \end{align*}
das Gleichungssystem mit den zwei Gleichungen:
 \begin{align*}
 V_{t-1}&= \beta_{t-1}B_{t-1}+\alpha_{t-1}S_{t-1}=\beta_tB_{t-1}+\alpha_tS_{t-1}
 \end{align*}
 Löse LGS in zwei Unbekannten $(\beta_T, \alpha_T)$ (eindeutig lösbar) in Abhängigkeit von $(y_1,\ldots,y_{T-1})$ (zur Erinnerung: $\omega=(y_1,\ldots,y_T)$).

 Aus der zweiten Gleichung kann nun $V_{T-1}$ berechnet werden (in Abhängigkeit von $(y_1,\ldots, y_{T-1})$).

 Für $T=1$ folgt die Behauptung aus dem Ein-Perioden-CRR-Modell.

 Für $T>1$ kann der Schritt für $t=T-1, t=T-2, \ldots$ rekursiv wiederholt werden. 

 $Q$ berechnet man analog zum Ein-Perioden-CRR-Modell.
 \end{beweis}
 \begin{korollar}
 Sei $H$ ein europäischer Zahlungsanspruch mit Laufzeit $T$ gegeben durch $H=f(S_T)$. Dann ist der Preis (zur Zeit 0) gegeben durch
 \begin{align*}
 \pi(H)=E_Q\left[\frac{f(S_T)}{B_T}\right]=\frac{1}{B_T} \sum\limits_{k=0}^T \binom{T}{k} q^k (1-q)^{T-k} f(S_0u^kd^{T-k}),
 \end{align*}
wobei $q=\frac{1+r-d}{u-d}$.\label{kor:2.4.6}
 \end{korollar}
 \begin{beweis}
 Es gilt $S_T=S_0 \prod_{k=1}^T Y_k$ mit $Q(Y_k=u)=q=1-Q(Y_k=d)$. Daher folgt aus Satz \ref{satz:2.4.5} sofort die Behauptung.
 \end{beweis}
 
\begin{bemerkung}[Hedging im Mehr-Perioden-CRR-Modell]
Sei $H$ ein Zahlungsanspruch und $\pi_t(H,S_t)$ der Preis des Zahlungsanspruchs $H$ zum Zeitpunkt $t$ bei Kurs $S_t$. Sei 
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$ 
eine selbstfinanzierende Hedging-Strategie für $H$, so gilt $\pi_t(H,S_t)=V_t^\varphi$ und außerdem $\pi(H) = \pi_0(H,S_0)$.

Mit $\pi_t(H,S_t) = \beta_t B_t + \alpha_t S_t$ folgt:
\begin{align*}
\pi_t(H,u S_{t-1}) &= \beta_t B_t + \alpha_t u S_{t-1} \\
\pi_t(H,d S_{t-1}) &= \beta_t B_t + \alpha_t d S_{t-1}
\end{align*}
und daher ist
\[
\alpha_t = \frac{\pi_t(H,uS_{t-1}) - \pi_t(H,dS_{t-1})}{(u-d) S_{t-1}}
\]
und
\[
\beta_t = \frac{u\pi_t(H,d S_{t-1}) - d\pi_t(H,uS_{t-1})}{(u-d)B_t}.
\]
\end{bemerkung}

\begin{definition}
\begin{itemize}
\item Ein Wahrscheinlichkeitsmaß $Q$ auf $(\Omega, \cF)$, für das
\[
(X_t) = \left( \frac{S_t}{B_t}\right)_{t\in\{0,\ldots,T\}}
\]
ein Martingal ist (bezüglich der Filtration $\cF_t$), heißt \emph{Martingalmaß} oder \emph{risikoneutrales Maß}.\index{Martingalmaß}\index{risikoneutrales Maß} Zur Erinnerung: Für ein solches $Q$ gilt: $(X_t)$ ist adaptiert, $E|X_t|<\infty$ für $t=0,\ldots,t$ und $E_Q[X_{t+1}\mid \cF_t] = X_t$ für $t=0,\ldots,T-1$.
\item $\cQ = \{Q \text{ Wahrscheinlichkeitsmaß auf } (\Omega, \cF) \mid Q \text{ ist ein Martingalmaß} \}$
\item $\cQ^* = \{ Q \in \cQ\mid Q \text{ ist äquivalent zu }P\}$
\end{itemize}
\end{definition}

\begin{bemerkung}
\begin{itemize}
\item Zur Erinnerung: Ein Wahrscheinlichkeitsmaß $Q$ ist äquivalent zu einem Wahrscheinlichkeitsmaß $P$ (kurz $Q\sim P$) genau dann, wenn $Q$ und $P$ die gleichen Nullmengen haben, das heißt für alle $A\in\cF$ gilt $P(A)=0 \iff Q(A)=0$.
\item Wir haben bisher gefordert, dass $P(\{\omega\})>0$ für alle $\omega\in\Omega$. Daher ist in diesem Fall $\cQ^* = \{ Q\in \cQ\mid \forall \omega \in \Omega: Q(\{\omega\})>0\}$.
\end{itemize}
\end{bemerkung}

\begin{satz}
Gegeben sei das $T$\!-Perioden-CRR-Modell. Dann gilt
\begin{enumerate}
\item (NA) $\iff d < 1+r < u$
\item $d < 1+r < u \iff$ Es existiert ein äquivalentes Martingalmaß $Q$. (EMM)
\item Es gelte $d< 1+r < u$. Dann ist das Martingalmaß eindeutig und charakterisiert durch
\[
q= \frac{1+r-d}{u-d}.
\]
\end{enumerate}
\end{satz}

\begin{beweis}
\begin{enumerate}
\item Lemma \ref{lem:2.4.4}, Übungsblatt
\item Sei $Q$ ein Wahrscheinlichkeitsmaß. Dann gilt
\begin{align*}
E_Q[X_{t+1}\mid \cF_t]
&= E_Q[\frac{S_{t+1}}{B_{t+1}} \mid\cF_t] \\
&= E_Q[\frac{Y_{t+1}S_t}{B_{t+1}} \mid \cF_t] \\
&= \frac{S_t}{B_{t+1}} E_Q[Y_{t+1} \mid \cF_t] \\
&= \frac{S_t}{B_{t+1}} E_Q[Y_{t+1}] \\
&= \frac{S_t}{B_t} \frac{1}{1+r} E_Q[Y_{t+1}] \\
&= X_t \frac{1}{1+r} E_Q[Y_{t+1}] \\
&\stackrel ! = X_t 
\end{align*}
Damit $Q$ ein Martingal ist, muss also $\frac{1}{1+r} E_Q[Y_{t+1}] = 1$ gelten, also $qu + (1-q)d = 1+r$ für ein $q\in[0, 1]$.

Das ist ein gewichtetes Mittel von $1+r$ und daher $1+r\in [d,u]$. Falls $Q$ äquivalent zu $P$ ist, ist $q\in(0, 1)$ und damit $Q$ äquivalent zu $P$.
\item Die Gleichung $qu + (1-q)d = 1+r$  hat eine eindeutige Lösung und diese ist $q=\frac{1+r-d}{u-d}$.
\end{enumerate}
\end{beweis}

\section{Hauptsatz der Optionspreistheorie}

Wir betrachten wieder allgemeine endliche Finanzmärkte wie in Sektion \ref{sec:2.3}. Sei $(\Omega, \cF, P)$ der Wahrscheinlichkeitsraum mit natürlicher Filtration $(\cF_t)_{t\in I}$ und $I=\{0, 1,\ldots, T\}$. Wir betrachten wieder einen Bond $(B_t)_{t\in I}$ und $d$ Aktien $(S_t^k)_{t\in I}$, $k=1,\ldots,d$. Wir schreiben wieder
\[
(X_t)_{t\in I} =\left( \frac{S_t}{B_t}\right)_{t\in I}
\]
und wie zuvor $\cQ= \{Q \text{ Wahrscheinlichkeitsmaß auf } (\Omega,\cF)\mid Q \text{ ist Martingalmaß}\}$ und $\cQ^* = \{Q\in \cQ\mid Q \sim P\} = \{Q\in \cQ \mid \forall \omega\in \Omega: Q(\{\omega\}) > 0\}$.

\begin{satz}
Sei $Q\in \cQ^*$ und \label{satz:2.5.1}
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$ 
eine selbstfinanzierende Strategie. Dann ist der diskontierte Ver\-mög\-es\-pro\-zess
\[
\left(\frac{V_t^\varphi}{B_t}\right)
\]
ein $Q$-Martingal.
\end{satz}
\begin{beweis}
Da $\varphi$ selbstfinanzierend ist, gilt nach Lemma \ref{lem:2.3.6}:
\begin{align*}
\frac{V_t^\varphi}{B_t} = V_0^\varphi + G_t^\alpha = V_0^\varphi + \sum_{n=1}^t \alpha_n^\top \Delta X_n
\end{align*}
und daher
\begin{align*}
\frac{V_t^\varphi}{B_t} - \frac{V_{t-1}^\varphi}{B_{t-1}}
= G_t^\alpha - G_{t-1}^\alpha = \alpha_t^\top \Delta X_t = \alpha_t^\top \bigg(\frac{S_t}{B_t} - \frac{S_{t-1}}{B_{t-1}}\bigg)
\end{align*}
und da $X_t = \frac{S_t}{B_t}$ ein $Q$-Martingal ist, gilt 
\begin{align*}
E_Q[\frac{V_t^\varphi}{B_t} - \frac{V_{t-1}^\varphi}{B_{t-1}}\mid \cF_{t-1}]
= \alpha^\top_t E_Q[\frac{S_t}{B_t} - \frac{S_{t-1}}{B_{t-1}}\mid \cF_{t-1}] = 0.
\end{align*}
Der diskontierte Wertprozess ist also eine Martingal-Transformation des $Q$-Martingals $\frac{S_t}{B_t}$ durch $\varphi$ und daher selbst ein $Q$-Martingal.
\end{beweis}

\begin{satz}
Sei $Q$ ein Wahrscheinlichkeitsmaß auf $(\Omega,\cF)$. Dann gilt\label{satz:2.5.2}
\begin{enumerate}
\item $Q\in \cQ\iff \forall \alpha: E_Q[G^\alpha_T]=0$
\item $\cQ^*\ne \emptyset \implies$ (NA)
\end{enumerate}
\end{satz}

\begin{beweis}
\begin{enumerate}
\item „$\Longrightarrow$“: Sei $Q\in\cQ$. Für alle $\alpha$ ist $G_T^\alpha = \sum_{n=1}^T \alpha_n^\top \Delta X_n$. Im Beweis von Satz \ref{satz:2.5.1} wurde gezeigt, dass $E_Q[\alpha_n^\top \Delta X_n\mid \cF_{n-1}]=0$ für alle $n\in\{1,\ldots,T\}$. Da $E_Q[\alpha_n^\top \Delta X_n] = E_Q[E_Q[\alpha_n^\top \Delta X_n \mid \cF_{n-1}]]$ folgt die Behauptung.

„$\Longleftarrow$“: Für $n\in\{1,\ldots,T\}$, $k\in\{1,\ldots,d\}$ und $B\in\cF_{n-1}$ definieren wir die folgende Strategie $\alpha$:
\begin{align*}
\alpha_n^k\da 1_B && \alpha_t^j = 0 \text{ für } (j,t) \ne (k,n)
\end{align*}
Dann ist $\alpha$ vorhersehbar. Dann gilt $G_T^\alpha \da 1_B\Delta X_n^k$ und nach Voraussetzung
\begin{align*}
0 = E_Q[G_T^\alpha] = E_Q[1_B \Delta X_n^k]
\end{align*}
Da $1_B$ $\cF_{n-1}$-messbar ist, gilt dann 
\begin{align*}
0 = E_Q[E_Q[1_B \Delta X_n^k\mid \cF_{n-1}]] = E_Q[1_B E_Q[X_n^k\mid \cF_{n-1}]]
\end{align*}
Da $n,k,B$ beliebig sind, folgt für alle $n=1,\ldots,T$, $k=1,\ldots,d$: $E_Q[\Delta X_n^k\mid \cF_{n-1}]=0$, also $Q\in \cQ$.
\item Sei $Q\in \cQ^*$. Die (NA)-Bedingung ist äquivalent zu der Aussage, dass für alle selbstfinanzierenden Handelsstrategien
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$ 
gilt
\[
G_T^\alpha \ge 0 \implies G_T^\alpha = 0 \quad (P-\text{f.s.})
\]
Aus (1) folgt, dass für alle $\alpha$ gilt $E_Q[G^\alpha_T] = 0$. Damit ist $G_T^\alpha \ge 0 \implies G_T^\alpha = 0$ ($Q$-f.s.). Da $Q$ äquivalent zu $P$ ist, gilt dies auch $P$-f.s.
\end{enumerate}
\end{beweis}


\begin{lemma}[Trennungssatz]
Sei $L\subseteq \MdR^n$ ein linearer Unterraum und $K\subseteq \MdR^n$ eine kompakte und konvexe Teilmenge mit $L\cap K=\emptyset$. Dann gibt es eine lineare Abbildung $f:\MdR^n \to \MdR$, so dass $\forall x\in L: f(x) = 0$ und $\forall x\in K: f(x) >0$.
\label{lem:2.5.3}
\end{lemma}

\begin{satz}[Erster Fundamentalsatz der Preistheorie]
(Auch “first fundamental theorem of asset pricing”, FTAP1)\label{satz:2.5.4}
\[
\text{(NA)} \iff \cQ^* \ne\emptyset
\]
\end{satz}

\begin{bemerkung}
Ausformuliert sagt FTAP1: Der Finanzmarkt ist genau dann arbitragefrei, wenn ein zu $P$ äquivalentes Maß $Q$ existiert, so dass der diskontierte $d$-dimensionale Preisprozess
\[
(X_t)_{t\in I} =\left( \frac{S_t}{B_t}\right)_{t\in I}
\]
ein Martingal unter $Q$ ist.
\end{bemerkung}

\begin{beweis}
„$\Longleftarrow$“ Siehe Satz \ref{satz:2.5.2} (2).

„$\Longrightarrow$“ $\Omega$ ist endlich, wir setzen $m\da |\Omega|<\infty$ und schreiben $\Omega = \{\omega_1,\ldots, \omega_m\}$. Wir werden im Folgenden eine Zufallsvariable $X$ auf $(\Omega,\cF, P)$ als Vektor im $\MdR^{|\Omega|} =\MdR^m$ interpretieren, indem wir schreiben $(X(\omega_1),\ldots,X(\omega_m))^\top$. Sei $\Lambda$ die Menge aller Zufallsvariablen auf $(\Omega,\cF, P)$. Dann bezeichnen wir mit $\tilde\Lambda\subseteq \MdR^m$ den dazugehörigen $m$-dimensionalen Raum ($X\in\Lambda\iff (X(\omega_1),\ldots,X(\omega_m))^\top\in \tilde\Lambda$). Wir schreiben für $X(\omega_i)$ auch $X_i$.

Wir definieren zwei Unterräume des $\MdR^m$:
\begin{align*}
C &\da \{ Y\in \tilde\Lambda\mid \forall i\in\{1,\ldots,m\}: Y_i \ge 0 \text{ und } \exists i\in\{1,\ldots,m\}: Y_i > 0\} \\
L &\da \{ Y\in \tilde\Lambda\mid \forall i\in\{1,\ldots,m\}: Y_i = G_T^\alpha(\omega_i) \text{ für eine selbstfinanzierende} \\
&\hspace{24em}\text{Handelsstrategie } 
\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)\}
\end{align*}
Die Menge $C$ wird verwendet, um (NA) geeignet auszudrücken. Sei 
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
eine selbstfinanzierende Handelsstrategie mit Anfangsvermögen $V_0^\varphi = 0$, dann folgt aus (NA), dass $(V_T^\varphi(\omega_1),\ldots, V_T^\varphi(\omega_m))^\top\notin C$.

Da $G_T^\alpha = \sum_{n=1}^T \alpha_n \Delta X_n$ linear ist, ist $L\subseteq\MdR^m$ ein linearer Unterraum. $L$ beschreibt die Menge aller Zahlungsansprüche, die erreichbar zum Preis 0 sind. Wegen (NA) gilt daher $C\cap L =\emptyset$.

Wir definieren nun einen weiteren Unterraum des $\MdR^m$:
\begin{align*}
K &\da \{Y\in C \mid  \sum_{i=1}^m Y_i = 1\}.
\end{align*}
$K$ ist konvex und kompakt, und da $K\subseteq C$ ist, gilt wegen (NA) auch hier $K\cap L=\emptyset$.

Aus dem Trennungssatz (Lemma \ref{lem:2.5.3}) folgt die Existenz einer linearen Abbildung $f:\MdR^m\to \MdR$ mit $\forall x\in L: f(x)=0$ und $\forall x\in K: f(x) >0$, die wir als $f(x) = q^\top x = \sum_{i=1}^m q_i x_i$ schreiben.

Wir betrachten die Zufallsvariable $\xi^{(i)} \da 1_{\{\omega_i\}}$. Dann ist der zugehörige $m$-dimensionale Vektor $(\xi^{(i)}(\omega_1),\ldots,\xi^{(i)}(\omega_m))^\top$, wobei $\xi_j^{(i)} = \delta_{ij}$. Daher ist  $(\xi^{(i)}(\omega_1),\ldots,\xi^{(i)}(\omega_m))^\top\in K$ für $i=1,\ldots,m$. Dann gilt 
\[
f((\xi^{(i)}(\omega_i),\ldots,\xi^{(i)}(\omega_m))^\top) = \sum_{j=1}^m \xi^{(i)}(\omega_j)q_j = q_i.
\]
Der Trennungssatz liefert uns also $q_i>0$ für alle $i\in\{1,\ldots,m\}$.

Wir definieren nun ein neues Wahrscheinlichkeitsmaß auf $(\Omega, \cF)$:
\[
Q(\{\omega_i\}) \da \frac{q_i}{\sum_{j=1}^m q_j}
\]
Da dieses $Q$ keine nichtleeren Nullmengen hat, ist $Q$ äquivalent zu $P$.

Aus dem Trennungssatz folgt insbesondere, dass $f(x)=q^\top x=0$ für alle $x\in L$. Sei 
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
eine selbstfinanzierende Handelsstrategie. Dann gilt 
\begin{align*}
E_Q[G_T^\alpha] = \sum_{i=1}^m \frac{q_i}{\sum_{j=1}^m q_j} G_T^\alpha(\omega_i) = \frac{1}{\sum_{j=1}^m q_j} \sum_{i=1}^m q_i G_T^\alpha(\omega_i) = 0,
\end{align*}
da $(G_T^\alpha(\omega_1),\ldots,G_T^\alpha(\omega_m))^\top\in L$. Mit Satz \ref{satz:2.5.2} (1) folgt damit, dass $Q\in \cQ$, und da $Q$ äquivalent zu $P$ ist, auch $Q\in \cQ^*$.
\end{beweis}

\subsection{Risikoneutrale Bewertung von Zahlungsansprüchen}

Das folgende Lemma verallgemeinert Lemma \ref{lem:2.3.15}. 
\begin{lemma}
Es gelte (NA). Dann gilt für jeden erreichbaren Zahlungsanspruch $H$ und zwei selbstfinanzierende Stratgie $\varphi$, $\psi$ mit $V_T^\varphi = H = V_T^\psi$ zu jedem Zeitpunkt $t=0,\ldots,T$: \label{lem:2.5.6}
\[
V_t^\varphi = V_t^\psi
\]
\end{lemma}
\begin{beweis}
Übungsblatt
\end{beweis}

\begin{definition}
Es gelte (NA) und $H$ sei ein erreichbarer Zahlungsanspruch mit Laufzeit $T$. Der \emph{Arbitragepreisprozess}\index{Arbitragepreisprozess}
\[
(\pi_t(H))_{t\in\{0,\ldots,T\}}
\]
ist der Wertprozess einer replizierenden Strategie $\varphi$ von $H$.
\end{definition}

\begin{satz}
Es gelte (NA). Sei $H$ ein erreichbarer Zahlungsanspruch. Dann gilt die risikoneutrale Bewertungsformel\label{satz:2.5.8}
\[
\pi_t(H) = B_t E_Q[\frac H{B_T}\mid \cF_t]
\]
wobei $Q\in \cQ^*$ beliebig.
\end{satz}

\begin{beweis}
Da $H$ erreichbar ist, existiert eine selbstfinanzierende Handelsstrategie 
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
mit $H = V_T^\varphi$. Wegen (NA) existiert nach Satz \ref{satz:2.5.4} ein $Q\in\cQ^*$. Aus Satz \ref{satz:2.5.1} folgt, dass 
\[
\left(\frac{V_t^\varphi}{B_t}\right)
\]
ein $Q$-Martingal ist. Daher gilt
\begin{align*}
\pi_t(H) = V_t^\varphi = B_t \frac{V_t^\varphi}{B_t} = B_t E_Q [ \frac{V_T^\varphi}{B_T} \mid \cF_t] = B_t E_Q[ \frac H {B_T} \mid \cF_t].
\end{align*}
\end{beweis}

Der folgende Satz gibt uns nun die Methode an, mit der wir faire Preise zum Zeitpunkt $t=0$ eines Zahlungsanspruchs bestimmen können. Ein solcher Preis ist ein Erwartungswert unter einem risikoneutralen Maß:

\begin{korollar}
Es gelte (NA). Sei $H$ ein erreichbarer Zahlungssanspruch. Dann gilt für den Preis $\pi(H)$ von $H$ zur Zeit $t=0$:
\[
\pi(H) = E_Q[\frac{H}{B_T}]
\]
wobei $Q\in \cQ^*$ beliebig.
\end{korollar}

\begin{beweis}
Die Behauptung folgt sofort aus Satz \ref{satz:2.5.8} mit $B_0=1$ und $\cF_0=\{\emptyset, \Omega\}$.
\end{beweis}

\section{Vollständigkeit und Martingalmaße}

Wir haben gesehen, dass das Cox-Ross-Rubinsteinmodell vollständig ist. In allgemeinen endlichen Finanzmärkten liefert uns der zweite Fundamentalsatz den Zusammenhang zwischen Vollständigkeit und Eindeutigkeit des äquivalenten Martingalmaßes.

\begin{satz}[Zweiter Fundamentalsatz der Preistheorie]
(Auch “second fundamental theorem of asset pricing”, FTAP2)\label{satz:2.6.1}

Es gelte (NA). Dann ist der Markt genau dann vollständig, wenn $|\cQ^*|=1$, also wenn genau ein äquivalentes Martingalmaß existiert.
\end{satz}

\begin{beweis}
„$\Longrightarrow$“: Der Markt sei vollständig. Wegen (NA) gilt nach Satz \ref{satz:2.5.4} (FTAP1), dass $\cQ^* \ne \emptyset$. Seien $Q_1,Q_2\in \cQ^*$.

% Warum umständlich wenns auch direkt geht
%Wir nehmen an, dass $Q_1 \ne Q_2$ und führen das zum Widerspruch.

Sei $H$ ein Zahlungsanspruch und
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
die zugehörige Hedging-Strategie. Dann gilt
$ \frac{H}{B_T} = V_0^\varphi + G_T^\alpha $
Aus Satz \ref{satz:2.5.2} folgt: $E_{Q_1}[G_T^\alpha] = 0 = E_{Q_2}[G_T^\alpha]$ und daher $E_{Q_1}[H] = E_{Q_2}[H]$.

Setzte nun $H=1_A$ für $A\in \cF$. Dann gilt $Q_1(A) = E_{Q_1}[1_A] = E_{Q_2}[1_A] = Q_2(A)$, und somit $Q_1 = Q_2$ und $|\cQ^*|=1$.

„$\Longleftarrow$“: Der Markt sei nicht vollständig. Zu zeigen ist $|\cQ^*|>1$.

Wir betrachten wieder die Menge aller Zufallsvariablen auf $(\Omega,\cF)$, bezeichnet mit $\Lambda$, und die dazugehörige $m$-dimensionale Darstellung $\tilde\Lambda$ wie im Beweis von Satz $\ref{satz:2.5.4}$, wobei $m=|\Omega|$, $\Omega = \{\omega_1,\ldots,\omega_m\}$.

Sei
\[
L \da \{ (c + G_T^\alpha(\omega_1), \ldots, c+ G_T^\alpha(\omega_m))^\top \in \tilde\Lambda \mid \varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)
\text{ selbstfinanzierende Handelsstrategie, } c\in \MdR\}
\]
Da $G_T^\alpha$ linear ist, ist $L$ ein linearer Untervektorraum von $\MdR^m$.

Wegen (NA) gilt $\cQ^*\ne \emptyset$ (Satz \ref{satz:2.5.4}, FTAP1). Sei $Q\in\cQ^*$ und $Q(\{\omega_i\})\ad q_i$ für $i=1,\ldots,m$. Wir betrachten das Skalarprodukt $(Z,Y)\mapsto E_Q[ZY]$ für Zufallsvariablen $Z,Y\in\Omega$. In der $m$-dimensionalen Schreibweise bedeutet dies für $(Z(\omega_1),\ldots,Z(\omega_m))^\top, (Y(\omega_1),\ldots,Y(\omega_m))^\top\in \tilde\Lambda$:
\[
((Z(\omega_1),\ldots,Z(\omega_m))^\top, (Y(\omega_1),\ldots,Y(\omega_m))^\top) \mapsto \sum_{i=1}^m Z(\omega_i)Y(\omega_i)q_i
\]
Nach Voraussetzung existiert ein nicht erreichbarer Zahlungsanspruch $H$. Dann ist $(H(\omega_1),\ldots,H(\omega_m)) \in \tilde\Lambda$, aber $\notin L$. Damit ist $L$ ein echter Untervektorraum von $\MdR^m$ und das orthogonale Komplement $L^\bot$ ist nicht trivial, das heißt  es gibt $(Z(\omega_1),\ldots,Z(\omega_m))^\top\in L^\bot\setminus\{0\}$ mit $\sum_{i=1}^m Z(\omega_i)Y(\omega_i)q_i= 0$ für alle $(Y(\omega_1),\ldots,(\omega_n))^\top\in L$. Da $(1,\ldots,1)^\top\in L$ gilt $\sum_{i=1}^mZ(\omega_i)q_i = 0$.

Wir definieren nun ein weiteres Wahrscheinlichkeitsmaß 
\[
Q'(\{\omega_i\}) \da (1 + \frac{Z(\omega_i)}{2 \|Z\|_\infty}) Q(\{\omega_i\})
\]
wobei $\|Z\|_\infty = \sup \{|Z(\omega_i)|: \omega_i\in \Omega\}$. Durch die Konstruktion ist klar, dass $Q'\ne Q$. $Q'$ ist ein Wahrscheinlichkeitsmaß, da für alle $\omega_i\in \Omega: Q'(\{\omega_i\}) > 0$ gilt und
\begin{align*}
Q'(\Omega) &= \sum_{i=1}^m (1 + \frac{Z(\omega_i)}{2\|Z\|_\infty})Q(\{\omega_i\}) \\
&= \sum_{i=1}^m Q(\{\omega_i\}) + \frac{1}{2\|Z\|_\infty} \sum_{i=1}^m Z(\omega_i)Q(\{\omega_i\}) = 1 + 0 = 1.
\end{align*}
Insbesondere hat $Q'$ keine nichtleeren Nullmengen und ist damit äquivalent zu $P$.


Sei nun $(Y(\omega_1),\ldots,Y(\omega_m))^\top = (c + G_T^\alpha(\omega_1),\ldots,c + G_T^\alpha(\omega_m))^\top \in L$. Dann gilt
\begin{align*}
c + E_{Q'} [G_T^\alpha]  = E_{Q'}[Y]
&= \sum_{i=1}^m Y(\omega_i)Q'(\{\omega_i\})\\
&= \sum_{i=1}^m Y(\omega_i) (1 + \frac{Z(\omega_i)}{2\|Z\|_\infty})Q(\{\omega_i\}) \\
&= \sum_{i=1}^m Y(\omega_i)q_i + \sum_{i=1}^m Y(\omega_i) \frac{Z(\omega_i)}{2\|Z\|_\infty} q_i \\
&= E_Q[Y] + 0 \\
&= E_Q[c + G_T^\alpha] = c
\end{align*}
da $(Y(\omega_1),\ldots,Y(\omega_m))\in L$, $Q\in \cQ^*$.

Daher gilt $E_{Q'}[G_T^\alpha] = 0$ und deswegen folgt mit Satz \ref{satz:2.5.2}, dass $Q'\in \cQ$. Da $Q'$ äquivalent zu $P$ ist, gilt $Q\in \cQ^*$. Aus $Q\ne Q'$ folgt damit die Behauptung.
\end{beweis}

\section{Bestimmung des risikoneutralen Maßes $Q$}

Im Cox-Ross-Rubinstein-Modell haben wir das Maß $Q$ explizit angegeben. Wie sieht dieses Maß in allgemeinen endlichen Finanzmärkten aus? Wir betrachten ein Maß auf $\Omega = \tilde\Omega^T$ mit $|\tilde\Omega|<\infty$, wobei $\tilde\Omega$ die Menge der Ein-Schritt-Bewegungen des Aktienkurses ist (zum Vergleich: Im CRR-Model ist $\tilde\Omega=\{u,d\}$). Wir schreiben $\omega=(y_1,\ldots,y_T)\in \Omega$ und $\omega_t = (y_1,\ldots,y_t)\in \tilde\Omega^t$.

Wir definieren das Wahrscheinlichkeitsmaß 
\[
Q(\{\omega\}) = Q(\{(y_1,\ldots,y_T)\}) = q_1(y_1) q_2(y_2\mid \omega_1) \cdots q_T(y_T\mid \omega_{T-1})
\]
Die einzelnen Wahrscheinlichkeiten pro Periode können im Gegensatz zum Cox-Ross-Rubinstein-Modell unterschiedlich sein. Deswegen müssen wir angeben, wo im Baum wir uns befinden. Daher die Schreibweise $q_t(y_t\mid \omega_{t-1})$. 

Ist $Q\in\cQ$, so gilt für alle $t=1,\ldots,T$, $k=1,\ldots,d$:
\begin{align*}
&& E_Q[\Delta X_t^k\mid \cF_{t-1}] &= 0 \\
\iff && \forall A \in \cF_{t-1} \int_A \Delta X_t^kdQ &= \int_A 0 dQ  && \\
\iff && \int_{\{\omega \mid \omega_{t-1} = (y_1,\ldots,y_{t-1})\}}
\Delta X_t^k dQ &= 0\\
\iff && \sum_{y\in\tilde\Omega} \Delta X_t^k(\omega_{t-1}, y) q_t(y\mid \omega_{t-1}) &= 0
\end{align*}
Daher kann man $Q\in \cQ^*$ bestimmen, indem man für jede Aktie $k=1,\ldots,d$ und jeden Verzweigungspunkt $t=1,\ldots,T$ die bedingten Wahrscheinlichkeiten $q_t(y\mid \omega_{t-1})$ aus dem folgenden Gleichungssystem bestimmt:
\begin{align*}
\sum_{y\in\tilde\Omega} q_t(y\mid \omega_{t-1}) \Delta X_t^k (\omega_{t-1},y) &= 0 \\
\sum_{y\in\tilde\Omega} q_t(y \mid \omega_{t-1}) &= 1
\end{align*}
für alle $\omega_{t-1}\in \tilde\Omega^{t-1}$, $t=1,\ldots,T$, $k=1,\ldots,d$.

\begin{beispiel}
Gegeben sei ein Markt mit zwei Anlagemöglichkeiten: ein Bond, ein Stock. Wir betrachten den Zeithorizont $T=2$. Die Werte des Bonds seien $B_t=1$ für alle $t=0,1,2$. Die Werte der Aktie zeigt der folgende Baum:
% TODO
% 5 -> (8,4) -> (9,6,6,3)(\omega^1,\dots,\omega^4)
\begin{center}
\begin{tikzpicture}
\draw(0,0) node (5) {5};
\draw(1,0.5) node (8) {8};
\draw(1,-0.5) node (4) {4};
\draw(2,0.9) node (9) {9};
\draw(2,0.3) node (6o) {6};
\draw(2,-0.3) node (6u) {6};
\draw(2,-0.9) node (3) {3};
\draw(2.5,0.9) node {$\omega_1$};
\draw(2.5,0.3) node {$\omega_2$};
\draw(2.5,-0.3) node {$\omega_3$};
\draw(2.5,-0.9) node {$\omega_4$};
\draw[-] (5) -- (8);
\draw[-] (5) -- (4);
\draw[-] (8) -- (9);
\draw[-] (8) -- (6o);
\draw[-] (4) -- (6u);
\draw[-] (4) -- (3);
\draw(0,-1.5) node {t=0};
\draw(1,-1.5) node {t=1};
\draw(2,-1.5) node {t=2};
\end{tikzpicture}
\end{center}

Dann ist $\cF_0=\{\Omega,\emptyset\}$, $\cF_1=\{\emptyset,\{\omega_1,\omega_2\}, \{\omega_3,\omega_4\},\Omega\}$ und $\cF_2=\mathcal P(\Omega)=\cF$.

Für $t=1$ gilt
\begin{align*}
q_1(u)(8-5) + q_1(d) (4-5) &= 0 \\
q_1(u) + q_1(d) &= 1
\end{align*}
woraus man $q_1(u) = \frac14$ und $q_1(d)=\frac34$ berechnen kann.

Für $t=2$ und $y_1=u$ gilt:
\begin{align*}
q_2(u\mid u) (9-8) + q_2(d\mid u)(6-8) &= 0  \\
q_2(u\mid u)  + q_2(d\mid u) &= 1  \\
\end{align*}
woraus man $q_2(u\mid u) = \frac23$ und $q_2(d\mid u) = \frac 13$ berechnen kann.

Für $t=2$ und $y_1=d$ gilt:
\begin{align*}
q_2(u\mid d) (6-4) + q_2(d\mid d)(3-5) &= 0  \\
q_2(u\mid d)  + q_2(d\mid d) &= 1  \\
\end{align*}
woraus man $q_2(u\mid d) = \frac13$ und $q_2(d\mid d) = \frac 23$ berechnen kann.

Insgesamt gilt also
\begin{align*}
Q(\{\omega_1\}) &= \frac 14 \cdot \frac 23 = \frac 16 & Q(\{\omega_2\}) &= \frac14\cdot\frac 13 = \frac 1{12} \\
Q(\{\omega_3\}) &= \frac 14 & Q(\{\omega_4\}) &= \frac 1{2} 
\end{align*}
\end{beispiel}

\begin{bemerkung}
Das Gleichungssystem hat für jedes $t$ und jedes $\omega_t$ $d+1$ Gleichungen in $|\tilde\Omega|$ Unbekannten $q_t(y\mid \omega_t),\omega\in \tilde\Omega$. Eine eindeutige Lösung liegt zum Beispiel dann vor, wenn für alle $\omega_t\in \tilde\Omega^t$, $t=1,\ldots,T$, die Vektoren $(\Delta X_t^k(\omega_{t+1},y), y\in \tilde\Omega)\in \MdR^{|\tilde\Omega|}$ und $(1,\ldots,1)\in\MdR^{|\tilde\Omega|}$ linear unabhängig sind und $d+1=|\tilde\Omega|$ ist.

Anders ausgedrückt: Besteht zwischen der Preisentwicklung der $d$ Aktien keine lineare Abhängigkeit, so existiert ein eindeutiges Martingalmaß im Allgemeinen nur, falls $|\tilde\Omega|=d+1$. Das heißt, wenn die Anzahl der Wertpapiere (Bond und Stock) gleich der Anzahl der möglichen Marktbewegungen ist.
\end{bemerkung}

\section{Konsistente Preissysteme}

Wir betrachten im Folgenden sogenannte konsistente Preissysteme. Darüber kann auch $Q\in \mathcal Q^*$ interpretiert werden.

\begin{definition}
Ein Preissystem\index{Preissystem} ist eine Abbildung $p:\MdR^{|\Omega|} \to \MdR$ mit
\begin{enumerate}
\item für $\alpha_1,\alpha_2\in \MdR$ und Zahlungsansprüche $H_1,H_2\in \MdR^{|\Omega|}$ gilt
\begin{align*}
p(\alpha_1H_1+\alpha_2H_2) = \alpha_1p(H_1) + \alpha_2p(H_2) \tag{„Linearität“}
\end{align*}
\item für $H\ge 0$ gilt $p(H) \ge 0$ und
\begin{align*}
p(H) = 0 \iff \forall \omega\in \Omega: H(\omega) = 0 \tag{„Positivität“}
\end{align*}
\end{enumerate}
Ein Preissystem $p$ heißt konsistent, falls gilt: Ist $H$ ein durch eine selbstfinanzierende Strategie $\varphi$ erreichbarer Zahlungsanspruch, so ist $p(H) = V_0^\varphi$.
\end{definition}

\begin{bemerkung}
Ist $p$ ein konsistentes Preissystem,\index{konsistentes Preissystem} so folgt $p(B_T)=1$, da 
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
mit $\alpha=0$, $\beta=1$ eine Hedging-Strategie für $B_T$ ist, mit $V_0^\varphi =1$.
\end{bemerkung}

\begin{satz}
\begin{enumerate}
\item Sei $p$ ein konsistentes Preissystem. Dann ist $Q$, definiert durch 
\begin{align*}
Q(A) \da p(B_T1_A) \text{ für } A\in \cF,
\end{align*}
in $\cQ^*$.
\item Ist $Q\in \cQ^*$, so ist $p$, definiert durch
\begin{align*}
p(H) \da E_Q\bigg[\frac H {B_T}\bigg] = \sum_{\omega\in\Omega} \frac{H(\omega)}{B_T(\omega)} Q(\{\omega\}) \text{ für } H\in\MdR^{|\Omega|},
\end{align*}
ein konsistentes Preissystem.
\end{enumerate}\label{satz:2.8.3}
\end{satz}

\begin{beweis}
\begin{enumerate}
\item Da $p$ ein konsistentes Preissystem ist, ist $p$ linear und damit gibt es ein $Y\in\MdR^{|\Omega|}$, so dass
\begin{align*}
p(H) = \sum_{\omega\in\Omega} Y(\omega)H(\omega) \tag{$*$}
\end{align*}
Zu zeigen ist, dass $(X_t^k)_{t\in I}$ ein $Q$-Martingal für $k=1,\ldots,d$ ist.
\begin{align*}
E_Q\bigg[\frac H{B_T}\bigg] &= 
\sum_{\omega\in \Omega} \frac{H(\omega)}{B_T} Q(\{\omega\}) \\
&= \sum_{\omega\in \Omega} \frac{H(\omega)}{B_T} p(B_T 1_{\{\omega\}}) \\
&= \sum_{\omega\in \Omega} \frac{H(\omega)}{B_T} (\sum_{\tilde\omega\in\Omega} Y(\tilde\omega)  B_T 1_{\{\omega\}}(\tilde\omega))\\
&= \sum_{\omega\in \Omega} \frac{H(\omega)}{B_T}  Y(\omega) B_T \\
&= \sum_{\omega\in \Omega} H(\omega)Y(\omega) \\
&= p(H)
\end{align*}
Für alle $t=1,\ldots,T$, $k=1,\ldots,d$, $A\in \cF_{t-1}$ existiert eine selbstfinanzierende Handelsstrategie
$\varphi=\left(\begin{smallmatrix} \beta \\ \alpha \end{smallmatrix}\right)$
für den Zahlungsanspruch $H=B_T 1_A\Delta X_t^k$. Dabei gilt: Falls zur Zeit $t-1$ das Ereignis $A$ eingetreten ist, so leihe $\frac{B_T}{B_t} S_{t-1}^k$ aus dem Bond und kaufe damit $\frac{B_T}{B_t}$ Anteile des Stocks $k$.

Zum Zeitpunkt $t-1$ wähle $\beta_t = -\frac 1{B_{t-1}B_t} S_{t-1}^k B_T$ und $\alpha_t = \frac{B_T}{B_t}$. Das Vermögen nach der Zusammenstellung zum Zeitpunkt $t-1$ ist dann 
\[\beta_tB_{t-1}+ \alpha_tS_{t-1}^k = -\frac1{B_{t-1}B_t} S_{t-1}^k B_T B_{t-1} + \frac{B_T}{B_t} S_{t-1}^k = 0\]
und zum Zeitpunkt $t$
\[
\beta_t B_t + \alpha_t S_T = - \frac 1{B_{t-1} B_t} S_{t-1}^k B_T B_{t-1} + \frac{B_T}{B_t} S_t^k = B_T\bigg(\frac{S_t^k}{B_t} - \frac{S_{t-1}^k}{B_{t-1}}\bigg) = B_T\Delta X_t^k
\]
also repliziert $\varphi$ den Zahlungsanspruch $H$.

Also gilt 
\begin{align*}
0=V_0^\varphi = p(H) = E_Q\bigg[\frac H{B_T}\bigg] =  E_Q[1_A \Delta X_t^k]
\end{align*}
und damit ist $(X_t^k)_{t\in I}$ ein $Q$-Martingal.

Mit $(*)$  und der Positivität von $p$ folgt $Y\ge 0$. Damit gilt für alle $A\in \cF$
\[
Q(A) = p(B_T1_A)
= \sum_{\omega\in\Omega} Y(\omega) B_T 1_A(\omega)
=  B_T \sum_{\omega\in A} Y(\omega)
\]
und $Q(A) \ge 0$. Es ist $Q(\Omega)=p(B_T) = 1$, also ist $Q$ ein Wahrscheinlichkeitsmaß.

Sei 
\[
H(\omega)=
\begin{cases}
1, & Y(\omega) =0\\
0, & Y(\omega) >0.
\end{cases}\]
Dann gilt
\begin{align*}
p(H) = 0 &\implies  H= 0\\
&\implies \forall \omega \in \Omega: Y(\omega) >0 \\
&\implies \forall \omega \in \Omega: Q(\{\omega\}) = B_TY(\omega) >0 
\end{align*}
also ist $Q$ ein zu $P$ äquivalentes Martingalmaß.
\item $p$ ist ein Erwartungswert und damit linear. $H\ge 0 \implies p(H)\ge 0$ und $H\ge 0, p(H) = E_Q[\frac{H}{B_T}] = 0 \implies H= 0$ $Q$-fast-sicher und damit, da $Q\in\cQ^*$, auch $P$-fast-sicher. Konsistenz von $p$ ist klar.
\end{enumerate}
\end{beweis}

\begin{satz}
Die folgenden Aussagen sind äquivalent
\begin{enumerate}
\item (NA)
\item $\cQ^*\ne \emptyset$
\item Es gibt ein konsistentes Preissystem (Arrow-Debreu-Preissystem).\index{Arrow-Debreu-Preissystem}
\end{enumerate}
\end{satz}

\begin{beweis}
Die Aussagen folgen sofort aus den Sätzen \ref{satz:2.5.4} und \ref{satz:2.8.3}.
\end{beweis}

\section{Grenzübergang von Cox-Ross-Rubinstein zu Black-Scholes}

Von Korollar \ref{kor:2.4.6} wissen wir, dass der Preis eines europäischen Zahlungsanspruchs mit Laufzeit $T$ der Form $H=f(S_T)$ im Mehrperioden-Cox-Ross-Rubinsteinmodell gegeben ist durch
\[
\pi(H) = E_Q\bigg[\frac{f(S_T)}{B_T}\bigg] = \frac1{B_T} \sum_{k=0}^T \binom T k q^k(1-q)^{T-k} f(S_0 u^k d^{T-k}),
\]
wobei $q=\frac{1+r-d}{u-d}$.

Für den europäischen Call mit $H=f(S_T)=(S_T-K)^+$ gilt dann insbesondere mit
\begin{align*}
a &\da \min\{ k \in \MdN_0 \mid S_0 u^k d^{T-k} - K > 0 \} \\
C_0 \da \pi(H) &= \frac1{B_T} \sum_{k=0}^T \binom Tk q^k (1-q)^{T-k} (S_0 u^k d^{T-k} - K)^+ \\
&= \frac1{B_T} \sum_{k=a}^T \binom Tk q^k (1-q)^{T-k} (S_0 u^k d^{T-k} - K) \\
&= S_0 \sum_{k=a}^T \binom Tk \Big(\frac{q u}{1+r}\Big)^k \Big(\frac{(1-q)d}{1+r}\Big)^{T-k} - \frac{K}{(1+r)^T} \sum_{k=a}^T \binom Tk q^k (1-q)^{T-k} \\
&= S_0 \sum_{k=a}^T \binom Tk \Big(\frac{q u}{1+r}\Big)^k \Big(1- \frac{	qu}{1+r}\Big)^{T-k} - \frac{K}{(1+r)^T} \sum_{k=a}^T \binom Tk q^k (1-q)^{T-k}
\end{align*}

Wir betrachten nun die Konvergenz gegen ein zeitstetiges Modell. Dabei bleibt $T$ fest und wir zerlegen das Intervall $[0,T]$ in $n$ Teilintervalle der Länge $\Delta_n \da \frac Tn$.

Sei $r>0$ eine Zinsrate im stetigen Modell und $(1+r_n)\da e^{r\Delta_n}$.

Weiterhin sei  $u_n = \exp(\sigma \sqrt{\Delta_n})$ und $d_n \da \frac{1}{u_n} = \exp(-\sigma \sqrt{\Delta_n})$ für ein $\sigma>0$ (Volatilität).

Wenn $n$ groß genug ist, ist die (NA)-Bedingung in jedem Fall erfüllt.

Wir definieren $q_n\da \frac{1 + r_n - d_n}{u_n-d_n}$ und 
\[
C_0^{(n)} \da \frac 1{(1+r_n)^n} \sum_{k=0}^n \binom n k q_n^k(1-q_n)^{n-k} (S_0 u_n^k d_n^{n-k} - K)^+
\]
Dann gilt $\lim_{n\to\infty} q_n= \frac 12$ und
\[
C_0^{BS} \da \lim_{n\to\infty} C_0^{(n)} = S_0 \Phi(d) - Ke^{-rT}\Phi(d-\sigma\sqrt{T})
\]
mit
\[
d \da \frac{\log(\frac{S_0}K) + (r + \frac{\sigma^2}{2})T}{\sigma \sqrt{T}}
\]
wobei $\Phi$ die Verteilungsfunktion der Standardnormalverteilung ist. Die Formel für $C_0^{BS}$ ist die Formel von Black und Scholes (1973, Preis für europäische Call-Optionen). Hier ist $r$ der Zinssatz im stetigen Fall, $\sigma$ die Volatilität des Aktien, $S_0$ der Aktienkurs zum Zeitpunkt $t=0$, $T$ der Fälligkeitstermin der Option und $K$ der Ausübungspreis.

Der Black-Scholes-Preis der europäischen Call-Option zum Zeitpunkt $t$ ist gegeben durch
\[
C_t^{BS} = S_t\Phi(d_t) - Ke^{-r(T-t)}\Phi(d_t - \sigma\sqrt{T-t}),\quad d_t \da \frac{\log(\frac{S_t}K) + (r + \frac{\sigma^2}{2})(T-t)}{\sigma \sqrt{T-t}}.
\] 

\begin{beweis}
Für den Konvergenzbeweis setzen wir $a_n \da \min \{k \in\MdN_0: S_0 u_n^k d_n^{n-k} - K > 0\}$. Dann gilt
\begin{align*}
C_0^{(n)} &\da \frac 1{(1+r_n)^n} \sum_{k=0}^n \binom n k q_n^k(1-q_n)^{n-k} (S_0 u_n^k d_n^{n-k} - K)^+ \\
&= \frac 1{(1+r_n)^n} \sum_{k=a_n}^n \binom n k q_n^k(1-q_n)^{n-k} (S_0 u_n^k d_n^{n-k} - K) \\
&= S_0 \underbrace{\sum_{k=a_n}^n \binom n k \Big(\frac{q_nu_n}{1+r_n}\Big)^k \Big(\frac{(1-q_n)d_n}{1+r_n}\Big)^{n-k}}_{\ad \bar B_{n,\hat q_n}(a_n)} - \frac K{(1+r_n)^n} \underbrace{\sum_{k=a_n}^n \binom n k q_n^k (1-q_n)^{n-k}}_{\ad \bar B_{n,q_n}(a_n)}
\end{align*}
Man kann leicht nachrechnen, dass durch
\[
\hat q_n \da \frac{q_nu_n}{1+r_n}
\]
ein weiteres Wahrscheinlichkeitsmaß induziert wird.

Achtung: Der Aktienkurs $S^{(n)}(t)$ hängt von $n$ ab, aber $S^{(n)}(0)=S_0$ für alle $n$.

Es gilt $(1+r_n)^{-n} = \exp(-r \frac T n \cdot n) = e^{-rT}$. Wir zeigen $\lim_{n\to\infty} \bar B_{n,\hat q_n} (a_n) = \Phi(d)$. Sei $Z_n$ eine binomialverteilte Zufallsvariable mit Parametern $(n,\hat q_n)$. Dann ist 
$\bar B_{n,\hat q_n} (a_n) = P(a_n \le Z_n \le n)$. Unser Ziel ist es, den zentralen Grenzwertsatz anzuwenden. Wir normieren deswegen: 
\[
\tilde Z_n \da \frac{Z_n - EZ_n}{\sqrt{\Var(Z_n)}} = \frac{Z_n - n\hat q_n}{\sqrt{n \hat q_n (1-\hat q_n)}} = \frac{\sum_{j=1}^n I_j - n\hat q_n}{\sqrt{n \hat q_n (1-\hat q_n)}}
\]
wobei $I_j$ unabhängig und identisch binomialverteilt mit Parameter $(1,\hat q_n)$.

Seien $\alpha_n \da \frac{a_n - n\hat q_n}{\sqrt{n \hat q_n (1-\hat q_n)}}$, $\beta_n \da \frac{n(1-\hat q_n)}{\sqrt{n \hat q_n (1-\hat q_n)}}$. Man kann zeigen, dass $\lim_{n\to\infty} q_n = \frac 12$ und $\lim_{n\to \infty} n(1-2\hat q_n)\sqrt{\Delta_n} = -T (\frac r\sigma + \frac \sigma 2)$ (siehe Übung). Außerdem ist 
\begin{align*}
S_0 u_n^k d_n^{n-k} - K > 0 &\iff \log(u_n^k d_n^{n-k}) > \log (\frac K {S_0}) \\
&\iff k \log u_n + (n-k)\log d_n > \log (\frac K {S_0})\\
&\iff k > \frac{\log(\frac K {S_0}) - n \log d_n}{\log(\frac{u_n}{d_n})} 
\end{align*}
und $\log (\frac{u_n}{d_n}) = \log(\frac{e^{\sigma{\Delta_n}}}{e^{-\sigma\sqrt{\Delta_n}}}) = 2 \sigma \sqrt{\Delta_n}$ und $\log d_n = - \sigma \sqrt{\Delta_n}$.

Weiter ist
\begin{align*}
\lim_{n\to\infty} \alpha_n &= \lim_{n\to\infty} \frac{a_n - n\hat q_n}{\sqrt{n\hat q_n(1-\hat q_n)}} = \lim_{n\to\infty}\frac{\frac{\log(\frac K {S_0}) - n \log d_n }{\log(\frac{u_n}{d_n})} - n \hat q_n}{\sqrt{n \hat q_n (1-\hat q_n)}} \\
&= \lim_{n\to\infty} \frac{ \log(\frac K {S_0}) - n \log d_n - n\hat q_n 2\sigma \sqrt{\Delta_n}}{\sqrt{n \hat q_n ( 1- \hat q_n)}2\sigma\sqrt{\Delta_n}} \\
= \cdots &= \lim_{n\to\infty} \frac{\log (\frac K{S_0}) + \sigma n \sqrt{\Delta_n}(1-2\hat q_n)}{\sqrt{n \Delta_n \hat q_n (1-\hat q_n)}2\sigma} \\
&= \frac{\log (\frac K {S_0}) - \sigma T (\frac r\sigma + \frac \sigma 2)}{\frac 12 \sqrt T 2\sigma} \\
&= \frac{\log (\frac K {S_0}) - T (r+ \frac{\sigma^2}{2})}{\sigma\sqrt T} \\
&= - \frac{\log(\frac {S_0}K) + T (r + \frac{\sigma^2}{2})}{\sigma\sqrt T} \\
&= - d
\end{align*}
und analog ist
$\lim_{n\to\infty}\beta_{n}= +\infty$. Mit dem zentralen Grenzwertsatz gilt dann
\begin{align*}
\lim_{n\to\infty} B_{n,\hat q_n}(a_n) = \Phi(\lim_{n\to\infty} \beta_n) - \Phi(\lim_{n\to\infty} \alpha_n) = \Phi(\infty) - \Phi(-d) = 1 - \Phi(-d) = \Phi(d)
\end{align*}
und ähnlich zeigt man 
\begin{align*}
\lim_{n\to\infty} \bar B_{n,q_n} = \Phi(d-\sigma\sqrt T).
\end{align*}
\end{beweis}

\section{Amerikanische Optionen}

Europäische Optionen können nur am Ende ihrer Laufzeit zur Zeit $T$ ausgeübt werden. Dagegen können amerikanische Optionen zu jeder Zeit bis zum Ende ihrer Laufzeit, also in $\{0,\ldots,T\}$, ausgeübt werden.
\begin{itemize}
\item Was ist der optimale Ausübungszeitpunkt einer amerikanischen Option?
\item Was ist ein fairer Preis für eine amerikanische Option?
\item Wie sieht eine Hedging-Strategie für eine amerikanische Option aus?
\end{itemize}

Sei $(H_t)_{t\in I}$, $I=\{0,\ldots,T\}$, ein $(\cF_t)$-adaptierter stochastischer Prozess und $\tau:\Omega \to\{0,\ldots,T\}$ eine $(\cF_t)$-Stoppzeit. Dann ist $H_\tau = \sum_{t=0}^T H_t 1_{\{\tau = t\}}$.

\begin{beispiel}[Amerikanische Call-Option]
Es ist $H_t=(S_t-K)^+$. Eine Ausübungsstategie könnte sein: $\tau = \min\{t\in \MdN: S_t\ge K\} \wedge T$ ($\tau$ ist eine Stoppzeit, vergleiche Beispiel \ref{bsp:2.1.24}). Dann ist
$H_\tau = \sum_{t=0}^T (S_t-K)^+ 1_{\{\tau = t\}}$.

Für ein festes $\tau$ ist $H_\tau$ ein Zahlungsanspruch und damit ist sein Preis $\pi(H_\tau) = E_Q[\frac{H_\tau}{B_\tau}]$.
\end{beispiel}

\begin{bemerkung}
Wir gehen im Folgenden immer von einem vollständigen, arbitragefreien Markt aus. Damit ist das äquivalente Martingalmaß $Q$ eindeutig. Wir definieren den Preis einer amerikanischen Option durch 
\[
\pi^A(H) = \sup_{\tau}E_Q\left[\frac{H_\tau}{B_\tau}\right]
\]
wobei das Supremum über alle Stoppzeiten $\tau$ mit $\tau\le T$ genommen wird.

Warum ist diese Definition sinnvoll? Angenommen, $\pi^A(H) < \sup_{\tau}E_Q\left[\frac{H_\tau}{B_\tau}\right]$. Dann gibt es eine Stoppzeit $\tilde\tau$, so dass $\pi^A(H) < E_Q\left[ \frac{H_{\tilde\tau}}{B_{\tilde\tau}}\right]$. Kaufe die amerikanische Option zum Preis $\pi^A(H)$ und übe sie mit $\tilde\tau$ aus und verkaufe eine Hedging-Strategie für $\frac{H_{\tilde\tau}}{B_{\tilde\tau}}$. Dann ergibt sich ein risikoloser Gewinn von $E_Q\left[ \frac{H_{\tilde\tau}}{B_{\tilde\tau}}\right] -\pi^A(H) > 0$, im Widerspruch zu (NA).

Der Fall $\pi^A(H) > \sup_{\tau}E_Q\left[\frac{H_\tau}{B_\tau}\right]$ wird später besprochen.
\end{bemerkung}

Zur Bewertung einer amerikanischen Option muss ein optimales Stopp-Problem gelöst werden. Sei $(X_t)_{t\in I}$, $I=\{0,\ldots,T\}$ ein $(\cF_t)$-adaptierter stochastischer Prozess mit $E|X_t|<\infty$ für alle $t\in I$. Zu lösen ist $\sup_{\tau} EX_\tau$.

\begin{definition}
Ein stochastischer Prozess $(Z_t)_{t\in I}$ definiert durch
$Z_T = X_T$ und $Z_t = \max\{X_t, E[Z_{t+1}\mid \cF_t]\}$ für $t=T-1,\ldots,0$ heißt Snell-Einhüllende\index{Snell-Einhüllende} (snell envelope) von $(X_t)$.
\end{definition}

\begin{satz}
\label{satz:2.10.4}Die Snell-Einhüllende $(Z_t)$ von $(X_t)$ ist ein Supermartingal und das kleinste Supermartingal, das $(X_t)$ dominiert (das heißt $Z_t\ge X_t$ fast sicher für alle $t\in I$).
\end{satz}

\begin{beweis}
Nach Definition gilt $Z_t \geq E[Z_{t+1}\mid \cF_t]$ für $t=T-1,\ldots,0$ und $Z_t \ge X_t$.

Sei $(Y_t)$ ein weiteres Supermartingal mit $Y_t \ge X_t$. Wir zeigen $Y_t \ge Z_t$.

Induktion nach $t$ (rückwärts): Es gilt $Y_T \ge X_T = Z_T$. Weiter gilt $Y_{t-1} \ge E[Y_t\mid \cF_{t-1}] \ge E[Z_t\mid \cF_{t-1}]$ und $Y_{t-1} \ge X_{t-1}$. Daher ist $Y_{t-1} \ge \max\{X_{t-1}, E[Z_t\mid \cF_t]\} = Z_{t-1}$.
\end{beweis}

\begin{lemma}
Sei $\tau^* \da \inf \{t\ge 0 : Z_t = X_t\}$. Dann ist $\tau^*$ eine Stoppzeit und der gestoppte Prozess $(Z_{t\wedge \tau^*})_{t\in I}$ ist ein Martingal.\label{lem:2.10.5}
\end{lemma}

\begin{beweis}
Da $Z_T=X_T$ ist $\tau^*\in\{0,1,\ldots,T\}$ wohldefiniert. Für $t=0$ gilt $\{\tau^*=0\} = \{Z_0=X_0\} \in \cF_0$, da $X_0$ $\cF_0$-messbar ist. Für $t\ge 1$ ist $\{\tau^* = t\} = \{Z_0 > X_0\}\cap\cdots\cap \{Z_{t-1} > X_{t-1}\}\cap \{Z_t = X_t \} \in \cF_t$, da $\{Z_i > X_i\} \in \cF_i \subseteq \cF_t$ für alle $i=\{0,\ldots,t-1\}$ und $\{Z_t=X_t\} \in \cF_t$. Daher ist $\tau^*$ eine Stoppzeit.

Für $t\le T-1$ gilt $Z_{(t+1)\wedge \tau^*} - Z_{t\wedge \tau^*} = 1_{\{t+1\le \tau^*\}}(Z_{t+1} - Z_t)$. Nach Definition von $\tau^*$ gilt auf der Menge $\{t+1\le \tau^*\}$: $Z_t > X_t$ und wegen der Definition von $Z_t$ gilt dann $Z_t = E[Z_{t+1} \mid \cF_t]$ auf $\{t+1 \le \tau^*\}$. Daher gilt $Z_{(t+1)\wedge \tau^*} - Z_{t\wedge \tau^*} = 1_{\{t+1\le \tau^*\}}(Z_{t+1} - E[Z_{t+1} \mid \cF_t])$, denn für $\tau^*\le t$ sind beide Seiten Null.

Wir betrachten nun die bedingte Erwartung unter $\cF_t$ auf beiden Seiten. Da $\{t+1\le \tau^*\} = \{\tau^* \le t\}^c \in \cF_t$, gilt dann
\begin{align*}
E[Z_{(t+1)\wedge \tau^*} - Z_{t\wedge \tau^*}\mid \cF_t]
&= E[1_{\{t+1\le \tau^*\}}(Z_{t+1} - E[Z_{t+1} \mid \cF_t])\mid \cF_t]\\
&= 1_{\{t+1\le \tau^*\}}E[Z_{t+1} - E[Z_{t+1} \mid \cF_t]\mid \cF_t]\\
&= 1_{\{t+1\le \tau^*\}}(E[Z_{t+1} \mid \cF_t] -E[Z_{t+1} \mid \cF_t])\\
&= 0.
\end{align*}
Daher ist $E[Z_{(t+1)\wedge \tau^*}\mid \cF_t] =  Z_{t\wedge \tau^*}$ und $Z_{t\wedge \tau^*}$ ist ein Martingal.
\end{beweis}

\begin{satz} Die Stoppzeit
\[
\tau^* = \inf\{t \ge 0: Z_t = X_t\}
\]
löst das Stopp-Problem $\sup_{\tau}E[X_\tau]$ und es gilt $Z_0 = E[X_{\tau^*}] = \sup_\tau E[X_\tau]$.
\end{satz}

\begin{beweis}
Da nach Lemma \ref{lem:2.10.5} der Prozess $(Z_{t\wedge \tau^*})$ ein Martingal ist, gilt $Z_0 = Z_{0\wedge \tau^*} = E[Z_{T\wedge \tau^*}] = E[Z_{\tau^*}]=E[X_{\tau^*}]$. Für eine beliebige Stoppzeit $\tau$ gilt dann wegen Satz \ref{satz:2.1.35}
$Z_0 = Z_{0\wedge \tau} \ge E[Z_{T \wedge\tau}] = E[Z_\tau] \ge E[X_\tau]$.
\end{beweis}

Wir verwenden nun diese Ergebnisse, um den Preis einer amerikanischen Option zu bewerten. Hier ist $X_t = \frac{H_t}{B_t}$, $t=0,\ldots,T$, und gesucht ist die Lösung von $\sup_\tau E_Q[\frac{H_\tau}{B_\tau}]$.

\begin{korollar}
Sei $(Z_t)_{t\in I}$ die Snell-Einhüllende von $(\frac{H_t}{B_t})_{t\in I}$ bezüglich dem Wahrscheinlichkeitsmaß $Q$ und $\tau^* = \inf\{t\ge 0: Z_t= X_t\}$. Dann ist der Preis der amerikanischen Option gegeben durch
\[
\pi^A(H) = \sup_{\tau}E_Q\left[\frac{H_\tau}{B_\tau}\right] = E_Q\left[\frac{H_{\tau^*}}{B_{\tau^*}}\right] = Z_0
\]
und $\tau^*$ ist die optimale Ausübungsstategie.
\end{korollar}

\begin{beispiel}[Amerikanische Calloption]
Hier ist $H_t = (S_t - K)^+$, $t\in I$. Dann ist 
\begin{align*}
\frac{H_t}{B_t} = \left(\frac{S_t}{B_t} - \frac{K}{B_t}\right)^+ = \left( X_t - \frac{K}{B_t}\right)^+.
\end{align*}
Die Funktion $g(x) = \left(x - \frac{K}{B_{t+1}}\right)^+$ ist konvex. Aus der Jensen-Ungleichung folgt dann
\begin{align*}
\frac{H_t}{B_t} \le g(X_t) = g(E_Q[X_{t+1}\mid \cF_t]) \le E_Q[g(X_{t+1}) \mid \cF_t] = E_Q[\frac{H_{t+1}}{B_{t+1}}\mid \cF_t].
\end{align*}
Daher ist $\frac{H_t}{B_t}$ ein Submartingal unter $Q$.

Für beliebige beschränkte Stoppzeiten $\sigma\le\tau$ gilt nach Satz \ref{satz:2.1.33}
\begin{align*}
\frac{H_\sigma}{B_\sigma} \le E_Q\left[\frac{H_\tau}{B_\tau}\mid \cF_\sigma\right] 
\implies E_Q\left[\frac{H_\sigma}{B_\sigma}\right] \le E_Q\left[\frac{H_\tau}{B_{\tau}}\right].
\end{align*}
Da $\tau\le T$ für alle $\tau$ gilt:
\[
\sup_{\tau} E_Q\left[\frac{H_\tau}{B_\tau}\right] = E_Q\left[\frac{H_T}{B_T}\right].
\]
Das heißt die amerikanische Calloption wird erst am Ende der Laufzeit ausgeübt und hat den gleichen Preis wie eine europäische Calloption.
\end{beispiel}

\subsection{Amerikanische Optionen im Cox-Ross-Rubinsteinmodell}

Sei $(H_t)_{t\in I}$ ein $(\cF_t)$-adaptierter stochastischer Prozess. Sei $\tilde X_t = \frac{H_t}{B_t}$ und $(Z_t)$ die Snell-Einhüllende von $(\tilde X_t)$. Wir betrachten den Spezialfall, dass $H_t$ nur von $S_t$ abhängt (und nicht wie im Allgemeinen  $H_t = h(S_0,\ldots,S_t)$), das heißt $H_t = h(S_t)$. Zum Beispiel beim amerikanischen Put gilt $h(s) = (K-s)^+$.

Im Cox-Ross-Rubinsteinmodell ist $S_t = S_0 \prod_{k=1}^t Y_k$ und $Q(Y=u) = q = \frac{1+r-d}{u-d}$ ist die risikoneutrale Wahrscheinlichkeit für eine Aufwärtsbewegung des Aktienkurses. Dann gilt:
\begin{align*}
Z_T &= \tilde X_T = \frac{h(S_T)}{B_T} = \frac{h(S_T)}{(1+r)^T} &&\ad V_T(S_T) \\
Z_{T-1} &= \max\{\tilde X_{T-1}, E_Q[Z_T\mid \cF_{T-1}]\} \\
&= \max \{\frac{h(S_{T-1})}{(1+r)^{T-1}} , E_Q[V_{T}(S_{T-1}Y_T) \mid \cF_{T-1}]\} \\
&= \max \{ \frac{h(S_{T-1})}{(1+r)^{T-1}}, q  V_T(S_{T-1} u) + (1-q) V_T(S_{T-1}d) \} &&\ad V_{T-1}(S_{T-1}) \\
Z_t &= \max \{ \frac{h(S_t)}{(1+r)^t} , q V_{t+1}(S_t u) + (1-q) V_{t+1}(S_t d)\} &&\ad V_{t}(S_t) \\
Z_0 &= \max \{h(S_0), q V_1(S_0u)+ (1-q)V_1(S_0d)\}
\end{align*}

\subsection{Preisvergleich zwischen amerikanischen und europäischen Optionen}

\begin{bemerkung}
\begin{enumerate}
\item Sei $\varphi$ eine selbstfinanzierende Handelsstrategie. Dann ist $\frac{V_t^\varphi}{B_t}$ ein $Q$-Martingal (siehe Satz \ref{satz:2.5.1}).
\item Sei $H$ ein Zahlungsanspruch und $\varphi$ eine selbstfinanzierende Hedging-Strategie für $H$. Dann ist der Preis für die zugehörende europäische Option zur Zeit $t$ gegeben durch $V_t^\varphi = B_t E_Q[\frac{V_T}{B_T} \mid \cF_t] = E_Q[ \frac{B_t}{B_T} H \mid \cF_t]$ (siehe Satz \ref{satz:2.5.8}).
\end{enumerate}
\end{bemerkung}

Sei $(H_t)_{t\in I}$ gegeben. Der Preis der zugehörenden amerikanischen Option zur Zeit $t$ ist 
\begin{align*}
\sup_{t\le \tau \le T} E_Q [\frac{B_t}{B_\tau}H_\tau \mid \cF_t] = B_t Z_t \ad \tilde Z_t
\end{align*}
wobei $(Z_t)$ die Snell-Einhüllende von $\frac{H_t}{B_t}$ ist.

\begin{satz}
Der Preis der amerikanischen Option ist zu jedem Zeitpunkt größer oder gleich dem Preis der entsprechenden europäischen Option: also $\tilde Z_t \ge V_t$ für alle $t\in I$.

Ist $\frac{H_t}{B_t}$ ein $Q$-Submartingal, dann sind die Preise gleich, also $\tilde Z_t = V_t$ für alle $t\in I$ und $\tau^*=T$ ist der optimale Ausübungszeitpunkt der amerikanischen Option.
\end{satz}

\begin{beweis}
Da $\tau = T$ eine Stoppzeit ist, gilt $\tilde Z_t = B_t \sup_{t\le \tau\le T} E_Q[\frac{H_\tau}{B_\tau} \mid \cF_t] \ge B_t E_Q[\frac{H_T}{B_T}\mid \cF_t] = V_T$ für $t\in I$.

Ist $\left(\frac{H_t}{B_t}\right)$ ein $Q$-Submartingal, so gilt für alle $t=0,1,\ldots,T$: 
\[
\frac{H_t}{B_t} \le E_Q\left[\frac{H_T}{B_T}\mid \cF_t\right] \iff H_t \le B_t E_Q\left[ \frac{H_T}{B_T}\mid \cF_t\right] = V_t
\]
also ist $H_t \le V_t$ für alle $t=0,\ldots,T$ und daher $\frac{V_t}{B_t} \ge \frac{H_t}{B_t}$. Da $\left(\frac{V_t}{B_t}\right)$ ein $Q$-Martingal ist (und damit auch ein $Q$-Supermartingal) folgt mit Satz \ref{satz:2.10.4} für alle $t=0,\ldots,T$: $Z_t \le \frac{V_t}{B_t}$ und daher $\tilde Z_t \le V_t$. Daher gilt dann also für alle $t=0,\ldots,T$: $\tilde Z_t = V_t$.
\end{beweis}

Im Folgenden sei $C_t^E$ der Preis der europäischen Call-Option und $C_t^A$ der Preis der amerikanischen Call-Option zur Zeit $t$ und $P_t^E$ beziehungsweise $P_t^A$ der Preis der europäischen beziehungsweise amerikanischen Put-Option zur Zeit $t$.

\begin{satz}
Es gelten die folgenden Zusammenhänge:
\begin{enumerate}
\item Put-Call-Parität: Für $t=0,\ldots,T$:
\[
C_t^E - P_t^E = S_t - K \frac{B_t}{B_T}
\]
\item Für $t=0,\ldots,T$ gilt
\[
S_t - K \le C_t ^A - P_t^A \le S_t - K\frac{B_t}{B_T}
\]
\end{enumerate}
\end{satz}

\begin{beweis}
\begin{enumerate}
\item Es gilt $C_t^E = B_t E_Q[\frac{H_T}{B_T}\mid \cF_t]$ mit $H_T = (S_T - K)^+$ und $P_t^E = B_tE_Q[\frac{\tilde H_T}{B_T} \mid \cF_t]$ mit $\tilde H_T = (K-S_T)^+$. Es gilt $H_T+K=\max\{S_T,K\} = \tilde H_T + S_T$ und damit
\begin{align*}
\frac 1 {B_t} (C_t^E - P_t^E) &= E_Q[\frac{H_T - \tilde H_T}{B_T}\mid \cF_t]\\
 & = E_Q[\frac{S_T - K}{B_T}\mid \cF_t] \\
&= E_Q[\frac{S_T}{B_T}\mid \cF_t] - \frac{K}{B_T} \\
&= \frac{S_t}{B_t} - \frac{K}{B_T}
\end{align*}
\item Aus $P_t^A \ge P_t^E$ und $C_t^A = C_t^E$ folgt für alle $t=0,\ldots,T$ 
\begin{align*}
C_t^A - P_t^A \le C_t^E - P_t^E = S_t - K\frac{B_t}{B_T}.
\end{align*}
Wir müssen noch zeigen, dass $C_t^A + K \ge P_t^A + S_t$ ist. Wir setzen 
\[
Y \da \frac{(S_T-K)^+}{B_T} + \frac K {B_t}
\]
dann ist $Y \ge \frac{K}{B_t}$ und $Y\ge \frac{S_T}{B_T}$, da  $B_T\ge B_t$ und
\[
Y = \frac{(S_T-K)^+}{B_T} + \frac K {B_t} = \frac{\max\{S_t,K\}-K}{B_T} + \frac K{B_t} = \frac{\max\{S_T,K\}}{B_T} + K(\frac{1}{B_t} - \frac 1 {B_T}) \ge \frac{S_T}{B_T}.
\]
Sei $\tau$ eine beliebige Stoppzeit $t\le \tau \le T$. Dann gilt
\begin{align*}
E_Q[Y\mid \cF_\tau] &\ge E_Q[\frac{K}{B_t} \mid \cF_\tau] = \frac{K}{B_t} \ge \frac{K}{B_\tau}\\
E_Q[Y\mid \cF_\tau] &\ge E_Q[\frac{S_T}{B_T} \mid \cF_\tau] = \frac{S_\tau}{B_\tau} \\
\implies E_Q[Y\mid \cF_\tau] & \ge \max\{\frac{K}{B_\tau}, \frac{S_\tau}{B_\tau}\} = \frac{\max\{K,S_\tau\}}{B_\tau}
\end{align*}
Daher gilt 
\begin{align*}
C_t^A + K &= C_t^E + K = B_t E_Q[Y\mid \cF_t]\\
&= B_t E_Q[ E_Q[Y\mid \cF_\tau ] \mid \cF_t] \\
&\ge B_t E_Q[ \frac{\max\{K,S_\tau\}}{B_\tau} \mid \cF_t] \\
&= B_t E_Q[\frac{( (K-S_\tau)^+ + S_\tau)}{B_\tau}  \mid \cF_t] \\
&= B_t E_Q[ \frac{(K-S_\tau)^+}{B_\tau} \mid \cF_t ] + B_t E_Q[\frac{S_\tau}{B_\tau}\mid \cF_t] \\
&= B_t E_Q[ \frac{(K-S_\tau)^+}{B_\tau} \mid \cF_t ] + S_t
\end{align*}
insbesondere gilt dann $C_t^A + K \ge \sup_{\tau} (B_t E_Q[\frac{(K-S_\tau)^+}{B_\tau}\mid \cF_t]) + S_t$ und daher $C_t^A + K \ge P_t^A + S_t$.
\end{enumerate}
\end{beweis}

\subsection{Hedging einer amerikanischen Option}

Wir betrachten weiterhin einen vollständigen, arbitragefreien Markt. Eine selbstfinanzierende Handelsstrategie $\varphi$ ist eine Hedging-Strategie für eine amerikanische Option basierend auf $(H_t)$, falls für alle $t=0,\ldots,T$ gilt: $V_t^\varphi \ge H_t$.

Wir zeigen, dass es eine Hedging-Strategie $\varphi$ gibt mit
\begin{align*}
V_0^\varphi = \pi^A(H) = \sup_{\tau} E_Q[\frac{H_\tau}{B_\tau}] = Z_0
\end{align*}
wobei $(Z_t)$ die Snell-Einüllende von $(\frac{H_t}{B_t})$ ist.

Nach Satz \ref{satz:2.10.4} ist $(Z_t)$ ein Supermartingal. Aus Lemma \ref{lem:2.1.18} folgt $Z_t = M_t + A_T$ wobei $(M_t)$ ein Martingal ist und $(A_t)$ mit $A_0=0$ ein fallender, vorhersehbarer Prozess. Insbesondere ist $A_{t+1} \le A_t \le \cdots \le A_1 \le A_0 = 0$.

Da der Markt vollständig ist, gibt es eine Hedging-Strategie $\varphi$ für den Zahlungsanspruch $B_TM_T$. Wir zeigen, dass $\varphi$ eine Hedging-Strategie für die amerikanische Option ist. Wir zeigen $V_t^\varphi \ge H_t$ für $t=0,\ldots,T$.

Für $t=T$ gilt $V_T^\varphi = B_T M_T \ge B_TZ_T = B_T \frac{H_T}{B_T} = H_T$, da nach Definition der Snell-Einhüllenden $Z_T = \frac{H_T}{B_T}$ gilt. Wegen $A_T \le A_0=0$ und $Z_T = M_T + A_T$ gilt auch $M_T \ge Z_T$.

Für $t<T$ gilt $V_t^\varphi = B_t E_Q[\frac{B_TM_T}{B_T}\mid \cF_t] = B_tE_Q[M_T\mid \cF_t] = B_t M_t \ge B_tZ_t \ge B_t \frac{H_t}{B_t} = H_t$.

Dann ist der Preis für die Hedging-Strategie $\varphi$
\begin{align*}
V_0^\varphi = E_Q[\frac{B_TM_T}{B_T}] = E_Q[M_T] = M_0 = M_0 + A_0 = Z_0.
\end{align*}
Also gilt auch $\pi^A(H) = \inf\{V_0^\varphi \mid \varphi\text{ ist eine selbstfinanzierende Hedging-Strategie für $(H_t)$}\}$. Mit der so konstruierten Hedging-Strategie können wir die Begründung vom „fairen“ Preis für eine amerikanische Option abschließen:

Angenommen, es sei $\pi^{A}(H) > \sup_\tau E_Q[\frac{H_\tau}{B_\tau}]$. Wir verkaufen die Option zum Preis $\pi^A(H)$ und realisieren mit dem Betrag $\sup_{\tau}E_Q[\frac{H_\tau}{B_\tau}]$ eine Hedging-Strategie wie oben angegeben. In diesem Fall ist ein risikoloser Gewinn dieser Differenz möglich. Ähnlich folgt für die optimale Ausübungsstrategie $\tau^*$, dass $V_{\tau^*}^\varphi = H_{\tau^*}$, das heißt wir verkaufen die amerikanische Option zum fairen Preis und übt der Käufer optimal aus, so bleibt in diesem Fall kein Gewinn übrig.


\section{Exotische Optionen}
Wir betrachten nun Optionen, deren Auszahlung vom Maximum des Aktienkurses abhängen.

\begin{beispiel}
\begin{itemize}
\item Up-and-in-Call-Option
\[
H_{\text{u\&i}}^{\text{Call}} = 
\begin{cases}
(S_T-K)^+ & \text{falls }\max_{0\le t\le T}S_t \ge B \\
0 & \text{sonst}
\end{cases}
\]
\item Up-and-out-Call-Option
\[
H_{\text{u\&o}}^{\text{Call}} = 
\begin{cases}
0 & \text{falls }\max_{0\le t\le T}S_t \ge B \\
(S_T-K)^+ & \text{sonst}
\end{cases}
\]
\item Lookback-Put-Option
\[
H_{\text{max}}^{\text{Put}} =  \max_{0\le t\le T} S_t - S_T
\]
\end{itemize}
\end{beispiel}

Wir betrachten später eine spezielle Form des $T$"~Perioden"~Cox"~Ross"~Rubinsteinmodells, das uns erlaubt, eine explizite Preisformel für obige Beispiele zu bekommen. Dabei wird das \emph{Spiegelungsprinzip} eine zentrale Rolle spielen.

Sei $\Omega \da \{-1,+1\}^T = \{\omega = (\gamma_1,\ldots,\gamma_T): \gamma_i\in\{-1,+1\}\}$. Für $\omega=(\gamma_1,\ldots,\gamma_T)$ sei 
\[
\Gamma_t(\omega) =\Gamma_t( (\gamma_1,\ldots,\gamma_T) ) = 
\begin{cases}
+1, &\text{falls }\gamma_t = 1\\
-1, &\text{falls }\gamma_t = -1
\end{cases}
\]
die Projektion auf die $t$-te Komponente.

Sei $Z$ gegeben duch $Z_0 \da 0$, $Z_t \da \sum_{i=1}^t \Gamma_i$, $t=1,\ldots,T$.

Sei $P(\{\omega\}) = 2^{-T}$ für alle $\omega\in \Omega$.
Unter dem Maß $P$ sind die Zufallsvariablen $\Gamma_t$ unabhängig mit Verteilung $P(\Gamma_t = 1)=\frac12$. Daher ist der Prozess $Z$ eine symmetrische Irrfahrt unter $P$.

Daher gilt 
\[
P(Z_t=k) =
\begin{cases}
2^{-t} \binom{t}{\frac{t+k}2},& \text{falls $t+k$ gerade} \\
0 ,&\text{sonst}
\end{cases}
\]

\begin{bemerkung}
Es führen $3 = \binom{3}{\frac{3-1}{2}}$ Wege zu $-1$. Man benötigt immer eine Aufwärtsbewegung und zwei Abwärtsbewegungen.
\begin{center}
\begin{tikzpicture}[x=3cm,y=1cm]
\draw (0,0) node (0) {0} ;
\draw (1,1) node (1) {1};
\draw (1,-1) node (-1) {-1};
\draw (2,2) node (2) {2};
\draw (2,0) node (0') {0};
\draw (2,-2) node (-2) {-2};
\draw (3,3) node (3) {3};
\draw (3,1) node (1') {1};
\draw (3,-1) node (-1') {-1};
\draw (3,-3) node (-3) {-3};

\draw [red,decorate,decoration={name=zigzag,segment length=4pt,raise=3pt,amplitude=1pt}]
(0) .. controls (1) .. (2,0) -- (-1');
\draw [blue,decorate,decoration={name=bumps,segment length=8pt,raise=-3pt,amplitude=2pt}]
(0) .. controls (-1) .. (2,0) -- (-1');
\draw [green,decorate,decoration={name=saw,segment length=4pt,raise=3pt,amplitude=2pt}]
(0) -- (1,-1) .. controls (-2) .. (-1');
\draw (0) -- (1);
\draw (0) -- (-1);
\draw (1) -- (2);
\draw (1) -- (0');
\draw (-1) -- (0');
\draw (-1) -- (-2);
\draw (2) -- (3);
\draw (2) -- (1');
\draw (0') -- (1');
\draw (0') -- (-1');
\draw (-2) -- (-1');
\draw (-2) -- (-3);
\end{tikzpicture}
\end{center}
Eine Irrfahrt $Z_t$ mit insgesamt $t$ Schritten besteht aus $n_u\ge 0$ Aufwärtsbewegungen und $n_d\ge 0$ Abwärtsbewegungen mit $n_u + n_d = t$. Dann ist der Wert der Irrfahrt $k = n_u \cdot 1 + n_d \cdot (-1)$, also $k = n_u - (t-n_u) = 2n_u - t$.
Das heißt $k+t = 2n_u$ und daher ist $k+t$ gerade.

Angenommen, die Irrfahrt besteht aus $\frac{t+k}2$ Aufwärtsbewegungen und $\frac{t-k}2$ Abwärtsbewegungen, dann ist der Wert der Irrfahrt $\frac{t+k}2\cdot 1 + \frac{t-k}2\cdot (-1) = k$. Es gibt $\binom{t}{\frac{t+k}2}$ Möglichkeiten $\frac{t+k}2$ Aufwärtsschritte bei insgesamt $t$ Schritten zu machen. Alle diese Wege sind unter $P$ gleichwahrscheinlich.
\end{bemerkung}

Im Folgenden sei $M_t \da \max_{0\le s\le t} Z_s$ das laufende Maximum des Prozesses $Z$. Für den folgenden Satz nehmen wir an, dass der Prozess $Z$ bis zur Zeit $T+1$ definiert ist. Das kann durch geeignete Erweiterung des Wahrscheinlichkeitsraums erreicht werden.

\begin{satz}[Spiegelungsprinzip]
\label{satz:2.11.3}
Für alle $k\in \MdN$, $l\in \MdN_0$ gilt 
\[
P(M_T\ge k, Z_T=k-l) = P(Z_T=k+l)
\]
und
\[
P(M_T = k , Z_T = k-l) = 2 \frac{k+l+1}{T+1} P (Z_{T+1} = 1 + k + l)
\]
\end{satz}

\begin{center}
\begin{tikzpicture}
\draw (0,0) node[left] (0) {0};
\draw (0,2) node[left] {$k$};
\draw (0,5) node[left] {$k+l$};
\draw (0,-1) node[left] {$k-l$};
\draw[->] (0,-1.5) -- (0,6);
\draw (0,0) -- (1,1) -- (2,0) -- (3,1) -- (4,2) -- (5,3) -- (6,2) -- (7,1) -- (8,0) -- (9,1) -- (10,0) -- (11,-1);
\draw[dashed] (4,2) -- (5,1) -- (6,2) -- (7,3) -- (8,4) -- (9,3) -- (10,4) -- (11,5);
\draw[->] (0,0) -- (11.5,0);
\draw (11,0) node[below] {$T$};
\draw[dotted] (0,-1) -- (11.5,-1);
\draw[dotted] (0,2) -- (11.5,2);
\draw[dotted] (0,5) -- (11.5,5);
\end{tikzpicture}
\end{center}
\begin{beweis}
Sei $\tau(\omega) \da \{ t\ge 0: Z_t = k\} \wedge T$. Für $\omega=(\gamma_1,\ldots,\gamma_T)\in \Omega$ definieren wir $f(\omega) = \omega$, falls $\tau = T$ und $f(\omega) = (\gamma_1,\ldots,\gamma_{\tau(\omega)},-\gamma_{\tau(\omega)+1},\ldots,-\gamma_T)$, falls das Niveau $k$ vor dem Endzeitpunkt $T$ erreicht wird. Man sieht im Bild, dass die zwei Pfade $(Z_t(\omega))$ und $(Z_t(f(\omega)))$ bis zur Zeit $\tau(\omega)$ übereinstimmen. Ab $\tau(\omega)$ erhält man den neuen Pfad durch Spiegelung des ursprünglichen Pfades an der horizontalen Achse zum Niveau $k$.

Sei $A_{k,l} \da \{\omega\in\Omega\mid M_T(\omega) \ge k, Z_T(\omega) = k -l\}$. Dann ist $f$ eine Bijektion von $A_{k,l}$ in die Menge $\{\omega\in\Omega\mid M_T(\omega) \ge k, Z_T(\omega) = k + l\}$. Da $l\ge 0$ gilt $\{\omega\in\Omega\mid M_T\ge k, Z_T = k+l\} = \{\omega\in\Omega\mid Z_T = k+l\}$. Daher teilt die Gleichverteilung $P$ die beiden Mengen $A_{k,l}$, $\{\omega\in\Omega\mid Z_T(\omega) = k+l\}$ die gleiche Wahrscheinlichkeiten zu. Daher gilt die erste Gleichung.

Die zweite Gleichung ist klar, falls $T + k + l$ ungerade ist, da dann $P(Z_{T+1} = 1 + k + l) = 0$ und auch $T+k-l$ ungerade ist, und damit die linke Seite auch $0$ ist.

Sei $j \da\frac{T+k+l}2$.  Wir verwenden die Verteilung von $(Z_t)$ und den ersten Teil des Satzes.  Es gilt
\begin{align*}
P(M_T=k,Z_T = k-l) &= P(M_T\ge k, Z_T = k-l) - P(M_T\ge k+1 , Z_T = k-l) \\
&= P(Z_T = k+l) - P(M_T \ge k+1, Z_T=(k+1)-(l+1)) \\
&= P(Z_T = k+l) - P(Z_T = k+l+2) \\
&= 2^{-T} \binom{T}{j} - 2^{-T} \binom{T}{j+1} \\
&= 2^{-T} \binom{T+1}{j+1} \frac{2j+1-T}{T+1} \\
\intertext{sowie}
2 \frac{k+l+1}{T+1} \cdot P (Z_{T+1} = 1 + k +l) &= 2\frac{k+l+1}{T+1} 2^{-(T+1)} \binom{T+1}{\frac{T+k+l+2}2} \\
&= 2^{-T} \binom{T+1}{j+1}\frac{T+k+l+1-T}{T+1}  \\
&= 2^{-T} \binom{T+1}{j+1}\frac{2j+1-T}{T+1} 
\end{align*}
\end{beweis}

Für die Bewertung von exotischen Optionen benötigen wir das Martingalmaß $Q$ und nicht $P$. Falls die Gleichverteilung $P$ durch das Martingalmaß $Q$ ersetzt wird, erhält man
\begin{align*}
Q(Z_t = k ) =
\begin{cases}
q^{\frac{t+k}2} (1-q)^{\frac{t-k}2} \binom{t}{\frac{t+k}2}, &\text{falls $t+k$ gerade}\\
0 &\text{sonst.}
\end{cases}
\end{align*}

Wir formulieren das Spiegelungsprinzip unter $Q$:

\begin{satz}[Spiegelungsprinzip unter \textit{Q}]
\label{satz:2.11.4}
Für alle $k\in \MdN$, $l\in\MdN_0$ gilt
\begin{align*}
Q(M_T\ge k, Z_T=k-l)&=\left(\frac{1-q}{q}\right)^l Q(Z_T=k+l)  \\
&=\left(\frac{q}{1-q}\right)^k Q(Z_T=-k-l)\\
Q(M_T=k,Z_T=k-l)&=\frac{1}{q} \left(\frac{1-q}{q}\right)^l \frac{k+l+1}{T+1} Q(Z_{T+1}=1+k+l)\\
&=\frac{1}{1-q} \left(\frac{q}{1-q}\right)^k \frac{k+l+1}{T+1} Q(Z_{T+1}=-1-k-l)
\end{align*}
\end{satz}
\begin{beweis}
Wir zeigen zuerst, dass die Dichte von $Q$ bezüglich $P$ gegeben ist durch 
\begin{align*}
\frac{dQ}{dP}=2^T q^{\frac{T+Z_T}{2}}(1-q)^{\frac{T-Z_T}{2}} \tag{$\star$}
 \end{align*}
Das Maß $Q$ ordnet jedem $\omega=(\gamma_1,\ldots,\gamma_T)$ $\in\Omega$, das genau $k$ Komponenten mit $\gamma_i=+1$ enthält, die Wahrscheinlichkeit $Q(\omega)=q^k(1-q)^{T-k}$ zu. Für solche $\omega$ gilt aber genau $Z_T(\omega)=k-(T-k)=2k-T$ und damit gilt die Gleichung für die Dichte.

Daher folgt aus ($\star$) 
\begin{align*}
Q(M_T\ge k,Z_T=k-l)=2^T q^{\frac{T+k-l}{2}}(1-q)^{\frac{T-(k-l)}{2}}P(M_T\ge k,Z_T=k-l)
\end{align*} 
Aus dem Spiegelungsprinzip für $P$ (\ref{satz:2.11.3}) zusammen mit ($\star$) folgt:
\begin{align*}
&2^T q^{\frac{T+k-l}{2}}(1-q)^{\frac{T-(k-l)}{2}}P(M_T\ge k,Z_T=k-l)\\
=& 2^T q^{\frac{T+k-l}{2}}(1-q)^{\frac{T-(k-l)}{2}}P(Z_T=k+l)=\\
=&2^T q^{\frac{T+k-l}{2}}(1-q)^{\frac{T-(k-l)}{2}}(2^T q^{\frac{T+k+l}{2}}(1-q)^{\frac{T-(k+l)}{2}})^{-1}Q(Z_T=k+l)=\\
=&\left(\frac{1-q}{q}\right)^l Q(Z_T=k+l)
\end{align*}
Die zweite Aussage zeigt man analog.
\end{beweis}
Im Folgenden betrachten wir den Finanzmarkt, der einen Bond $B_t=(1+r)^t$, $t=0,\ldots,T$, und eine Aktie mit Preisprozess $S_t(\omega)=S_0u^{Z_t(\omega)}$ enthält. $Z$ ist die Irrfahrt, die oben definiert wurde. Dies ist ein spezieller Fall des CRR-Modells mit $u=\frac {1}{d}$.
\begin{beispiel}[Up-and-In-Call]
\begin{align*}
H_{\text{u\&i}}^{\text{Call}} = 
\begin{cases}
(S_T-K)^+ & \text{falls }\max_{0\le t\le T}S_t \ge B \\
0 & \text{sonst}
\end{cases}
\end{align*}
Hier ist $K>0$ der Ausübungspreis und $B> \max\{S_0,K\}$ ist eine vorgegebene Schranke.

Wir möchten den Preis $\pi(H_{\text{u\&i}}^{\text{Call}})=E_Q\left[\dfrac{H_{\text{u\&i}}^{\text{Call}}}{(1+r)^T}\right]$ berechnen. Man sieht sofort, dass
\begin{align*}
E_Q[H_{\text{u\&i}}^{\text{Call}}]&=E_Q[(S_T-K)^+ 1_{\{\max\limits_{0\le t\le T} S_t\ge B\}}]\\
&=\underbrace{E_Q[(S_T-K)^+1_{\{S_T\ge B\}}]}_{=:I_1}+\underbrace{E_Q[(S_T-K)^+ 1_{\{\max\limits_{0\le t\le T} S_t\ge B,S_T<B\}}]}_{=:I_2}
\end{align*}
Wir nehmen an (OBdA), dass $B$ ein möglicher Aktienpreis ist, d.h. es existiert ein $k\in\MdN$, sodass $B=S_0u^k$. Dann ist $S_t=S_0u^{Z_t} \ge B=S_0u^k\iff Z_t\ge k$ (und damit $\max\limits_{0\le t\le T} S_t \ge B \iff M_T\ge k$).
Der erste Erwartungswert $I_1$ kann direkt berechnet werden (vgl. Kor \ref{kor:2.4.6}).

Sei $f(s)\da(s-K)^+1_{\{s\ge B\}}$.
\begin{align*}
I_1=\sum\limits_{n=0}^T {T\choose n} q^n (1-q)^{T-n} \underbrace{(S_0u^{2n-T}-K)^+ \mathbf{1}_{\{S_0u^{2n-T}\geq B\}} }_{=f(S_0u^{2n-T})}
\end{align*}
Sei $b_k=\min\{n\in\MdN_0:S_0u^{2n-T}\ge S_0u^k\}=\min\{n\in\MdN_0:2n-T\ge k\}$. Dann gilt
\begin{align*}
I_1=\sum\limits_{n=b_k}^T {T\choose n} q^n (1-q)^{T-n} (S_0u^{2n-T}-K)^+
\end{align*}

Wir berechnen $I_2$, und wenden dazu das Spiegelungsprinzips für $Q$ (Satz 2.11.4) an:
\begin{align*}
I_2&=E_Q[(S_0u^{Z_T}-K)^+1_{\{M_T\geq k,Z_T<k\}}]\\
&= \sum\limits_{l\ge 1}E_Q[(S_0u^{Z_T}-K)^+1_{\{M_T\geq k,Z_T=k-l\}}]\\
&= \sum\limits_{l\ge 1}E_Q[(S_0u^{k-l}-K)^+1_{\{M_T\geq k,Z_T=k-l\}}]\\
&= \sum\limits_{l\ge 1}(S_0u^{k-l}-K)^+Q(M_T\geq k,Z_T=k-l)\\
&= \sum\limits_{l\ge 1}(S_0u^{k-l}-K)^+\left(\frac{q}{1-q}\right)^kQ(Z_T=-k-l)\\
&=\left(\frac{q}{1-q}\right)^ku^{2k}\sum\limits_{l\ge 1}(S_0u^{-k-l}-\underbrace{Ku^{-2k}}_{=:\tilde{K}})^+Q(Z_T=-k-l)\\
&= \left(\frac{q}{1-q}\right)^k\left(\frac{B}{S_0}\right)^{2}\sum\limits_{l\ge 1}(S_0u^{-k-l}-\tilde{K})^+Q(Z_T=-k-l)\\
&=\left(\frac{q}{1-q}\right)^k\left(\frac{B}{S_0}\right)^{2} E_Q[(S_T-\tilde{K})^+1_{\{S_T<\tilde{B}\}}]
\end{align*}
wobei $\tilde{B}\da\frac{S_0^2}{B}=S_0u^{-k}$.

Im letzten Schritt haben wir verwendet, dass $Z_T=-k-l\iff S_T<\tilde{B}$. Dazu folgende Nebenrechnung:

Sei $Z_T=-k-l$. Dann ist $S_T=S_0u^{-k-l}=\frac{S_0^2}{B}u^{-l}=\tilde{B}\frac{1}{u^l}<\tilde{B}$.  Dann folgt wie bei der Berechnung von $I_1$ mit $\tilde{b_k}\da\max\{n\in\MdN_0:S_T=S_0u^{2n-T}<\tilde{B}\}=\max\{n\in\MdN_0:2n-T<-k\}$:
\begin{align*}
I_2=\left(\frac{q}{1-q}\right)^k\left(\frac{B}{S_0}\right)^2 \sum\limits_{n=0}^{\tilde{b_k}} {T\choose n} q^n(1-q)^{T-n} (S_0u^{2n-T}-\tilde{K})^+
\end{align*}
Dann ist $\pi(H_{\text{u\&i}}^{\text{Call}})=\frac{1}{(1+r)^T}(I_1+I_2)$.
\end{beispiel}

\begin{beispiel}[Up-and-Out-Call-Option]
\begin{align*}
H_{\text{u\&o}}^{\text{Call}} = 
\begin{cases}
0 & \text{falls }\max_{0\le t\le T}S_t \ge B \\
(S_T-K)^+ & \text{sonst}
\end{cases}
\end{align*}
Hier ist $K$ der Ausübungspreis, $B>\max\{S_0,K\}$ die Schranke.

Wie im Beispiel zuvor sei $B=S_0u^k$ für ein $k\in\MdN$.
Sei $H^{\text{Call}}\da(S_T-K)^+$ die gewöhnliche Call-Option mit Preis $\pi(H^{\text{Call}})=E_Q\left[\frac{(S_T-K)^+}{(1+r)^T}\right]$.
\begin{align*}
\pi(H_{\text{u\&o}}^{\text{Call}})&=\pi(H^{\text{Call}})-\pi(H_{\text{u\&i}}^{\text{Call}})\\
&=\frac{1}{(1+r)^T}(E_Q[(S_T-K)^+1_{\{S_T<B\}}]-\left(\frac{q}{1-q}\right)^k\left(\frac{B}{S_0}\right)^2E_Q[(S_T-\tilde{K})^+1_{\{S_T<\tilde{B}\}}])
\end{align*}
mit der gleichen Notation wie zuvor.
\end{beispiel}

\begin{beispiel}[Lookback-Put-Option]
\begin{align*}
H_{\text{max}}^{\text{Put}} =  \max_{0\le t\le T} S_t - S_T
\end{align*}
Bei Lookback-Optionen handelt man die zugrundeliegende Aktie zum minimalen bzw. maximalen Preis.
Der Preis der Option ist
\begin{align*}
\pi(H_{\text{max}}^{\text{Put}})=E_Q\left[\frac{\max S_t-S_T}{(1+r)^T}\right]=E_Q\left[\frac{\max S_t}{(1+r)^T}\right]-S_0.
\end{align*}
Wir berechnen also den Erwartungswert
\begin{align*}
E_Q [\max_{0\le t\le T} S_t] 
= E_Q [\max S_0 u^{Z_t}] 
= E_Q[S_0 u^{M_T}] 
= \sum_{n=0}^T S_0 u^n Q(M_T = n).
\end{align*}

Aus Satz \ref{satz:2.11.4} folgt
\begin{align*}
Q(M_T = n) &= \sum_{l\ge 0} Q(M_T=n,\, Z_T = n-l) \\
&= \sum_{l\ge 0} \frac{1}{1-q} \bigg(\frac{q}{1-q}\bigg)^n \frac{n+l+1}{T+1} Q(Z_{T+1} = -1 - l -n) \\
&= \frac{1}{1-q} \bigg(\frac{q}{1-q}\bigg)^n  \frac{1}{T+1} \sum_{l\ge0} (n+l+1) Q(-Z_{T+1} = 1 + n + l) \\
&= \frac{1}{1-q} \bigg(\frac{q}{1-q}\bigg)^n  \frac{1}{T+1} E_Q[-Z_{T+1} 1_{\{Z_{T+1} \le -(1+n)\}}]
\end{align*}
Daher gilt für den Preis:
\begin{multline*}
\pi(H_{\text{max}}^{\text{Put}}) = \frac1{(1+r)^T} \sum_{n=0}^T S_0 u^n Q(M_T = n) - S_0
\iff \\
\pi(H_{\text{max}}^{\text{Put}}) + S_0 =
\frac{S_0}{(1+r)^T(1-q)(T+1)} \sum_{n=0}^T u^n \bigg(\frac{q}{1-q}\bigg)^n E_Q[-Z_{T+1} 1_{\{Z_{T+1} \le -(1+n)\}}]
\end{multline*}
Der Erwartungswert kann explizit berechnet werden.
\end{beispiel}

\begin{bemerkung}
\begin{itemize}
\item Neben den hier betrachteten Barrier-Optionen und Lookback-Optionen gibt es noch eine Vielzahl anderer exotischer Optionen: asiatische Option, Chooser-Option, binäre Optionen, Basket-Option,\ldots
\item Prinzipiell werden exotische Optionen nicht nur als europäische Option gehandelt.
\end{itemize}
\end{bemerkung}

\chapter{Optimale Portfolioselektion}
\addtocounter{section}{1}
\setcounter{satz}{0}

Schon bei der Bewertung amerikanischer Optionen haben wir gesehen, dass Optimierungsprobleme in der Finanzmathematik eine wichtige Rolle spielen. Ein weiteres Optimierungsproblem sind optimale Investitionsentscheidungen. Zur Lösung solcher Probleme werden wir die \emph{dynamische Programmierung}\index{dynamische Programmierung} verwenden.

\begin{beispiel}[Apfelbäume]
(Beispiel auf Folie.)
\end{beispiel}

\subsection{Problemstellung}
Wir betrachten Optimierungsprobleme in diskreter Zeit mit endlichen Zeithorizont $T$. Sei $X$ ein Markov-Prozess, der Werte im Zustandsraum $\cX$ annimmt. Sei $\cA$ die Menge der zulässigen Handlungen. Falls der Prozess im Zustand $x\in\cX$ ist und man eine Handlung $a\in \cA$ wählt, bekommt man einen Gewinn von $r(x,a)$. Der Prozess springt zu einem neuen Zustand und hat dabei die Verteilung $P(x,a,\cdot)$. Das Ziel ist es, die Handlungen so zu wählen, dass man 
\[
\sup E\left[\sum_{t=0}^{T-1} \beta^t r(X_t,a_t) + \beta^T R(X_T)\right]
\]
erhält. Hier ist $\beta\in(0,1]$ der Diskontfaktor und $R(\cdot)$ beschreibt den Gewinn zum Endzeitpunkt~$T$. Die Handlung $a_t$ wird zur Zeit $t$ gewählt und darf nur von Informationen bis zur Zeit $t$ abhängen.

\subsection{Lösung}
Wir definieren die Wertfunktion
\begin{align*}
V_T(x) &= R(x) \\
V_t(x) &= \sup E [\sum_{i=t}^T \beta^{i-t} r(X_i,a_i) + \beta^{T-t} R(X_T)\mid X_t = x]
\end{align*}
für $t=T-1,\ldots, 0$.

Dann erfüllt die Wertfunktion die Bellman-Gleichung 
\begin{align*}
V_t(x) = \sup_{a\in \cA} \{ r(x,a) + \beta \int V_{t+1} (y) P(x,a,dy)\}.
\end{align*}

\section{Bestimmung optimaler Portfolios durch dynamische Programmierung}

Sei $(\Omega,\cF,P)$ ein Wahrscheinlichkeitsraum. Seien $R_t^k$, $t=1,\ldots, T$, $k=1,\ldots,d$ Zufallsvariablen auf diesem Wahrscheinlichkeitsraum. Wir betrachten einen Finanzmarkt mit einem Bond und $d$ risikobehafteten Anlagemöglichkeiten (Aktien). Sei $r_t$ die Verzinsung der risikolosen Anlage im Intervall $[t-1,t)$, $r_t\in \MdR_+$ und sei $R_t^k$ die zufällige Verzinsung der $k$-ten Aktie im Intervall $[t-1,t)$. Wir nehmen an, dass die Zufallsvektoren $R_t=(R_t^1,\ldots,R_t^d)$ unabhängig sind mit gegebener Verteilung.

Sei $a_t^k$ der Betrag, der zur Zeit $t$ in die $k$-te Aktie investiert wird und $X_t$ das Vermögen zur Zeit~$t$. Dann ist $X_t - \sum_{k=1}^d a_t^k$ der Betrag, der zur Zeit $t$ in die risikolose Anlagemöglichkeit investiert wird. Sei $X_0=x \in \MdR$ das Anfangsvermögen. Dann gilt für $t=0,1,\ldots, T-1$: $X_{t+1} = r_{t+1}(X_t - \sum_{k=1}^d a_t^k) + \sum_{k=1}^d a_t^k R_{t+1}^k = X_{t+1}^a$.
Wir nehmen an, dass die Investitionsentscheidung zur Zeit $t$ nur vom Vermögen zur Zeit $t$ abhängt.

\begin{definition}
Ein Anlagepolitik $\pi = (f_0,f_1,\ldots,f_{T-1})$ ist eine Folge von Entscheidungsregeln $f_t:\MdR\to\MdR^d$, wobei $f_t(x) =(f_t^1(x),\ldots,f_t^d(x))$ ist. Dabei gibt $f_t^k(x)$ den Betrag an, der zur Zeit $t$ in die $k$-te Aktie investiert wird, in Abhängigkeit vom Vermögen $x$ zur Zeit $t$.

Für eine gegebenene Anlagepolitik $\pi=(f_0,f_1,\ldots,f_{T-1})$ gilt $X_1 = X_1^{f_0(x)},\ldots, X_{t+1} =X_{t+1}^{f_t(x)}$.
\end{definition}

\begin{definition}
Für $t=0,1,\ldots,T$ und $x\in\MdR$ sei $V_t(x) \da \sup_\pi E_\pi[U(X_T)\mid X_t=x]$, wobei $U:\MdR\to\MdR$ eine Nutzenfunktion ist. $V_t(x)$ ist der maximale erwartete Nutzen vom Endvermögen, wenn man zum Zeitpunkt $t$ mit Kapital $x$ startet. Falls
\[
E_{\pi^*}[U(X_T)\mid X_t=x] 
= \sup_{\pi} E_\pi[U(X_T)\mid X_t=x],
\]
dann ist $\pi^*$ eine \emph{optimale Anlagepolitik} für das $(T-t)$-stufige Problem.
\end{definition}

Wir suchen $V_0(X)$ und $\pi^*$ für das $T$-stufige Problem.
$V_t(x)$ kann rekursiv berechnet werden:

\begin{satz}
Es gilt für $x\in\MdR$: $V_T(x) = U(x)$ und für $t=T-1,\ldots, 0$:
\begin{align*}
V_t(x) &= \sup_{a=(a_1,\ldots,a_d)\in\MdR^d} E[V_{t+1}(X_{t+1}^a) \mid X_t =x] \\
      &= \sup_{a=(a_1,\ldots,a_d)\in\MdR^d} E[V_{t+1}(r_{t+1}(x-\sum_{k=1}^d a_k) + \sum_{k=1}^d a_kR_{t+1}^k) \mid X_t =x] \ad UV_{t+1}(x)
\end{align*}
\end{satz}

\begin{beweis}
Sei $x\in\MdR$. Für $t=T$ gilt $V_T(x)=\sup_{\pi} E[U(X_T)\mid X_T=x] = U(x)$.

Sei $t=T-1,\ldots, 0$. Wir zeigen zuerst $V_t(x) \le UV_{t+1}(x)$. Sei $\pi$ eine beliebige Anlagepolitik. Dann gilt
\begin{align*}
E_\pi[U(X_T) \mid X_t=x] &= E_\pi[ E_\pi[U(X_T)\mid X_{t+1}^{f_t(x)}] \mid X_t=x] \\
&\le E_\pi[ V_{t+1}(X_{t+1}^{f_t(x)}) \mid X_t = x] \\
&\le UV_{t+1}(x).
\end{align*}
Nun bilde das Supremum über alle Anlagepolitiken $\pi$. Dann gilt $V_t(x) \le UV_{t+1}(x)$. 

Wir zeigen nun $V_t(x) \ge UV_{t+1}(x)$ für $t=T-1,\ldots,0$ und $x\in\MdR$.

Für $\varepsilon>0$ existiert eine Entscheidungsregel $f_t(x)$, so dass 
\begin{align*}
E[V_{t+1}(X_{t+1}^{f_t(x)}) \mid X_t = x] &= E[V_{t+1}(r_{t+1}(x-\sum_{k=1}^d f_t^k) + \sum_{k=1}^d f_t^k R_{t+1})] 
\ge UV_{t+1}(x) - \varepsilon
\end{align*}
für alle $x\in\MdR$.

Sei nun $t=T-1$ und $\pi$ die Anlagepolitik, die aus diesen Entscheidungsregeln besteht. Dann folgt
\begin{align*}
E_\pi[U(X_T) \mid X_{T-1} = x] \ge UV_T(x) - \varepsilon \ge V_{T-1} - \varepsilon.
\end{align*}
Bilde nun das Supremum über alle Anlagepolitiken $\pi$. Dann gilt $V_{T-1}(x) \ge UV_T(x) - \varepsilon$. Mit $\varepsilon \to 0$ folgt $V_{T-1}(x) \ge UV_T(x)$.

Sei nun $t=T-2$:
\begin{align*}
E_\pi[U(X_T) \mid X_{T-2}=x] &= E_\pi[ E_\pi[ U(X_T) \mid X_{T-1}] \mid X_{T-2} = x] \\
&\ge E_\pi[ V_{T-1}(X_{T-1}) \mid X_{T-2} = x] - \varepsilon \\
&\ge UV_{T-1}(x) - 2\varepsilon  \\
&\ge V_{T-2}(x) - 2\varepsilon
\end{align*}
Bilde das Supremum über alle Anlagepolitiken $\pi$. Dann folgt $V_{T-2}(x) \ge UV_{T-1}(x) - 2\varepsilon$.  Mit $\varepsilon \to 0$ folgt $V_{T-2}(x) \ge UV_{T-1}(x)$.

Durch vollständige Induktion folgt die Behauptung.
\end{beweis}

\begin{bemerkung}
\begin{itemize}
\item Zur Erinnerung: Für HARA-Nutzenfunktionen gilt
\[
\frac{1}{\ARA(x)} = -\frac{u'(x)}{u''(x)} = Ax+B
\]
mit Konstanten $A$, $B$.
\item Häufig wird diese Klasse von Nutzenfunktionen in der Portfoliooptimierung betrachtet. Unter gewissen Annahmen lassen sich hier teilweise explizite Lösungen ermitteln.
\end{itemize}
\end{bemerkung}

\begin{beispiel}
Exponentieller Nutzen: Wir beschränken uns auf den Fall $d=1$. Sei $U(x) = - e^{-\gamma x}$ für $\gamma>0$. Hier ist $\ARA(x) = -\frac{U''(x)}{U'(x)} = \gamma$ und daher $U''(x) = -\gamma U'(x)$. Die zufällige Verzinsung der Aktie sei normalverteilt, das heißt $R\sim N(\mu, \sigma^2)$. Wir berechnen die optimale Strategie und die Wertfunktion.

Idee: Wir versuchen eine analytische Form der Wertfunktion zu ermitteln. Wir beginnen bei $T$ und arbeiten uns nach vorne durch:
\begin{align*}
V_T(x) = E[U(X_T)\mid X_T=x] = U(x).
\end{align*}
Anwendung der dynamischen Programmierung liefert
\begin{align*}
V_{T-1}(x) &= \sup_{a_{T-1}} E[V_T(X_T) \mid X_{T-1}=x]\\
&= \sup_{a_{T-1}} E[V_T(r_T (x-a_{T-1}) + a_{T-1}R_T)] \\
&= \sup_{a_{T-1}} E[U(r_T(x-a_{T-1}) + a_{T-1} R_T)] \\
&= \sup_{a_{T-1}} E[-\exp(-\gamma (r_T(x-a_{T-1}) + a_{T-1} R_T))] \\
&= \sup_{a_{T-1}} (-1) e^{-\gamma r_Tx} e^{\gamma r_T a_{T-1}} E[e^{-\gamma a_{T-1} R_T)}] \\
&= \sup_{a_{T-1}} (-1) e^{-\gamma r_Tx} e^{\gamma r_T a_{T-1}} e^{\mu(-\gamma a_{T-1}) + \frac{\sigma^2}{2} \gamma^2 a_{T-1}^2} \\
&= \sup_{a_{T-1}} (-1) e^{-\gamma r_Tx} \exp(a_{T-1} \gamma(r_T -\mu) + \frac12 a_{T-1}^2 \gamma^2  \sigma^2)
\end{align*}
Wir berechnen das Infimum von $h_{T-1}(a) \da a\gamma (r_T-\mu) + \frac12 a^2\gamma^2 \sigma^2$:
\begin{align*}
h'(a) = \gamma(r_T-\mu) + a\gamma^2 \sigma^2 = 0 \iff a= \frac{\mu-r_T}{\sigma^2} \frac 1 \gamma
\end{align*}
und $h''(a) >0$. Einsetzen liefert
\begin{align*}
V_{T-1}(x) &= U(xr_T) \exp (\frac{\mu-r_T}{\sigma^2} \frac1\gamma (r_T - \mu) \gamma + \frac{(\mu-r_T)^2}{\sigma^2\sigma^2} \frac1{\gamma^2} \gamma^2 \frac{\sigma^2}{2}) \\
&= U(r_Tx) \underbrace{\exp(-\frac12 \frac{(\mu- r_T)^2}{\sigma^2})}_{\ad b_T}
\end{align*}

Dann für $t=T-2$:
\begin{align*}
V_{T-2}(x) &= \sup_a E[ U(r_T X_{T-1}) \exp(-\frac12 \frac{(\mu- r_T)^2}{\sigma^2}) \mid X_{T-2} = x] \\
= \cdots &= \sup_a b_T (-1) e^{-\gamma r_T r_{T-1} x} \exp(a\gamma r_T (r_{T-1} - \mu) + \frac12 a^2\gamma^2 r_T^2 \sigma^2)
\end{align*}
Ähnlich wie zuvor ist $h_{T-2}(a) \da a \gamma r_T(r_{T-1} - \mu) + \frac12 a^2r_T^2\sigma^2$ und
\[
h'(a) = 0 \iff a = \frac{\mu-r_{T-1}}{\sigma^2} \frac1\gamma \frac1{r_T}. 
\]
Damit gilt
\begin{align*}
V_{T-2}(X) = U(r_T r_{T-1} x)\underbrace{b_T \exp(-\frac{(\mu - r_{T-1})^2}{2\sigma^2})}_{\ad b_{T-1}}
\end{align*}

Wir „raten“ jetzt die analytische Form der Wertfunktion und der optimalen Strategie und beweisen das durch Induktion.

Es gilt für alle $t=T-2,\ldots,1, 0$
\begin{align*}
V_t(x) &= U(r_{t+1}\cdot \cdots\cdot r_T x) b_{t+1} \\
f_t &= \frac{\mu-r_{t+1}}{\sigma^2} \frac1\gamma \frac1{r_{t+2}\cdot \cdots \cdot r_T}
\end{align*}
was für $t=T-1,T-2$ schon gezeigt ist. Wir zeigen den Schritt von $t+1$ nach $t$.
\begin{align*}
V_t(x) &= \sup_a E[V_{t+1} (X_{t+1}^a) \mid X_t = x] \\
&= \sup_a E[V_{t+1} (r_{t+1} (x-a) + aR)] \\
&= \sup_a E[U(\underbrace{r_{t+2}\cdot \cdots\cdot r_T}_{\ad \tilde r} (r_{t+1} (x-a) + aR))]\cdot b_{t+2} \\
&= \sup_a (-1) b_{t+2} \exp(-\gamma \tilde r r_{t+1} (x-a)) E[\exp(-\gamma \tilde r a R)]\\
&= \sup_a (-1) b_{t+2} \exp(-\gamma \tilde r r_{t+1} (x-a)) \exp(-\gamma \tilde r a \mu + \frac12 \sigma^2 \gamma ^2 \tilde r^2 a^2) \\
&= \sup_a (-1) \exp(-\gamma\tilde r r_{t+1} x) \exp(-a\tilde{r} \gamma(\mu-r_{t+1}) + \frac12 a^2 \gamma ^2 \tilde r^2 \sigma^2)
\end{align*}
Wie zuvor ist $h_t(a) \da -a\tilde r \gamma(\mu- r_{t+1}) + \frac12 a^2 \gamma^2 \tilde r^2 \sigma^2$ und
\[
h'_t(a) = 0 \iff
a= \frac{\mu-r_{t+1}}{\sigma^2} \frac1\gamma \frac1{\tilde r}
\]
Dann gilt
\begin{align*}
V_t(x) = U(r_{t+1} \cdot \cdots \cdot r_T x) \underbrace{b_{t+2} \exp(-\frac{(\mu-r_{t+1})^2}{2\sigma^2})}_{\ad b_{t+1}}.
\end{align*}
Man sieht hier, dass 
\begin{align*}
-\frac{V'(x)}{V''(x)} &= - \frac{ b_{t+1} U'(r_{r+1}\cdot\cdots\cdot r_T x) r_{t+1}\cdot\cdots\cdot r_T}{b_{t+1} U''(r_{r+1}\cdot\cdots\cdot r_T x) (r_{t+1}\cdot\cdots\cdot r_T)^2} \\
&= - \frac{U'(r_{t+1}\cdot\cdots\cdot r_T x)}{U''(r_{t+1}\cdot\cdots\cdot r_Tx)} \frac1{r_{t+1}\cdot\cdots\cdot r_T} \\
&= \frac1{\ARA(r_{t+1}\cdot\cdots\cdot r_Tx)} \frac1{r_{t+1}\cdot\cdots\cdot r_T} \\
&= \frac1{\gamma} \frac1{r_{t+1}\cdot\cdots\cdot r_T} \\ 
\end{align*}
Für die optimale Strategie gilt $f_t = -\frac{V_t'}{V_t''} \cdot h$, wobei $h$ nur von den Variablen abhängt, die die Dynamik des Marktes beschreiben.
\end{beispiel}

\section{Optimale Portfolios in vollständigen Märkten}

Wir betrachten einen arbitragefreien, vollständigen Markt, das heißt es existiert ein eindeutiges äquivalentes Martingalmaß $Q$. Sei $U:\MdR\to\MdR$ eine Nutzenfunktion mit
\begin{align*}
\lim_{x\to-\infty} U'(x) = + \infty && \lim_{x\to+\infty} U'(x) = 0
\end{align*}
(beziehungsweise für $U:(0,\infty)\to\MdR$: $\lim_{x\to0}U'(x) = +\infty$).

\subsection{Problemstellung}

Wir bezeichnen wie im zweiten Kapitel (Definition \ref{def:2.3.2}) mit 
$(V_t^\varphi)$ den Vermögensprozess und $(B_t)$ ist der Preisprozess des Bondes. Ziel ist nun die Bestimmung von
\[
\sup_{\varphi} E[U(V_T^\varphi)]
\]
unter der Nebenbedingung, dass $V_0^\varphi=v_0$, wobei $\varphi$ Handelsstrategien (insbesondere selbstfinanzierend) sind. Zuvor haben wir dieses Problem mit Hilfe der dynamischen Programmierung gelöst. Jetzt werden wir anders vorgehen und dabei die Vollständigkeit des Marktes ausnutzen.

\subsection{Lösung}

Fasse die Abbildung  $\varphi \mapsto E[U(V_T^\varphi)]$ als eine Verknüpfung zweier Abbildungen auf:
\begin{enumerate}
\item Die erste Abbildung ist $\varphi \mapsto V_T^\varphi$, das heißt der Handelsstrategie wird eine Zufallsvariable zugeordnet, die das Endvermögen beschreibt.
\item Die zweite Abbildung ist $X\mapsto E[U(X)]$, das heißt der Zufallsvariable wird der erwartete Nutzen, also eine reelle Zahl, zugeordnet.
\end{enumerate}

Die Vorgehensweise ist wie folgt:
\begin{enumerate}
\item Lösung des statischen Optimierungsproblems: Maximiere $E[U(X)]$ für $X\in\cX \da \{X$ ist $\cF_T$-messbar, integrierbar bezüglich $P$ und $Q$ sowie $E_Q[\frac{X}{B_T}] = v_0\}$.
\item Repräsentationsproblem: Sei $X^*$ eine Lösung von (1). Bestimme $\varphi$, so dass $V_0^\varphi = v_0$ und $V_T^\varphi = X^*$. Da der Markt vollständig ist, existiert eine solche Strategie. Dann ist $\varphi$ die gesuchte optimale Strategie für das ursprüngliche Problem.
\end{enumerate}

Im Folgenden ermitteln wir einen Kandidaten $X^*$ mit Hilfe des Lagrange-Ansatzes. Wir setzen $Z \da \frac{dQ}{dP}$. Dann ist $E_Q[\frac X{B_T}] = E[Z\cdot \frac{X}{B_T}]$.

Sei
\[
L(X,c) \da E[U(X)] - c\cdot (E[\frac{ZX}{B_T}] - v_0)
\]
die Lagrange-Funktion. Dann gilt für die Ableitungen:
\begin{align*}
\frac\partial{\partial X} L(X,c) &= E[U'(X) - c \frac Z{B_T}] \stackrel!= 0 \\
\frac\partial{\partial c} L(X,c) &= E[\frac{ZX}{B_T}] - v_0 \stackrel!= 0
\end{align*}

Sei $I$ die Umkehrfunktion von $U'$. Dann erfüllt $X^*$ mit $U'(X^*) = c \frac{Z}{B_T}$, also $X^* = I(c \frac{Z}{B_T})$ die erste Nebenbedingung und $c$ wird so gewählt, dass 
\[
E_Q[\frac{I(c\frac{Z}{B_T})}{B_T}] = E[\frac{Z I(c\frac{Z}{B_T})}{B_T}] = v_0.
\]

\begin{bemerkung}
\begin{itemize}
\item Da die Menge aller bezüglich $P,Q$ integrierbaren Zufallsvariablen mit $E_Q[\frac{X}{B_T}] \le v_0$ konvex ist und $U$ streng konkav und streng wachsend ist, ist die Eindeutigkeit der Lösung klar, und es muss gelten $E_Q[\frac{X^*}{B_T}]=v_0$, da aus $E_Q[\frac{X^*}{B_T}] < v_0$ sofort folgen würde, dass $X^* + v_0 - E_Q[\frac{X^*}{B_T}]$ echt besser wäre.
\item Da $\lim_{x\to-\infty}U'(x) = +\infty$, $\lim_{x\to +\infty}U'(x)=0$ und $U''(x) <0$ gilt, folgt, dass die Werte $(0,\infty)$ von $U'$ angenommen werden. Daher ist $I(c\frac{Z}{B_T})$ wohldefiniert für alle $c>0$.
\item Wir zeigen die Optimalität von $X^* = I(c\frac{Z}{B_T})$. Aus der Konkavität von $U$ folgt für alle $X\in\cX$:
\begin{align*}
U(X) \le U(X^*) + U'(X^*)(X-X^*) = U(X^*) + c\frac{Z}{B_T}(X-X^*)
\end{align*}
die Bildung des Erwartungswertes bezüglich $P$ liefert
\begin{align*}
EU(X) \le EU(X^*) + \underbrace{c E_Q[\frac{1}{B_T}(X-X^*)].}_{\le 0}
\end{align*}
Daher ist $X^*$ optimal.
\end{itemize}
\end{bemerkung}

\begin{beispiel}
\label{bsp:3.3.2}
Wir betrachten die exponentielle Nutzenfunktion $U(x) = -e^{-\gamma x}$ für ein $\gamma >0$. Dann gilt $U'(x) = \gamma e^{-\gamma x}$ und daher $I(y) = -\frac1\gamma \log(\frac y \gamma)$.

Dann gilt für das optimale Endvermögen $X_T^* = I(c \frac{Z}{B_T}) = -\frac{1}{\gamma}\log(\frac1\gamma \cdot c \frac{Z}{B_T})$ und für die Konstante $c$ gilt $E_Q[\frac{X_T^*}{B_T}] = v_0$.
Daraus folgt dann
\begin{align*}
v_0 &= E_Q[\frac{X_T^*}{B_T}]  \\
&= - \frac1\gamma \int (\log(\frac c \gamma) + \log (\frac{Z}{B_T})) \frac1{B_T} dQ \\
&= - \frac1\gamma \log(\frac c \gamma)E[\frac{Z}{B_T}] - \frac1\gamma \int \log( \frac{Z}{B_T}) \frac1{B_T} \frac{dQ}{dP} dP \\
&= - \frac1\gamma \log(\frac c \gamma)E[\frac{Z}{B_T}] - \frac1\gamma E[\frac{Z}{B_T} \log \frac{Z}{B_T}] \\
\iff \log(\frac c\gamma) &= (-\gamma v_0 - E[\frac{Z}{B_T} \log \frac{Z}{B_T}]) \frac{1}{E[\frac{Z}{B_T}]} \\
\iff c &= \gamma \exp\left( \frac{-\gamma v_0 - E[\frac{Z}{B_T} \log \frac{Z}{B_T}]}{E[\frac{Z}{B_T}]} \right)
\end{align*}
Daher ist das optimale Endvermögen
\begin{align*}
X_T^*& = -\frac{1}\gamma \log (\frac c\gamma \frac{Z}{B_T}) \\
&= \frac{1}\gamma \log \gamma - \frac1\gamma \log  \frac{Z}{B_T} - \frac1\gamma \log c \\
&= \frac{1}\gamma \log \gamma - \frac1\gamma \log  \frac{Z}{B_T} - \frac1\gamma \left (\log \gamma + \frac{-\gamma v_0 - E[\frac{Z}{B_T} \log \frac{Z}{B_T}]}{E[\frac{Z}{B_T}]}\right) \\
&= - \frac1\gamma \log  \frac{Z}{B_T} +  \frac{v_0 + \frac1\gamma E[\frac{Z}{B_T} \log \frac{Z}{B_T}]}{E[\frac{Z}{B_T}]}
\end{align*}
und der erwartete Nutzen ist
\begin{align*}
E[U(X_T^*)] &= E[-\exp(-\gamma (- \frac1\gamma \log  \frac{Z}{B_T} +  \frac{v_0 + \frac1\gamma E[\frac{Z}{B_T} \log \frac{Z}{B_T}]}{E[\frac{Z}{B_T}]}))] \\
&= -\exp\left( -\gamma v_0 \frac1{E[\frac{Z}{B_T}]} - \frac{E[\frac{Z}{B_T} \log \frac{Z}{B_T}]}{E[\frac{Z}{B_T}]} \right) E[\frac{Z}{B_T}]
\end{align*}
\end{beispiel}

\begin{bemerkung}
Interessant am Beispiel \ref{bsp:3.3.2} ist, dass die Formeln für das optimale Vermögen, den optimalen erwarteten Endnutzen etc. nur über $\frac{Z}{B_T}$ vom zugrundeliegenden Marktmodell abhängen.
\end{bemerkung}

\setcounter{secnumdepth}{-1}
\chapter{Satz um Satz (hüpft der Has)}
\theoremlisttype{optname}
\listtheorems{satz,beispiel}

\renewcommand{\indexname}{Stichwortverzeichnis}
%\addtocounter{chapter}{1}
%\addcontentsline{toc}{chapter}{\protect\numberline {\thechapter}Stichwortverzeichnis}
\addcontentsline{toc}{chapter}{Stichwortverzeichnis}
\printindex
\end{document}
